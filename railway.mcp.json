{
  "$schema": "https://railway.app/railway.schema.json",
  "name": "Fakturino with MCP AI Tools",
  "services": {
    "api": {
      "source": {
        "repo": ".",
        "branch": "main"
      },
      "build": {
        "builder": "NIXPACKS",
        "buildCommand": "composer install --no-dev --optimize-autoloader && npm install && npm run build"
      },
      "deploy": {
        "startCommand": "bash railway-start.sh",
        "healthcheckPath": "/up",
        "healthcheckTimeout": 100,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
      },
      "env": {
        "APP_ENV": "production",
        "APP_DEBUG": "false",
        "APP_URL": "${RAILWAY_PUBLIC_DOMAIN}",
        "FEATURE_MCP_AI_TOOLS": "true",
        "MCP_SERVER_URL": "http://mcp-server:3100",
        "MCP_SERVER_TOKEN": "${MCP_SERVER_TOKEN}"
      }
    },
    "worker": {
      "source": {
        "repo": ".",
        "branch": "main"
      },
      "build": {
        "builder": "NIXPACKS",
        "buildCommand": "composer install --no-dev --optimize-autoloader"
      },
      "deploy": {
        "startCommand": "php artisan queue:work --sleep=3 --tries=3 --queue=default,migration,banking",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
      },
      "env": {
        "APP_ENV": "production",
        "APP_DEBUG": "false"
      }
    },
    "scheduler": {
      "source": {
        "repo": ".",
        "branch": "main"
      },
      "build": {
        "builder": "NIXPACKS",
        "buildCommand": "composer install --no-dev --optimize-autoloader"
      },
      "deploy": {
        "startCommand": "php artisan schedule:work",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
      },
      "env": {
        "APP_ENV": "production",
        "APP_DEBUG": "false"
      }
    },
    "mcp-server": {
      "source": {
        "repo": ".",
        "directory": "/mcp-server",
        "branch": "main"
      },
      "build": {
        "builder": "NIXPACKS",
        "buildCommand": "pip install -r requirements.txt"
      },
      "deploy": {
        "startCommand": "python -m maverick_mcp.api.server --transport sse --port 3100 --host 0.0.0.0",
        "healthcheckPath": "/internal/mcp/health",
        "healthcheckTimeout": 30,
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10
      },
      "env": {
        "PORT": "3100",
        "LARAVEL_INTERNAL_URL": "http://api:8080",
        "MCP_SERVER_TOKEN": "${MCP_SERVER_TOKEN}",
        "APP_NAME": "FakturinoMCP",
        "ENVIRONMENT": "production",
        "LOG_LEVEL": "info"
      }
    }
  },
  "networks": {
    "private": {
      "services": ["api", "worker", "scheduler", "mcp-server"]
    }
  },
  "volumes": {
    "certificates": {
      "mountPath": "/storage/certificates"
    }
  }
}
