import{aL as L,r as l,c as M,o as c,a,l as t,w as o,aO as A,F as H,aC as z,v as K,e as C,j as v,f as g,$ as Q,g as w,aD as J,i as W,P as X,K as E,L as x,Q as Z,aF as ee,N as te,n as ae,b,m as se,t as V,q as ie,M as ne,S as oe}from"./main-DpDYmbyp.js";import{_ as le,a as re,b as me,c as de,d as ue,e as ce,f as pe}from"./SalesTax-DaUR7fNN.js";import{_ as _e}from"./CreateCustomFields-B13Z4-HD.js";import{_ as ge}from"./ExchangeRateConverter-C0WLa-5M.js";import{_ as fe}from"./TaxTypeModal-BJCBWiwS.js";import"./DragIcon-CeeWVm9Y.js";import"./SelectNotePopup-DUO919h6.js";import"./NoteModal-LQwzMr_4.js";import"./payment-zQDBnf7-.js";import"./dynamic-import-helper-BheWnx7M.js";import"./exchange-rate-DKRdhF9a.js";const ve={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},Ee={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(i){const e=L();return(f,r)=>{const B=l("BaseCustomerSelectPopup"),m=l("BaseDatePicker"),u=l("BaseInputGroup"),$=l("BaseInput"),h=l("BaseInputGrid");return c(),M("div",ve,[a(B,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":r[0]||(r[0]=d=>t(e).newEstimate.customer=d),valid:i.v.customer_id,"content-loading":i.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(h,{class:"col-span-7"},{default:o(()=>[a(u,{label:f.$t("reports.estimates.estimate_date"),"content-loading":i.isLoading,required:"",error:i.v.estimate_date.$error&&i.v.estimate_date.$errors[0].$message},{default:o(()=>[a(m,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":r[1]||(r[1]=d=>t(e).newEstimate.estimate_date=d),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(u,{label:f.$t("estimates.expiry_date"),"content-loading":i.isLoading},{default:o(()=>[a(m,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":r[2]||(r[2]=d=>t(e).newEstimate.expiry_date=d),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(u,{label:f.$t("estimates.estimate_number"),"content-loading":i.isLoading,required:"",error:i.v.estimate_number.$error&&i.v.estimate_number.$errors[0].$message},{default:o(()=>[a($,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":r[3]||(r[3]=d=>t(e).newEstimate.estimate_number=d),"content-loading":i.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(ge,{store:t(e),"store-prop":"newEstimate",v:i.v,"is-loading":i.isLoading,"is-edit":i.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ye={class:"flex"},we={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},be={class:"relative w-full lg:w-1/2"},k="newEstimate",Me={__name:"EstimateCreate",setup(i){const e=L(),f=A(),r=H(),B=z(),{t:m}=K.useI18n();let u=C(!1);const $=C(!1),h=C(["customer","company","customerCustom","estimate","estimateCustom"]);let d=te(),P=ae(),p=v(()=>e.isFetchingInitialSettings),F=v(()=>_.value?m("estimates.edit_estimate"):m("estimates.new_estimate")),_=v(()=>d.name==="estimates.edit");const T=v(()=>r.selectedCompanySettings.sales_tax_us_enabled==="YES"&&f.salesTaxUSEnabled),D={estimate_date:{required:g.withMessage(m("validation.required"),w)},estimate_number:{required:g.withMessage(m("validation.required"),w)},reference_number:{maxLength:g.withMessage(m("validation.price_maxlength"),J(255))},customer_id:{required:g.withMessage(m("validation.required"),w)},exchange_rate:{required:ee(function(){return g.withMessage(m("validation.required"),w),e.showExchangeRate}),decimal:g.withMessage(m("validation.valid_exchange_rate"),Q)}},y=W(D,v(()=>e.newEstimate),{$scope:k});X(()=>e.newEstimate.customer,s=>{s&&s.currency?e.newEstimate.selectedCurrency=s.currency:e.newEstimate.selectedCurrency=r.selectedCompanyCurrency}),e.resetCurrentEstimate(),B.resetCustomFields(),y.value.$reset,e.fetchEstimateInitialSettings(_.value);async function N(){if(y.value.$touch(),y.value.$invalid)return!1;u.value=!0;let s=oe.cloneDeep({...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax});s.discount_per_item==="YES"?s.items.forEach((n,S)=>{n.discount_type==="fixed"&&(s.items[S].discount=Math.round(n.discount*100))}):s.discount_type==="fixed"&&(s.discount=Math.round(s.discount*100)),!e.newEstimate.tax_per_item==="YES"&&s.taxes.length&&(s.tax_type_ids=s.taxes.map(n=>n.tax_type_id));const q=_.value?e.updateEstimate:e.addEstimate;try{let n=await q(s);n.data.data&&P.push(`/admin/estimates/${n.data.data.id}/view`)}catch(n){console.error(n)}u.value=!1}return(s,q)=>{const n=l("BaseBreadcrumbItem"),S=l("BaseBreadcrumb"),I=l("BaseButton"),U=l("router-link"),j=l("BaseIcon"),G=l("BasePageHeader"),O=l("BaseScrollPane"),R=l("BasePage");return c(),M(Z,null,[a(re),a(me),a(fe),T.value&&(!t(p)||t(d).query.customer)?(c(),E(le,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(_),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):x("",!0),a(R,{class:"relative estimate-create-page"},{default:o(()=>[b("form",{onSubmit:se(N,["prevent"])},[a(G,{title:t(F)},{actions:o(()=>[s.$route.name==="estimates.edit"?(c(),E(U,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:o(()=>[a(I,{class:"mr-3",variant:"primary-outline",type:"button"},{default:o(()=>[b("span",ye,V(s.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):x("",!0),a(I,{loading:t(u),disabled:t(u),"content-loading":t(p),variant:"primary",type:"submit"},{left:o(Y=>[t(u)?x("",!0):(c(),E(j,{key:0,class:ne(Y.class),name:"ArrowDownOnSquareIcon"},null,8,["class"]))]),default:o(()=>[ie(" "+V(s.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:o(()=>[a(S,null,{default:o(()=>[a(n,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(n,{title:s.$t("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),s.$route.name==="estimates.edit"?(c(),E(n,{key:0,title:s.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(c(),E(n,{key:1,title:s.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(Ee,{v:t(y),"is-loading":t(p),"is-edit":t(_)},null,8,["v","is-loading","is-edit"]),a(O,null,{default:o(()=>[a(de,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(p),"item-validation-scope":k,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),b("div",we,[b("div",be,[a(ue,{store:t(e),"store-prop":"newEstimate",fields:h.value,type:"Estimate"},null,8,["store","fields"]),a(_e,{type:"Estimate","is-edit":t(_),"is-loading":t(p),store:t(e),"store-prop":"newEstimate","custom-field-scope":k,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(ce,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":$.value},null,8,["store","is-mark-as-default"])]),a(pe,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(p),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Me as default};
