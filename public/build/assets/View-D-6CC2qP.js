import{v as fe,O as he,ax as ke,u as be,j as xe,e as h,k as we,N as Be,K as M,w as r,r as m,n as $e,o as c,L as x,c as d,a,q as p,t as l,M as w,l as Ie,b as t,Q as j,R as F,m as Ce,aA as H}from"./main-DpDYmbyp.js";import{u as Me}from"./ticket-WEWzea-e.js";const Te={key:1,class:"flex justify-center items-center h-64"},Se={key:2,class:"max-w-5xl mx-auto mt-8"},De={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ve={class:"lg:col-span-2 space-y-6"},Pe={class:"flex items-start justify-between mb-4"},Ee={class:"flex-1"},Le={class:"text-2xl font-bold text-gray-900 mb-2"},je={class:"flex items-center space-x-4 text-sm text-gray-600"},Fe={class:"flex items-center"},Ue={class:"flex items-center"},Ae={class:"flex flex-col items-end space-y-2"},Ne={class:"mt-6 p-4 bg-gray-50 rounded-lg"},Re={class:"text-gray-800 whitespace-pre-wrap"},Ye={key:0,class:"mt-4"},ze={class:"flex items-center space-x-2"},He={class:"flex flex-wrap gap-2"},Ge={class:"text-lg font-semibold text-gray-900 mb-4"},Oe={key:0,class:"text-center py-8"},qe={class:"text-gray-500"},Ke={key:1,class:"space-y-4"},Xe={class:"flex items-start justify-between mb-2"},Qe={class:"flex items-center space-x-2"},We={class:"text-sm font-medium text-gray-900"},Je={class:"text-xs text-gray-500"},Ze={class:"text-gray-800 whitespace-pre-wrap"},et={class:"text-lg font-semibold text-gray-900 mb-4"},tt={class:"mt-4 flex items-center justify-between"},st={key:0,class:"mt-4 space-y-2"},at={class:"flex items-center space-x-3"},lt={class:"text-sm font-medium text-gray-900"},ot={class:"text-xs text-gray-500"},nt=["onClick"],rt={key:1,class:"text-center py-8"},it={class:"text-gray-500"},ct={class:"space-y-6"},ut={class:"text-sm font-semibold text-gray-700 mb-4"},dt={class:"text-sm font-semibold text-gray-700 mb-4"},mt={class:"space-y-3 text-sm"},pt={class:"text-gray-600"},_t={class:"font-medium text-gray-900 ml-2"},gt={class:"text-gray-600"},vt={class:"font-medium text-gray-900 ml-2"},yt={class:"text-gray-600"},ft={class:"font-medium text-gray-900 ml-2"},ht={key:0},kt={class:"text-gray-600"},bt={class:"font-medium text-gray-900 ml-2"},xt={class:"text-gray-600"},wt={class:"font-medium text-gray-900 ml-2"},Bt={key:3,class:"text-center py-12"},$t={class:"text-gray-500"},Tt={__name:"View",setup(It){const{t:i}=fe.useI18n(),G=Be(),O=$e(),_=Me(),q=he(),U=ke(),A=be(),o=xe(()=>_.currentTicket),k=h(""),y=h([]),K=h(null),B=h(!1),T=h(""),b=h(null),$=h(null),D=[{label:i("tickets.open"),value:"open"},{label:i("tickets.in_progress"),value:"in_progress"},{label:i("tickets.resolved"),value:"resolved"},{label:i("tickets.closed"),value:"closed"}],N=[{label:i("tickets.low"),value:"low"},{label:i("tickets.normal"),value:"normal"},{label:i("tickets.high"),value:"high"},{label:i("tickets.urgent"),value:"urgent"}],X=e=>{const s={open:"bg-blue-100 text-blue-800",in_progress:"bg-yellow-100 text-yellow-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"};return s[e]||s.open},Q=e=>{const s={low:"bg-gray-100 text-gray-800",normal:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return s[e]||s.normal},W=e=>i(`tickets.${e}`),J=e=>i(`tickets.${e}`),Z=e=>H(e).format("MMM DD, YYYY"),V=e=>H(e).format("MMM DD, YYYY HH:mm"),ee=e=>e?e.split(" ").map(s=>s[0]).join("").toUpperCase().substring(0,2):"?",P=e=>{var s;return e.user_id!==((s=o.value)==null?void 0:s.user_id)},te=e=>e.user_id===q.currentUser.id,se=e=>{const s=Array.from(e.target.files);ae(s)},ae=e=>{for(const s of e){if(s.size>5*1024*1024){A.showNotification({type:"error",message:i("tickets.file_too_large",{filename:s.name})});continue}if(!["image/jpeg","image/png","image/gif","image/webp","application/pdf"].includes(s.type)){A.showNotification({type:"error",message:i("tickets.invalid_file_type",{filename:s.name})});continue}y.value.find(f=>f.name===s.name&&f.size===s.size)||y.value.push(s)}},le=e=>{y.value.splice(e,1)},oe=e=>e.startsWith("image/")?"PhotoIcon":e==="application/pdf"?"DocumentTextIcon":"DocumentIcon",ne=e=>{if(e===0)return"0 Bytes";const s=1024,g=["Bytes","KB","MB","GB"],f=Math.floor(Math.log(e)/Math.log(s));return Math.round(e/Math.pow(s,f)*100)/100+" "+g[f]},re=async()=>{if(!k.value.trim()){T.value=i("tickets.reply_required");return}B.value=!0,T.value="";try{const e=new FormData;e.append("message",k.value),y.value.forEach((s,g)=>{e.append(`attachments[${g}]`,s)}),await _.replyToTicket(o.value.id,e),k.value="",y.value=[]}catch(e){console.error("Error submitting reply:",e)}finally{B.value=!1}},ie=async()=>{if(b.value)try{await _.updateTicket(o.value.id,{status:b.value.value})}catch(e){console.error("Error updating status:",e)}},ce=async()=>{if($.value)try{await _.updateTicket(o.value.id,{priority:$.value.value})}catch(e){console.error("Error updating priority:",e)}},R=async e=>{try{await _.updateTicket(o.value.id,{status:e}),b.value=D.find(s=>s.value===e)}catch(s){console.error("Error updating ticket status:",s)}},ue=()=>{U.openDialog({title:i("general.are_you_sure"),message:i("tickets.confirm_delete"),yesLabel:i("general.yes"),noLabel:i("general.no")}).then(e=>{e&&_.deleteTicket(o.value.id).then(()=>{O.push("/admin/support")})})},de=e=>{console.log("Edit message:",e)},me=e=>{U.openDialog({title:i("general.are_you_sure"),message:i("tickets.confirm_delete_message"),yesLabel:i("general.yes"),noLabel:i("general.no")}).then(s=>{s&&_.deleteMessage(o.value.id,e)})};return we(async()=>{const e=G.params.id;await _.fetchTicket(e),o.value&&(b.value=D.find(s=>s.value===o.value.status),$.value=N.find(s=>s.value===o.value.priority))}),(e,s)=>{const g=m("BaseBreadcrumbItem"),f=m("BaseBreadcrumb"),u=m("BaseIcon"),S=m("BaseButton"),I=m("BaseDropdownItem"),Y=m("BaseDropdown"),pe=m("BasePageHeader"),_e=m("BaseSpinner"),C=m("BaseCard"),ge=m("BaseTextarea"),E=m("BaseInputGroup"),z=m("BaseMultiselect"),ve=m("BasePage");return c(),M(ve,null,{default:r(()=>[o.value?(c(),M(pe,{key:0,title:`#${o.value.id} - ${o.value.title}`},{actions:r(()=>[a(S,{variant:"primary-outline",onClick:s[0]||(s[0]=n=>e.$router.push("/admin/support"))},{default:r(()=>[a(u,{name:"ArrowLeftIcon",class:"h-5 w-5 mr-1"}),p(" "+l(e.$t("general.back")),1)]),_:1}),a(Y,{class:"ml-4"},{activator:r(()=>[a(S,{variant:"primary-outline"},{right:r(n=>[a(u,{name:"ChevronDownIcon",class:w(n.class)},null,8,["class"])]),default:r(()=>[p(l(e.$t("general.actions"))+" ",1)]),_:1})]),default:r(()=>[a(I,{onClick:s[1]||(s[1]=n=>R("resolved"))},{default:r(()=>[a(u,{name:"CheckCircleIcon",class:"h-5 mr-3 text-gray-600"}),p(" "+l(e.$t("tickets.mark_resolved")),1)]),_:1}),a(I,{onClick:s[2]||(s[2]=n=>R("closed"))},{default:r(()=>[a(u,{name:"XCircleIcon",class:"h-5 mr-3 text-gray-600"}),p(" "+l(e.$t("tickets.close_ticket")),1)]),_:1}),a(I,{onClick:ue},{default:r(()=>[a(u,{name:"TrashIcon",class:"h-5 mr-3 text-gray-600"}),p(" "+l(e.$t("general.delete")),1)]),_:1})]),_:1})]),default:r(()=>[a(f,null,{default:r(()=>[a(g,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),a(g,{title:e.$t("tickets.ticket",2),to:"support"},null,8,["title"]),a(g,{title:`#${o.value.id}`,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"])):x("",!0),Ie(_).isFetchingTicket?(c(),d("div",Te,[a(_e)])):o.value?(c(),d("div",Se,[t("div",De,[t("div",Ve,[a(C,{class:"p-6"},{default:r(()=>{var n;return[t("div",Pe,[t("div",Ee,[t("h1",Le,l(o.value.title),1),t("div",je,[t("span",Fe,[a(u,{name:"UserIcon",class:"h-4 w-4 mr-1"}),p(" "+l(((n=o.value.user)==null?void 0:n.name)||"Unknown"),1)]),t("span",Ue,[a(u,{name:"CalendarIcon",class:"h-4 w-4 mr-1"}),p(" "+l(Z(o.value.created_at)),1)])])]),t("div",Ae,[t("span",{class:w([X(o.value.status),"px-3 py-1 text-sm font-medium rounded-full"])},l(W(o.value.status)),3),t("span",{class:w([Q(o.value.priority),"px-3 py-1 text-sm font-medium rounded-full"])},l(J(o.value.priority)),3)])]),t("div",Ne,[t("p",Re,l(o.value.message),1)]),o.value.categories&&o.value.categories.length?(c(),d("div",Ye,[t("div",ze,[a(u,{name:"TagIcon",class:"h-4 w-4 text-gray-500"}),t("div",He,[(c(!0),d(j,null,F(o.value.categories,v=>(c(),d("span",{key:v.id,class:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded"},l(v.name),1))),128))])])])):x("",!0)]}),_:1}),a(C,{class:"p-6"},{default:r(()=>[t("h3",Ge,l(e.$t("tickets.conversation")),1),!o.value.messages||o.value.messages.length===0?(c(),d("div",Oe,[a(u,{name:"ChatBubbleLeftIcon",class:"h-12 w-12 mx-auto text-gray-400 mb-2"}),t("p",qe,l(e.$t("tickets.no_messages")),1)])):(c(),d("div",Ke,[(c(!0),d(j,null,F(o.value.messages,n=>{var v,L;return c(),d("div",{key:n.id,class:w(P(n)?"ml-0 mr-8":"ml-8 mr-0")},[t("div",{class:w([P(n)?"bg-blue-50":"bg-gray-100","rounded-lg p-4"])},[t("div",Xe,[t("div",Qe,[t("div",{class:w([P(n)?"bg-blue-500":"bg-gray-500","h-8 w-8 rounded-full flex items-center justify-center text-white font-medium text-sm"])},l(ee((v=n.user)==null?void 0:v.name)),3),t("div",null,[t("p",We,l(((L=n.user)==null?void 0:L.name)||"Unknown"),1),t("p",Je,l(V(n.created_at)),1)])]),te(n)?(c(),M(Y,{key:0},{activator:r(()=>[a(u,{name:"EllipsisVerticalIcon",class:"h-5 w-5 text-gray-500 cursor-pointer"})]),default:r(()=>[a(I,{onClick:ye=>de(n)},{default:r(()=>[a(u,{name:"PencilIcon",class:"h-4 mr-2 text-gray-600"}),p(" "+l(e.$t("general.edit")),1)]),_:2},1032,["onClick"]),a(I,{onClick:ye=>me(n.id)},{default:r(()=>[a(u,{name:"TrashIcon",class:"h-4 mr-2 text-gray-600"}),p(" "+l(e.$t("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)):x("",!0)]),t("p",Ze,l(n.message),1)],2)],2)}),128))]))]),_:1}),o.value.is_locked?(c(),d("div",rt,[a(u,{name:"LockClosedIcon",class:"h-12 w-12 mx-auto text-gray-400 mb-2"}),t("p",it,l(e.$t("tickets.ticket_locked")),1)])):(c(),M(C,{key:0,class:"p-6"},{default:r(()=>[t("h3",et,l(e.$t("tickets.reply")),1),t("form",{onSubmit:Ce(re,["prevent"])},[a(E,{error:T.value},{default:r(()=>[a(ge,{modelValue:k.value,"onUpdate:modelValue":s[3]||(s[3]=n=>k.value=n),placeholder:e.$t("tickets.type_your_reply"),rows:"6",invalid:!!T.value},null,8,["modelValue","placeholder","invalid"])]),_:1},8,["error"]),t("div",tt,[t("div",null,[t("input",{ref_key:"replyFileInput",ref:K,type:"file",class:"hidden",multiple:"",accept:"image/*,application/pdf",onChange:se},null,544),a(S,{type:"button",variant:"primary-outline",onClick:s[4]||(s[4]=n=>e.$refs.replyFileInput.click())},{default:r(()=>[a(u,{name:"PaperClipIcon",class:"h-5 w-5 mr-1"}),p(" "+l(e.$t("tickets.attach_files")),1)]),_:1})]),a(S,{loading:B.value,disabled:B.value||!k.value.trim(),variant:"primary",type:"submit"},{default:r(()=>[B.value?x("",!0):(c(),M(u,{key:0,name:"PaperAirplaneIcon",class:"h-5 w-5 mr-1"})),p(" "+l(e.$t("tickets.send_reply")),1)]),_:1},8,["loading","disabled"])]),y.value.length?(c(),d("div",st,[(c(!0),d(j,null,F(y.value,(n,v)=>(c(),d("div",{key:v,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[t("div",at,[a(u,{name:oe(n.type),class:"h-5 w-5 text-gray-500"},null,8,["name"]),t("div",null,[t("p",lt,l(n.name),1),t("p",ot,l(ne(n.size)),1)])]),t("button",{type:"button",class:"text-red-500 hover:text-red-700",onClick:L=>le(v)},[a(u,{name:"XMarkIcon",class:"h-5 w-5"})],8,nt)]))),128))])):x("",!0)],32)]),_:1}))]),t("div",ct,[a(C,{class:"p-6"},{default:r(()=>[t("h3",ut,l(e.$t("tickets.ticket_status")),1),a(E,{label:e.$t("tickets.status")},{default:r(()=>[a(z,{modelValue:b.value,"onUpdate:modelValue":[s[5]||(s[5]=n=>b.value=n),ie],options:D},null,8,["modelValue"])]),_:1},8,["label"]),a(E,{label:e.$t("tickets.priority"),class:"mt-4"},{default:r(()=>[a(z,{modelValue:$.value,"onUpdate:modelValue":[s[6]||(s[6]=n=>$.value=n),ce],options:N},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),a(C,{class:"p-6"},{default:r(()=>{var n;return[t("h3",dt,l(e.$t("tickets.ticket_info")),1),t("div",mt,[t("div",null,[t("span",pt,l(e.$t("tickets.ticket_id"))+":",1),t("span",_t,"#"+l(o.value.id),1)]),t("div",null,[t("span",gt,l(e.$t("tickets.created_by"))+":",1),t("span",vt,l((n=o.value.user)==null?void 0:n.name),1)]),t("div",null,[t("span",yt,l(e.$t("tickets.created_at"))+":",1),t("span",ft,l(V(o.value.created_at)),1)]),o.value.updated_at!==o.value.created_at?(c(),d("div",ht,[t("span",kt,l(e.$t("tickets.last_updated"))+":",1),t("span",bt,l(V(o.value.updated_at)),1)])):x("",!0),t("div",null,[t("span",xt,l(e.$t("tickets.replies"))+":",1),t("span",wt,l(o.value.messages_count||0),1)])])]}),_:1})])])])):(c(),d("div",Bt,[t("p",$t,l(e.$t("tickets.ticket_not_found")),1)]))]),_:1})}}};export{Tt as default};
