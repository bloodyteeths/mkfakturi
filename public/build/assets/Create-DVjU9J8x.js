import{u as ue,ay as me,aC as ie,F as ce,G as de,al as ye,H as pe,v as ve,e as w,I as _e,j as h,i as fe,aH as Pe,N as ge,aY as be,c as $e,a as r,w as l,Q as Be,r as u,n as he,a7 as Ce,f as $,aF as Ie,$ as Se,g as M,b5 as Ve,o as C,b as B,m as we,l as t,q,t as P,K as k,L as N,M as G}from"./main-Ds_umSNN.js";import{_ as Me}from"./ExchangeRateConverter-DQhVKOjx.js";import{u as qe}from"./payment-B2rrCZkG.js";import{_ as ke}from"./SelectNotePopup-DmfDwlEW.js";import{_ as Ne}from"./CreateCustomFields-ChvBN4-M.js";import{_ as Ue}from"./PaymentModeModal-CWcN5Al1.js";import"./exchange-rate-DkJi6j9M.js";import"./NoteModal-kweCSBf-.js";import"./dynamic-import-helper-BheWnx7M.js";const De={class:"absolute left-3.5"},Ae={class:"relative w-full"},Fe={class:"relative mt-6"},xe={class:"z-20 float-right text-sm font-semibold leading-5 text-primary-400"},Ee={class:"mb-4 text-sm font-medium text-gray-800"},j="newPayment",Ye={__name:"Create",setup(Ge){const i=ge(),H=he(),e=qe();ue();const I=me();ie();const U=ce(),L=de(),D=ye();pe();const A=Ce("utils"),{t:d}=ve.useI18n();let g=w(!1),S=w(!1),p=w([]);const v=w(null),R=_e(["customer","company","customerCustom","payment","paymentCustom"]),V=h({get:()=>parseInt(U.selectedCompanyCurrency.precision)===0?e.currentPayment.amount:e.currentPayment.amount/100,set:a=>{const n=parseInt(U.selectedCompanyCurrency.precision);e.currentPayment.amount=Math.round(n===0?a:a*100)}}),s=h(()=>e.isFetchingInitialData),c=h(()=>i.name==="payments.edit"),F=h(()=>c.value?d("payments.edit_payment"):d("payments.new_payment")),z=h(()=>({currentPayment:{customer_id:{required:$.withMessage(d("validation.required"),M)},payment_date:{required:$.withMessage(d("validation.required"),M)},amount:{required:$.withMessage(d("validation.required"),M),between:$.withMessage(d("validation.payment_greater_than_due_amount"),Ve(0,e.currentPayment.maxPayableAmount))},exchange_rate:{required:Ie(function(){return $.withMessage(d("validation.required"),M),e.showExchangeRate}),decimal:$.withMessage(d("validation.valid_exchange_rate"),Se)}}})),m=fe(z,e,{$scope:j});Pe(()=>{e.currentPayment.customer_id&&Y(e.currentPayment.customer_id),i.query.customer&&(e.currentPayment.customer_id=i.query.customer)}),e.resetCurrentPayment(),i.query.customer&&(e.currentPayment.customer_id=i.query.customer),e.fetchPaymentInitialData(c.value),i.params.id&&!c.value&&K();async function O(){L.openModal({title:d("settings.payment_modes.add_payment_mode"),componentName:"PaymentModeModal"})}function T(a){e.currentPayment.notes=""+a.notes}async function K(){var n;let a=await D.fetchInvoice((n=i==null?void 0:i.params)==null?void 0:n.id);e.currentPayment.customer_id=a.data.data.customer.id,e.currentPayment.invoice_id=a.data.data.id}async function Q(a){a&&(v.value=p.value.find(n=>n.id===a),e.currentPayment.amount=v.value.due_amount,e.currentPayment.maxPayableAmount=v.value.due_amount)}function Y(a){if(a){let n={customer_id:a,status:"DUE",limit:"all"};c.value&&(n.status=""),S.value=!0,Promise.all([D.fetchInvoices(n),I.fetchCustomer(a)]).then(async([y,_])=>{y&&(p.value=[...y.data.data]),_&&_.data&&(e.currentPayment.selectedCustomer=_.data.data,e.currentPayment.customer=_.data.data,e.currentPayment.currency=_.data.data.currency,c.value&&!I.editCustomer&&e.currentPayment.customer_id&&(I.editCustomer=_.data.data)),e.currentPayment.invoice_id&&(v.value=p.value.find(f=>f.id===e.currentPayment.invoice_id),e.currentPayment.maxPayableAmount=v.value.due_amount+e.currentPayment.amount,V.value===0&&(V.value=v.value.due_amount/100)),c.value&&(p.value=p.value.filter(f=>f.due_amount>0||f.id==e.currentPayment.invoice_id)),S.value=!1}).catch(y=>{S.value=!1,console.error(y,"error")})}}be(()=>{e.resetCurrentPayment(),p.value=[],I.editCustomer=null});async function J(){if(m.value.$touch(),m.value.$invalid)return!1;g.value=!0;let a={...e.currentPayment},n=null;try{n=await(c.value?e.updatePayment:e.addPayment)(a),H.push(`/admin/payments/${n.data.data.id}/view`)}catch{g.value=!1}}function W(a){let n={userId:a};i.params.id&&(n.model_id=i.params.id),e.currentPayment.invoice_id=v.value=null,e.currentPayment.amount=0,p.value=[],e.getNextNumber(n,!0)}return(a,n)=>{const y=u("BaseBreadcrumbItem"),_=u("BaseBreadcrumb"),f=u("BaseIcon"),x=u("BaseButton"),X=u("BasePageHeader"),Z=u("BaseDatePicker"),b=u("BaseInputGroup"),ee=u("BaseInput"),te=u("BaseCustomerSelectInput"),E=u("BaseMultiselect"),ae=u("BaseMoney"),ne=u("BaseSelectAction"),oe=u("BaseInputGrid"),re=u("BaseCustomInput"),le=u("BaseCard"),se=u("BasePage");return C(),$e(Be,null,[r(Ue),r(se,{class:"relative payment-create"},{default:l(()=>[B("form",{action:"",onSubmit:we(J,["prevent"])},[r(X,{title:F.value,class:"mb-5"},{actions:l(()=>[r(x,{loading:t(g),disabled:t(g),variant:"primary",type:"submit",class:"hidden sm:flex"},{left:l(o=>[t(g)?N("",!0):(C(),k(f,{key:0,name:"ArrowDownOnSquareIcon",class:G(o.class)},null,8,["class"]))]),default:l(()=>[q(" "+P(c.value?a.$t("payments.update_payment"):a.$t("payments.save_payment")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[r(_,null,{default:l(()=>[r(y,{title:a.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(y,{title:a.$t("payments.payment",2),to:"/admin/payments"},null,8,["title"]),r(y,{title:F.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(le,null,{default:l(()=>[r(oe,null,{default:l(()=>[r(b,{label:a.$t("payments.date"),"content-loading":s.value,required:"",error:t(m).currentPayment.payment_date.$error&&t(m).currentPayment.payment_date.$errors[0].$message},{default:l(()=>[r(Z,{modelValue:t(e).currentPayment.payment_date,"onUpdate:modelValue":[n[0]||(n[0]=o=>t(e).currentPayment.payment_date=o),n[1]||(n[1]=o=>t(m).currentPayment.payment_date.$touch())],"content-loading":s.value,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:t(m).currentPayment.payment_date.$error},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),r(b,{label:a.$t("payments.payment_number"),"content-loading":s.value,required:""},{default:l(()=>[r(ee,{modelValue:t(e).currentPayment.payment_number,"onUpdate:modelValue":n[2]||(n[2]=o=>t(e).currentPayment.payment_number=o),"content-loading":s.value},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),r(b,{label:a.$t("payments.customer"),error:t(m).currentPayment.customer_id.$error&&t(m).currentPayment.customer_id.$errors[0].$message,"content-loading":s.value,required:""},{default:l(()=>[s.value?N("",!0):(C(),k(te,{key:0,modelValue:t(e).currentPayment.customer_id,"onUpdate:modelValue":[n[3]||(n[3]=o=>t(e).currentPayment.customer_id=o),n[4]||(n[4]=o=>W(t(e).currentPayment.customer_id))],"content-loading":s.value,invalid:t(m).currentPayment.customer_id.$error,placeholder:a.$t("customers.select_a_customer"),"show-action":""},null,8,["modelValue","content-loading","invalid","placeholder"]))]),_:1},8,["label","error","content-loading"]),r(b,{"content-loading":s.value,label:a.$t("payments.invoice"),"help-text":v.value?`${t(d)("payments.amount_due")}: ${t(e).currentPayment.maxPayableAmount/100}`:""},{default:l(()=>[r(E,{modelValue:t(e).currentPayment.invoice_id,"onUpdate:modelValue":n[5]||(n[5]=o=>t(e).currentPayment.invoice_id=o),"content-loading":s.value,"value-prop":"id","track-by":"invoice_number",label:"invoice_number",options:t(p),loading:t(S),placeholder:a.$t("invoices.select_invoice"),onSelect:Q},{singlelabel:l(({value:o})=>[B("div",De,P(o.invoice_number)+" ("+P(t(A).formatMoney(o.total,o.customer.currency))+") ",1)]),option:l(({option:o})=>[q(P(o.invoice_number)+" ("+P(t(A).formatMoney(o.total,o.customer.currency))+") ",1)]),_:1},8,["modelValue","content-loading","options","loading","placeholder"])]),_:1},8,["content-loading","label","help-text"]),r(b,{label:a.$t("payments.amount"),"content-loading":s.value,error:t(m).currentPayment.amount.$error&&t(m).currentPayment.amount.$errors[0].$message,required:""},{default:l(()=>[B("div",Ae,[(C(),k(ae,{key:t(e).currentPayment.currency,modelValue:V.value,"onUpdate:modelValue":[n[6]||(n[6]=o=>V.value=o),n[7]||(n[7]=o=>t(m).currentPayment.amount.$touch())],currency:t(e).currentPayment.currency,"content-loading":s.value,invalid:t(m).currentPayment.amount.$error},null,8,["modelValue","currency","content-loading","invalid"]))])]),_:1},8,["label","content-loading","error"]),r(b,{"content-loading":s.value,label:a.$t("payments.payment_mode")},{default:l(()=>[r(E,{modelValue:t(e).currentPayment.payment_method_id,"onUpdate:modelValue":n[8]||(n[8]=o=>t(e).currentPayment.payment_method_id=o),"content-loading":s.value,label:"name","value-prop":"id","track-by":"name",options:t(e).paymentModes,placeholder:a.$t("payments.select_payment_mode"),searchable:""},{action:l(()=>[r(ne,{onClick:O},{default:l(()=>[r(f,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),q(" "+P(a.$t("settings.payment_modes.add_payment_mode")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),r(Me,{store:t(e),"store-prop":"currentPayment",v:t(m).currentPayment,"is-loading":s.value,"is-edit":c.value,"customer-currency":t(e).currentPayment.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1}),r(Ne,{type:"Payment","is-edit":c.value,"is-loading":s.value,store:t(e),"store-prop":"currentPayment","custom-field-scope":j,class:"mt-6"},null,8,["is-edit","is-loading","store"]),B("div",Fe,[B("div",xe,[r(ke,{type:"Payment",onSelect:T})]),B("label",Ee,P(a.$t("estimates.notes")),1),r(re,{modelValue:t(e).currentPayment.notes,"onUpdate:modelValue":n[9]||(n[9]=o=>t(e).currentPayment.notes=o),"content-loading":s.value,fields:R,class:"mt-1"},null,8,["modelValue","content-loading","fields"])]),r(x,{loading:t(g),"content-loading":s.value,variant:"primary",type:"submit",class:"flex justify-center w-full mt-4 sm:hidden md:hidden"},{left:l(o=>[t(g)?N("",!0):(C(),k(f,{key:0,name:"ArrowDownOnSquareIcon",class:G(o.class)},null,8,["class"]))]),default:l(()=>[q(" "+P(c.value?a.$t("payments.update_payment"):a.$t("payments.save_payment")),1)]),_:1},8,["loading","content-loading"])]),_:1})],32)]),_:1})],64)}}};export{Ye as default};
