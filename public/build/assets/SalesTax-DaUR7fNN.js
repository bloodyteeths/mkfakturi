import{aN as ee,G as X,O as ae,e as W,I as me,a7 as ne,v as H,j as P,P as Q,r as _,c as v,o as a,b as n,a as s,t as $,a8 as he,w as c,l as f,q as V,K as T,Q as Y,L as U,F as K,aM as pe,N as $e,S as J,f as N,aD as te,b5 as we,g as G,i as re,R as Z,V as le,aJ as ye,bb as Ie,aH as ke,bc as Be,M as R,T as Pe,bd as Se,be as Te,bf as Ce,aL as Me,u as De,J as Ve,k as fe,m as xe,H as je}from"./main-DpDYmbyp.js";import{D as qe,d as Ee}from"./DragIcon-CeeWVm9Y.js";import{_ as Ae}from"./SelectNotePopup-DUO919h6.js";const Le={class:"flex items-center justify-between mb-3"},Oe={class:"flex items-center text-base",style:{flex:"4"}},Ue={class:"pr-2 mb-0",align:"right"},Ne={class:"absolute left-3.5"},ze={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},Fe={class:"text-sm text-right",style:{flex:"3"}},Ye={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Ge={__name:"CreateItemRowTax",props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(t,{emit:h}){const e=t,i=h,I=ee(),b=X(),u=ae(),k=W(null),B=me({...e.taxData});ne("utils");const{t:y}=H.useI18n(),D=P(()=>I.taxTypes.map(l=>({...l})).map(l=>(e.taxes.find(p=>p.tax_type_id===l.id)?l.disabled=!0:l.disabled=!1,l))),q=P(()=>{if(B.calculation_type==="fixed")return B.fixed_amount;if(e.discountedTotal){const m=e.store[e.storeProp].tax_per_item==="YES",l=e.store[e.storeProp].discount_per_item==="YES";return m&&!l?d():e.discountedTotal*B.percent/100}return 0});Q(()=>e.discountedTotal,()=>{E()}),Q(()=>e.totalTax,()=>{E()}),Q(()=>q.value,()=>{E()}),e.taxData.tax_type_id>0&&(k.value=I.taxTypes.find(m=>m.id===e.taxData.tax_type_id)),E();function A(m){B.calculation_type=m.calculation_type,B.percent=m.calculation_type==="percentage"?m.percent:null,B.fixed_amount=m.calculation_type==="fixed"?m.fixed_amount:null,B.tax_type_id=m.id,B.name=m.name,E()}function E(){B.tax_type_id!==0&&i("update",{index:e.index,item:{...B,amount:q.value}})}function o(){let m={itemIndex:e.itemIndex,taxIndex:e.index};b.openModal({title:y("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:m,size:"sm"})}function x(m){e.store.$patch(l=>{l[e.storeProp].items[e.itemIndex].taxes.splice(m,1),l[e.storeProp].items[e.itemIndex].tax=0,l[e.storeProp].items[e.itemIndex].totalTax=0})}function d(){if(B.calculation_type==="fixed")return B.fixed_amount;let m=0,l=0;const r=e.discountedTotal,p=e.store[e.storeProp].discount?e.store[e.storeProp].discount:0,C=e.store[e.storeProp].discount_type;if(p>0){e.store[e.storeProp].items.forEach(w=>{m+=w.total});const S=(r/m).toFixed(2);l=C==="fixed"?p*100:m*p/100;const j=Math.round(l*S),M=r-j;return Math.round(M*B.percent/100)}return Math.round(e.discountedTotal*B.percent/100)}return(m,l)=>{const r=_("BaseFormatMoney"),p=_("BaseIcon"),C=_("BaseMultiselect");return a(),v("div",Le,[n("div",Oe,[n("label",Ue,$(m.$t("invoices.item.tax")),1),s(C,{modelValue:k.value,"onUpdate:modelValue":[l[0]||(l[0]=S=>k.value=S),l[1]||(l[1]=S=>A(S))],"value-prop":"id",options:D.value,placeholder:m.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},he({singlelabel:c(({value:S})=>[n("div",Ne,[V($(S.name)+" - ",1),S.calculation_type==="fixed"?(a(),T(r,{key:0,amount:S.fixed_amount,currency:t.currency},null,8,["amount","currency"])):(a(),v(Y,{key:1},[V($(S.percent)+" % ",1)],64))])]),option:c(({option:S})=>[V($(S.name)+" - ",1),S.calculation_type==="fixed"?(a(),T(r,{key:0,amount:S.fixed_amount,currency:t.currency},null,8,["amount","currency"])):(a(),v(Y,{key:1},[V($(S.percent)+" % ",1)],64))]),_:2},[f(u).hasAbilities(t.ability)?{name:"action",fn:c(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:o},[s(p,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",ze,$(m.$t("invoices.add_new_tax")),1)])]),key:"0"}:void 0]),1032,["modelValue","options","placeholder"]),l[3]||(l[3]=n("br",null,null,-1))]),n("div",Fe,[s(r,{amount:q.value,currency:t.currency},null,8,["amount","currency"])]),n("div",Ye,[t.taxes.length&&t.index!==t.taxes.length-1?(a(),T(p,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:l[2]||(l[2]=S=>x(t.index))})):U("",!0)])])}}},Re={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},We={colspan:"5",class:"p-0 text-left align-top"},Xe={class:"w-full"},He={key:0,style:{width:"15%","min-width":"160px"}},Je={class:"px-5 py-4 text-left align-top"},Ke={class:"flex justify-start"},Qe={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},Ze={class:"px-5 py-4 text-right align-top"},et={class:"px-5 py-4 text-left align-top"},tt={class:"flex flex-col"},ot={class:"flex-auto flex-fill bd-highlight"},st={class:"relative w-full"},at={key:0,class:"px-5 py-4 text-left align-top"},nt={class:"flex flex-col"},rt={class:"flex",style:{width:"120px"},role:"group"},lt={class:"flex items-center"},it={class:"px-5 py-4 text-right align-top"},dt={class:"flex items-center justify-end text-sm"},ut={class:"flex items-center justify-center w-6 h-10 mx-2"},ct={key:0},mt={colspan:"4",class:"px-5 py-4 text-left align-top"},pt={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(t,{emit:h}){const e=t,i=K(),I=pe();$e();const{t:b}=H.useI18n(),u=P({get:()=>e.itemData.quantity,set:w=>{M("quantity",parseFloat(w))}}),k=P({get:()=>{const w=e.itemData.price??0;return parseInt(q.value.precision)===0?w:w/100},set:w=>{const g=w??0,L=parseInt(q.value.precision);let z=Math.round(L===0?g:g*100);M("price",z),l()}}),B=P(()=>Math.round(e.itemData.price*e.itemData.quantity)),y=P({get:()=>e.itemData.discount,set:w=>{M("discount",w),l()}}),D=P(()=>B.value-e.itemData.discount_val),q=P(()=>e.currency?e.currency:i.selectedCompanyCurrency),A=P(()=>e.store[e.storeProp].items.length!=1),E=P(()=>Math.round(J.sumBy(e.itemData.taxes,function(w){return w.amount?w.amount:0}))),o=P(()=>E.value),x={name:{required:N.withMessage(b("validation.required"),G)},quantity:{required:N.withMessage(b("validation.required"),G),maxLength:N.withMessage(b("validation.amount_maxlength"),te(20))},price:{required:N.withMessage(b("validation.required"),G),maxLength:N.withMessage(b("validation.price_maxlength"),te(20))},discount_val:{between:N.withMessage(b("validation.discount_maxlength"),we(0,P(()=>Math.abs(B.value))))},description:{maxLength:N.withMessage(b("validation.notes_maxlength"),te(65e3))}},d=re(x,P(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function m(w){e.store.$patch(L=>{L[e.storeProp].items[e.index].taxes[w.index]=w.item});let g=e.itemData.taxes[e.itemData.taxes.length-1];(g==null?void 0:g.tax_type_id)!==0&&e.store.$patch(L=>{L[e.storeProp].items[e.index].taxes.push({...Ie,id:ye.raw()})}),j()}function l(){const w=e.store[e.storeProp].items[e.index].discount,g=Math.abs(B.value);e.itemData.discount_type==="percentage"?M("discount_val",Math.round(g*w/100)):M("discount_val",Math.min(Math.round(w*100),g))}function r(w){M("name",w)}function p(w){e.store.$patch(g=>{if(g[e.storeProp].items[e.index].name=w.name,g[e.storeProp].items[e.index].price=w.price,g[e.storeProp].items[e.index].item_id=w.id,g[e.storeProp].items[e.index].description=w.description,g[e.storeProp].items[e.index].sku=w.sku,g[e.storeProp].items[e.index].barcode=w.barcode,w.unit&&(g[e.storeProp].items[e.index].unit_name=w.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&w.taxes){let L=0;w.taxes.forEach(z=>{m({index:L,item:{...z}}),L++})}g[e.storeProp].exchange_rate&&(g[e.storeProp].items[e.index].price/=g[e.storeProp].exchange_rate)}),I.fetchItems(),j()}function C(){e.itemData.discount_type!=="fixed"&&(M("discount_val",Math.round(e.itemData.discount*100)),M("discount_type","fixed"))}function S(){e.itemData.discount_type!=="percentage"&&(M("discount_val",B.value*e.itemData.discount/100),M("discount_type","percentage"))}function j(){var L,z;let w=(z=(L=e.store[e.storeProp])==null?void 0:L.items[e.index])==null?void 0:z.taxes;w||(w=[]);let g={...e.store[e.storeProp].items[e.index],index:e.index,total:D.value,sub_total:B.value,totalSimpleTax:E.value,totalTax:o.value,tax:o.value,taxes:[...w],tax_type_ids:w.flatMap(O=>O.tax_type_id?O.tax_type_id:[])};e.store.updateItem(g)}function M(w,g){e.store.$patch(L=>{L[e.storeProp].items[e.index][w]=g}),j()}return(w,g)=>{const L=_("BaseItemSelect"),z=_("BaseInput"),O=_("BaseMoney"),ie=_("BaseIcon"),_e=_("BaseButton"),de=_("BaseDropdownItem"),ge=_("BaseDropdown"),ue=_("BaseContentPlaceholdersText"),ce=_("BaseContentPlaceholders"),ve=_("BaseFormatMoney");return a(),v("tr",Re,[n("td",We,[n("table",Xe,[n("colgroup",null,[g[6]||(g[6]=n("col",{style:{width:"40%","min-width":"280px"}},null,-1)),g[7]||(g[7]=n("col",{style:{width:"10%","min-width":"120px"}},null,-1)),g[8]||(g[8]=n("col",{style:{width:"15%","min-width":"120px"}},null,-1)),t.store[t.storeProp].discount_per_item==="YES"?(a(),v("col",He)):U("",!0),g[9]||(g[9]=n("col",{style:{width:"15%","min-width":"120px"}},null,-1))]),n("tbody",null,[n("tr",null,[n("td",Je,[n("div",Ke,[n("div",Qe,[s(qe)]),s(L,{type:"Invoice",item:t.itemData,invalid:f(d).name.$error,"invalid-description":f(d).description.$error,taxes:t.itemData.taxes,index:t.index,"store-prop":t.storeProp,store:t.store,onSearch:r,onSelect:p},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",Ze,[s(z,{modelValue:u.value,"onUpdate:modelValue":g[0]||(g[0]=F=>u.value=F),invalid:f(d).quantity.$error,"content-loading":t.loading,type:"number",small:"",step:"any",onChange:g[1]||(g[1]=F=>j()),onInput:g[2]||(g[2]=F=>f(d).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",et,[n("div",tt,[n("div",ot,[n("div",st,[(a(),T(O,{key:q.value,modelValue:k.value,"onUpdate:modelValue":g[3]||(g[3]=F=>k.value=F),invalid:f(d).price.$error,"content-loading":t.loading,currency:q.value},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),t.store[t.storeProp].discount_per_item==="YES"?(a(),v("td",at,[n("div",nt,[n("div",rt,[s(z,{modelValue:y.value,"onUpdate:modelValue":g[4]||(g[4]=F=>y.value=F),invalid:f(d).discount_val.$error,"content-loading":t.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),s(ge,{position:"bottom-end"},{activator:c(()=>[s(_e,{"content-loading":t.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[n("span",lt,[V($(t.itemData.discount_type=="fixed"?t.currency.symbol:"%")+" ",1),s(ie,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:c(()=>[s(de,{onClick:C},{default:c(()=>[V($(w.$t("general.fixed")),1)]),_:1}),s(de,{onClick:S},{default:c(()=>[V($(w.$t("general.percentage")),1)]),_:1})]),_:1})])])])):U("",!0),n("td",it,[n("div",dt,[n("span",null,[t.loading?(a(),T(ce,{key:0},{default:c(()=>[s(ue,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),T(ve,{key:1,amount:D.value,currency:q.value},null,8,["amount","currency"]))]),n("div",ut,[A.value?(a(),T(ie,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:g[5]||(g[5]=F=>t.store.removeItem(t.index))})):U("",!0)])])])]),t.store[t.storeProp].tax_per_item==="YES"?(a(),v("tr",ct,[g[10]||(g[10]=n("td",{class:"px-5 py-4 text-left align-top"},null,-1)),n("td",mt,[t.loading?(a(),T(ce,{key:0},{default:c(()=>[s(ue,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(a(!0),v(Y,{key:1},Z(t.itemData.taxes,(F,be)=>(a(),T(Ge,{key:F.id,index:be,"item-index":t.index,"tax-data":F,taxes:t.itemData.taxes,"discounted-total":D.value,"total-tax":E.value,total:B.value,currency:t.currency,"update-items":j,ability:f(le).CREATE_INVOICE,store:t.store,"store-prop":t.storeProp,discount:y.value,onUpdate:m},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):U("",!0)])])])])}}},yt={class:"text-center item-table min-w-full"},ft={key:0,style:{width:"15%","min-width":"160px"}},xt={class:"bg-white border border-gray-200 border-solid"},_t={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},gt={key:1,class:"pl-7"},vt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},bt={key:1},ht={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},$t={key:1},wt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},It={key:1},kt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Bt={key:1,class:"pr-10 column-heading"},Do={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(t){const h=t,e=K(),i=P(()=>h.currency?h.currency:e.selectedCompanyCurrency);return(I,b)=>{const u=_("BaseContentPlaceholdersText"),k=_("BaseContentPlaceholders"),B=_("BaseIcon");return a(),v(Y,null,[n("table",yt,[n("colgroup",null,[b[2]||(b[2]=n("col",{style:{width:"40%","min-width":"280px"}},null,-1)),b[3]||(b[3]=n("col",{style:{width:"10%","min-width":"120px"}},null,-1)),b[4]||(b[4]=n("col",{style:{width:"15%","min-width":"120px"}},null,-1)),t.store[t.storeProp].discount_per_item==="YES"?(a(),v("col",ft)):U("",!0),b[5]||(b[5]=n("col",{style:{width:"15%","min-width":"120px"}},null,-1))]),n("thead",xt,[n("tr",null,[n("th",_t,[t.isLoading?(a(),T(k,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("span",gt,$(I.$t("items.item",2)),1))]),n("th",vt,[t.isLoading?(a(),T(k,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("span",bt,$(I.$t("invoices.item.quantity")),1))]),n("th",ht,[t.isLoading?(a(),T(k,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("span",$t,$(I.$t("invoices.item.price")),1))]),t.store[t.storeProp].discount_per_item==="YES"?(a(),v("th",wt,[t.isLoading?(a(),T(k,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("span",It,$(I.$t("invoices.item.discount")),1))])):U("",!0),n("th",kt,[t.isLoading?(a(),T(k,{key:0},{default:c(()=>[s(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("span",Bt,$(I.$t("invoices.item.amount")),1))])])]),s(f(Ee),{modelValue:t.store[t.storeProp].items,"onUpdate:modelValue":b[0]||(b[0]=y=>t.store[t.storeProp].items=y),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:y,index:D})=>[(a(),T(pt,{key:y.id,index:D,"item-data":y,loading:t.isLoading,currency:i.value,"item-validation-scope":t.itemValidationScope,"invoice-items":t.store[t.storeProp].items,store:t.store,"store-prop":t.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:b[1]||(b[1]=(...y)=>t.store.addItem&&t.store.addItem(...y))},[s(B,{name:"PlusCircleIcon",class:"mr-2"}),V(" "+$(I.$t("general.add_new_item")),1)])],64)}}},Pt={class:"flex items-center justify-between w-full mt-2 text-sm"},St={key:0,class:"font-semibold leading-5 text-gray-500 uppercase"},Tt={key:1,class:"font-semibold leading-5 text-gray-500 uppercase"},Ct={class:"flex items-center justify-center text-lg text-black"},Mt={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(t,{emit:h}){const e=t,i=h;ne("$utils");const I=P(()=>e.tax.calculation_type==="fixed"?e.tax.fixed_amount:e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);ke(()=>{e.store.getSubtotalWithDiscount&&b(),e.store.getTotalSimpleTax&&b()});function b(){i("update",{...e.tax,amount:I.value})}return(u,k)=>{const B=_("BaseFormatMoney"),y=_("BaseIcon");return a(),v("div",Pt,[t.tax.calculation_type==="percentage"?(a(),v("label",St,$(t.tax.name)+" ("+$(t.tax.percent)+" %) ",1)):(a(),v("label",Tt,[V($(t.tax.name)+" (",1),s(B,{amount:t.tax.fixed_amount,currency:t.currency},null,8,["amount","currency"]),k[1]||(k[1]=V(") ",-1))])),n("label",Ct,[s(B,{amount:t.tax.amount,currency:t.currency},null,8,["amount","currency"]),s(y,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:k[0]||(k[0]=D=>u.$emit("remove",t.tax.id))})])])}}},Dt={class:"w-full mt-4 tax-select"},Vt={class:"relative w-full max-w-md px-4"},jt={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},qt={class:"relative bg-white"},Et={class:"relative p-4"},At={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Lt=["onClick"],Ot={class:"flex justify-between px-2"},Ut={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},Nt={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},zt={key:1,class:"flex justify-center p-5 text-gray-400"},Ft={class:"text-base text-gray-500 cursor-pointer"},Yt={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},Gt={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(t,{emit:h}){const e=t,i=h,I=X(),b=ee(),u=ae(),k=K(),{t:B}=H.useI18n(),y=W(null),D=P(()=>y.value?b.taxTypes.filter(function(o){return o.name.toLowerCase().indexOf(y.value.toLowerCase())!==-1}):b.taxTypes),q=P(()=>e.store[e.storeProp].taxes);function A(o,x){i("select:taxType",{...o}),x()}function E(){I.openModal({title:B("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:o=>i("select:taxType",o)})}return(o,x)=>{const d=_("BaseIcon"),m=_("BaseInput");return a(),v("div",Dt,[s(f(Ce),{class:"relative"},{default:c(({isOpen:l})=>[s(f(Be),{class:R([l?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[s(d,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),V(" "+$(o.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",Vt,[s(Pe,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[s(f(Se),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:r})=>[n("div",jt,[n("div",qt,[n("div",Et,[s(m,{modelValue:y.value,"onUpdate:modelValue":x[0]||(x[0]=p=>y.value=p),placeholder:o.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),D.value.length>0?(a(),v("div",At,[(a(!0),v(Y,null,Z(D.value,(p,C)=>(a(),v("div",{key:C,class:R([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":q.value.find(S=>S.tax_type_id===p.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:S=>A(p,r)},[n("div",Ot,[n("label",Ut,$(p.name),1),n("label",Nt,[p.calculation_type==="fixed"?(a(),T(Te,{key:0,amount:p.fixed_amount,currency:f(k).selectedCompanyCurrency},null,8,["amount","currency"])):(a(),v(Y,{key:1},[V($(p.percent)+" % ",1)],64))])])],10,Lt))),128))])):(a(),v("div",zt,[n("label",Ft,$(o.$t("general.no_tax_found")),1)]))]),f(u).hasAbilities(f(le).CREATE_TAX_TYPE)?(a(),v("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:E},[s(d,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",Yt,$(o.$t("estimates.add_new_tax")),1)])):U("",!0)])]),_:1})]),_:1})])]),_:1})])}}},Rt={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},Wt={class:"flex items-center justify-between w-full"},Xt={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},Ht={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Jt={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},Kt={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Qt={key:0,class:"flex items-center justify-between w-full mt-2"},Zt={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},eo={key:3,class:"flex",style:{width:"140px"},role:"group"},to={class:"flex items-center"},oo={key:1},so={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},ao={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},no={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Vo={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){const h=W(null),e=t;ne("$utils");const i=K();Q(()=>e.store[e.storeProp].items,o=>{B()},{deep:!0});const I=P({get:()=>e.store[e.storeProp].discount,set:o=>{e.store[e.storeProp].discount=o,B()}}),b=P({get:()=>e.store[e.storeProp].taxes,set:o=>{e.store.$patch(x=>{x[e.storeProp].taxes=o})}}),u=P(()=>{let o=[];return e.store[e.storeProp].items.forEach(x=>{x.taxes&&x.taxes.forEach(d=>{let m=o.find(l=>l.tax_type_id===d.tax_type_id);m?m.amount+=d.amount:d.tax_type_id&&o.push({tax_type_id:d.tax_type_id,amount:Math.round(d.amount),percent:d.percent,name:d.name,calculation_type:d.calculation_type,fixed_amount:d.fixed_amount})})}),o}),k=P(()=>e.currency?e.currency:i.selectedCompanyCurrency);function B(){const o=e.store[e.storeProp].discount;if(e.store[e.storeProp].discount_type==="percentage"){e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*o/100);return}e.store[e.storeProp].discount_val=Math.round(o*100)}function y(){e.store[e.storeProp].discount_type!=="fixed"&&(e.store[e.storeProp].discount_val=Math.round(e.store[e.storeProp].discount*100),e.store[e.storeProp].discount_type="fixed")}function D(){if(e.store[e.storeProp].discount_type==="percentage")return;const o=Math.round(e.store[e.storeProp].discount*100)/100;e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*o/100),e.store[e.storeProp].discount_type="percentage"}function q(o){let x=0;o.calculation_type==="percentage"&&e.store.getSubtotalWithDiscount&&o.percent?x=Math.round(e.store.getSubtotalWithDiscount*o.percent/100):o.calculation_type==="fixed"&&(x=o.fixed_amount);let d={...le,id:ye.raw(),name:o.name,percent:o.percent,tax_type_id:o.id,amount:x,calculation_type:o.calculation_type,fixed_amount:o.fixed_amount};e.store.$patch(m=>{m[e.storeProp].taxes.push({...d})})}function A(o){const x=e.store[e.storeProp].taxes.find(d=>d.id===o.id);x&&Object.assign(x,{...o})}function E(o){const x=e.store[e.storeProp].taxes.findIndex(d=>d.id===o);e.store.$patch(d=>{d[e.storeProp].taxes.splice(x,1)})}return(o,x)=>{const d=_("BaseContentPlaceholdersText"),m=_("BaseContentPlaceholders"),l=_("BaseFormatMoney"),r=_("BaseInput"),p=_("BaseIcon"),C=_("BaseButton"),S=_("BaseDropdownItem"),j=_("BaseDropdown");return a(),v("div",Rt,[n("div",Wt,[t.isLoading?(a(),T(m,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("label",Xt,$(o.$t("estimates.sub_total")),1)),t.isLoading?(a(),T(m,{key:2},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("label",Ht,[s(l,{amount:t.store.getSubTotal,currency:k.value},null,8,["amount","currency"])]))]),(a(!0),v(Y,null,Z(u.value,M=>(a(),v("div",{key:M.tax_type_id,class:"flex items-center justify-between w-full"},[t.isLoading?(a(),T(m,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(a(),v("label",Jt,[M.calculation_type==="percentage"?(a(),v(Y,{key:0},[V($(M.name)+" - "+$(M.percent)+"% ",1)],64)):(a(),v(Y,{key:1},[V($(M.name)+" - ",1),s(l,{amount:M.fixed_amount,currency:k.value},null,8,["amount","currency"])],64))])):U("",!0),t.isLoading?(a(),T(m,{key:2},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(a(),v("label",Kt,[s(l,{amount:M.amount,currency:k.value},null,8,["amount","currency"])])):U("",!0)]))),128)),t.store[t.storeProp].discount_per_item==="NO"||t.store[t.storeProp].discount_per_item===null?(a(),v("div",Qt,[t.isLoading?(a(),T(m,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("label",Zt,$(o.$t("estimates.discount")),1)),t.isLoading?(a(),T(m,{key:2},{default:c(()=>[s(d,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(a(),v("div",eo,[s(r,{modelValue:I.value,"onUpdate:modelValue":x[0]||(x[0]=M=>I.value=M),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),s(j,{position:"bottom-end"},{activator:c(()=>[s(C,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:c(()=>[n("span",to,[V($(t.store[t.storeProp].discount_type=="fixed"?k.value.symbol:"%")+" ",1),s(p,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:c(()=>[s(S,{onClick:y},{default:c(()=>[V($(o.$t("general.fixed")),1)]),_:1}),s(S,{onClick:D},{default:c(()=>[V($(o.$t("general.percentage")),1)]),_:1})]),_:1})]))])):U("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(a(),v("div",oo,[(a(!0),v(Y,null,Z(b.value,(M,w)=>(a(),T(Mt,{key:M.id,index:w,tax:M,taxes:b.value,currency:t.currency,store:t.store,onRemove:E,onUpdate:A},null,8,["index","tax","taxes","currency","store"]))),128))])):U("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(a(),v("div",{key:2,ref_key:"taxModal",ref:h,class:"float-right pt-2 pb-4"},[s(Gt,{"store-prop":t.storeProp,store:t.store,type:t.taxPopupType,"onSelect:taxType":q},null,8,["store-prop","store","type"])],512)):U("",!0),n("div",so,[t.isLoading?(a(),T(m,{key:0},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("label",ao,$(o.$t("estimates.total"))+" "+$(o.$t("estimates.amount"))+":",1)),t.isLoading?(a(),T(m,{key:2},{default:c(()=>[s(d,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),v("label",no,[s(l,{amount:t.store.getTotal,currency:k.value},null,8,["amount","currency"])]))])])}}},ro={class:"flex text-gray-800 font-medium text-sm mb-2"},jo={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(t){const h=t,e=X(),{t:i}=H.useI18n();function I(){let b="";h.storeProp=="newEstimate"?b=i("estimates.mark_as_default_estimate_template_description"):h.storeProp=="newInvoice"&&(b=i("invoices.mark_as_default_invoice_template_description")),e.openModal({title:i("general.choose_template"),componentName:"SelectTemplate",data:{templates:h.store.templates,store:h.store,storeProp:h.storeProp,isMarkAsDefault:h.isMarkAsDefault,markAsDefaultDescription:b}})}return(b,u)=>{const k=_("BaseIcon"),B=_("BaseButton");return a(),v("div",null,[n("label",ro,[V($(b.$t("general.select_template"))+" ",1),u[0]||(u[0]=n("span",{class:"text-sm text-red-500"}," *",-1))]),s(B,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:I},{right:c(y=>[s(k,{name:"PencilIcon",class:R(y.class)},null,8,["class"])]),default:c(()=>[V(" "+$(t.store[t.storeProp].template_name),1)]),_:1})])}}},lo={class:"mb-6"},io={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},uo={class:"text-gray-800 font-medium mb-4 text-sm"},qo={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(t){const h=t;function e(i){h.store[h.storeProp].notes=""+i.notes}return(i,I)=>{const b=_("BaseCustomInput");return a(),v("div",lo,[n("div",io,[s(Ae,{type:t.type,onSelect:e},null,8,["type"])]),n("label",uo,$(i.$t("invoices.notes")),1),s(b,{modelValue:t.store[t.storeProp].notes,"onUpdate:modelValue":I[0]||(I[0]=u=>t.store[t.storeProp].notes=u),"content-loading":t.store.isFetchingInitialSettings,fields:t.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},co={class:"flex justify-between w-full"},mo={class:"px-8 py-8 sm:p-6"},po={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},yo=["onClick"],fo=["src","alt"],xo=["alt","src"],_o={key:1,class:"z-0 flex ml-3 pt-5"},go={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Eo={__name:"SelectTemplateModal",setup(t){const h=X(),e=ae(),i=W(""),I=P(()=>h.active&&h.componentName==="SelectTemplate"),b=P(()=>h.title);function u(){h.data.store[h.data.storeProp].template_name?i.value=h.data.store[h.data.storeProp].template_name:i.value=h.data.templates[0]}async function k(){await h.data.store.setTemplate(i.value),!h.data.store.isEdit&&h.data.isMarkAsDefault&&(h.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:i.value}}):h.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:i.value}})),y()}function B(){return new URL("/build/assets/tick-BkKo8A3q.png",import.meta.url)}function y(){h.closeModal(),setTimeout(()=>{h.$reset()},300)}return(D,q)=>{const A=_("BaseIcon"),E=_("BaseCheckbox"),o=_("BaseButton"),x=_("BaseModal");return a(),T(x,{show:I.value,onClose:y,onOpen:u},{header:c(()=>[n("div",co,[V($(b.value)+" ",1),s(A,{name:"XMarkIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:y})])]),default:c(()=>[n("div",mo,[f(h).data?(a(),v("div",po,[(a(!0),v(Y,null,Z(f(h).data.templates,(d,m)=>(a(),v("div",{key:m,class:R([{"border border-solid border-primary-500":i.value===d.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:l=>i.value=d.name},[n("img",{src:d.path,alt:d.name,class:"w-full min-h-[100px]"},null,8,fo),i.value===d.name?(a(),v("img",{key:0,alt:d.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:B()},null,8,xo)):U("",!0),n("span",{class:R(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":i.value===d.name,"text-gray-600":i.value!=d.name}])},$(d.name),3)],10,yo))),128))])):U("",!0),f(h).data.store.isEdit?U("",!0):(a(),v("div",_o,[s(E,{modelValue:f(h).data.isMarkAsDefault,"onUpdate:modelValue":q[0]||(q[0]=d=>f(h).data.isMarkAsDefault=d),"set-initial-value":!1,variant:"primary",label:D.$t("general.mark_as_default"),description:f(h).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),n("div",go,[s(o,{class:"mr-3",variant:"primary-outline",onClick:y},{default:c(()=>[V($(D.$t("general.cancel")),1)]),_:1}),s(o,{variant:"primary",onClick:q[1]||(q[1]=d=>k())},{left:c(d=>[s(A,{name:"ArrowDownOnSquareIcon",class:R(d.class)},null,8,["class"])]),default:c(()=>[V(" "+$(D.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},vo={class:"flex justify-between w-full"},bo={class:"item-modal"},ho={class:"px-8 py-8 sm:p-6"},$o={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ao={__name:"ItemModal",emits:["newItem"],setup(t,{emit:h}){const e=X(),i=pe(),I=K(),b=ee();Me(),De();const{t:u}=H.useI18n(),k=W(!1),B=W(I.selectedCompanySettings.tax_per_item),y=P(()=>e.active&&e.componentName==="ItemModal"),D=P({get:()=>{const l=parseInt(I.selectedCompanyCurrency.precision),r=i.currentItem.price??0;return l===0?r:r/100},set:l=>{const r=l??0;parseInt(I.selectedCompanyCurrency.precision)===0?i.currentItem.price=Math.round(r):i.currentItem.price=Math.round(r*100)}}),q=P({get:()=>i.currentItem.taxes.map(l=>{if(l)return{...l,tax_type_id:l.id,tax_name:l.name+" ("+(l.calculation_type==="fixed"?l.fixed_amount:l.percent)+(l.calculation_type==="fixed"?I.selectedCompanyCurrency.symbol:"%")+")"}}),set:l=>{i.$patch(r=>{r.currentItem.taxes=l})}}),A=P(()=>B.value==="YES"),E={name:{required:N.withMessage(u("validation.required"),G),minLength:N.withMessage(u("validation.name_min_length",{count:3}),Ve(3))},description:{maxLength:N.withMessage(u("validation.description_maxlength",{count:255}),te(255))}},o=re(E,P(()=>i.currentItem)),x=P(()=>b.taxTypes.map(l=>{const r=l.calculation_type==="fixed"?new Intl.NumberFormat(void 0,{style:"currency",currency:I.selectedCompanyCurrency.code}).format(l.fixed_amount/100):`${l.percent}%`;return{...l,tax_name:`${l.name} (${r})`}}));fe(()=>{o.value.$reset(),i.fetchItemUnits({limit:"all"})});async function d(){if(o.value.$touch(),o.value.$invalid)return!0;let l={...i.currentItem,taxes:i.currentItem.taxes.map(p=>({tax_type_id:p.id,amount:p.calculation_type==="fixed"?p.fixed_amount:D.value*p.percent/100,percent:p.percent,fixed_amount:p.fixed_amount,calculation_type:p.calculation_type,name:p.name,collective_tax:0}))};k.value=!0,await(i.isEdit?i.updateItem:i.addItem)(l).then(p=>{k.value=!1,p.data.data&&e.data&&e.refreshData(p.data.data),m()})}function m(){e.closeModal(),setTimeout(()=>{i.resetCurrentItem(),e.$reset(),o.value.$reset()},300)}return(l,r)=>{const p=_("BaseIcon"),C=_("BaseInput"),S=_("BaseInputGroup"),j=_("BaseMoney"),M=_("BaseMultiselect"),w=_("BaseTextarea"),g=_("BaseInputGrid"),L=_("BaseButton"),z=_("BaseModal");return a(),T(z,{show:y.value,onClose:m},{header:c(()=>[n("div",vo,[V($(f(e).title)+" ",1),s(p,{name:"XMarkIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:m})])]),default:c(()=>[n("div",bo,[n("form",{action:"",onSubmit:xe(d,["prevent"])},[n("div",ho,[s(g,{layout:"one-column"},{default:c(()=>[s(S,{label:l.$t("items.name"),required:"",error:f(o).name.$error&&f(o).name.$errors[0].$message},{default:c(()=>[s(C,{modelValue:f(i).currentItem.name,"onUpdate:modelValue":r[0]||(r[0]=O=>f(i).currentItem.name=O),type:"text",invalid:f(o).name.$error,onInput:r[1]||(r[1]=O=>f(o).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(S,{label:l.$t("items.price")},{default:c(()=>[(a(),T(j,{key:f(I).selectedCompanyCurrency,modelValue:D.value,"onUpdate:modelValue":r[2]||(r[2]=O=>D.value=O),currency:f(I).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),s(S,{label:l.$t("items.unit")},{default:c(()=>[s(M,{modelValue:f(i).currentItem.unit_id,"onUpdate:modelValue":r[3]||(r[3]=O=>f(i).currentItem.unit_id=O),label:"name",options:f(i).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:l.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),A.value?(a(),T(S,{key:0,label:l.$t("items.taxes")},{default:c(()=>[s(M,{modelValue:q.value,"onUpdate:modelValue":r[4]||(r[4]=O=>q.value=O),options:x.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):U("",!0),s(S,{label:l.$t("items.description"),error:f(o).description.$error&&f(o).description.$errors[0].$message},{default:c(()=>[s(w,{modelValue:f(i).currentItem.description,"onUpdate:modelValue":r[5]||(r[5]=O=>f(i).currentItem.description=O),rows:"4",cols:"50",invalid:f(o).description.$error,onInput:r[6]||(r[6]=O=>f(o).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",$o,[s(L,{class:"mr-3",variant:"primary-outline",type:"button",onClick:m},{default:c(()=>[V($(l.$t("general.cancel")),1)]),_:1}),s(L,{loading:k.value,disabled:k.value,variant:"primary",type:"submit"},{left:c(O=>[s(p,{name:"ArrowDownOnSquareIcon",class:R(O.class)},null,8,["class"])]),default:c(()=>[V(" "+$(f(i).isEdit?l.$t("general.update"):l.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},wo={class:"flex justify-between w-full"},Io={class:"flex flex-col"},ko={class:"text-sm text-gray-500 mt-1"},Bo={class:"p-4 sm:p-6"},Po={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},So={__name:"TaxationAddressModal",emits:["addTax"],setup(t,{emit:h}){const e=X();je();const i=me({state:"",city:"",address_street_1:"",zip:""}),I=W(!1),b=ee(),{t:u}=H.useI18n(),k=P(()=>e.active&&e.componentName==="TaxationAddressModal"),B=P(()=>({state:{required:N.withMessage(u("validation.required"),G)},city:{required:N.withMessage(u("validation.required"),G)},address_street_1:{required:N.withMessage(u("validation.required"),G)},zip:{required:N.withMessage(u("validation.required"),G)}})),y=re(B,P(()=>i));async function D(){if(y.value.$touch(),y.value.$invalid)return!0;let o={address:i};e.id&&(o.customer_id=e.id),i.address_street_1=i.address_street_1.replace(/(\r\n|\n|\r)/gm,""),I.value=!0,await b.fetchSalesTax(o).then(x=>{I.value=!1,q("addTax",x.data.data),E()}).catch(x=>{I.value=!1})}const q=h;function A(){var o,x,d,m;i.state=(o=e==null?void 0:e.data)==null?void 0:o.state,i.city=(x=e==null?void 0:e.data)==null?void 0:x.city,i.address_street_1=(d=e==null?void 0:e.data)==null?void 0:d.address_street_1,i.zip=(m=e==null?void 0:e.data)==null?void 0:m.zip}function E(){e.closeModal()}return(o,x)=>{const d=_("BaseIcon"),m=_("BaseInput"),l=_("BaseInputGroup"),r=_("BaseTextarea"),p=_("BaseInputGrid"),C=_("BaseButton"),S=_("BaseModal");return a(),T(S,{show:k.value,onClose:E,onOpen:A},{header:c(()=>[n("div",wo,[n("div",Io,[V($(f(e).title)+" ",1),n("p",ko,$(f(e).content),1)]),s(d,{name:"XMarkIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:E})])]),default:c(()=>[n("form",{onSubmit:xe(D,["prevent"])},[n("div",Bo,[s(p,{layout:"one-column"},{default:c(()=>[s(l,{required:"",error:f(y).state.$error&&f(y).state.$errors[0].$message,label:o.$t("customers.state")},{default:c(()=>[s(m,{modelValue:i.state,"onUpdate:modelValue":x[0]||(x[0]=j=>i.state=j),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:f(y).state.$error,onInput:x[1]||(x[1]=j=>f(y).state.$touch()),placeholder:o.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(l,{required:"",error:f(y).city.$error&&f(y).city.$errors[0].$message,label:o.$t("customers.city")},{default:c(()=>[s(m,{modelValue:i.city,"onUpdate:modelValue":x[2]||(x[2]=j=>i.city=j),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:f(y).city.$error,onInput:x[3]||(x[3]=j=>f(y).city.$touch()),placeholder:o.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(l,{required:"",error:f(y).address_street_1.$error&&f(y).address_street_1.$errors[0].$message,label:o.$t("customers.address")},{default:c(()=>[s(r,{modelValue:i.address_street_1,"onUpdate:modelValue":x[4]||(x[4]=j=>i.address_street_1=j),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:f(y).address_street_1.$error,onInput:x[5]||(x[5]=j=>f(y).address_street_1.$touch()),placeholder:o.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(l,{required:"",error:f(y).zip.$error&&f(y).zip.$errors[0].$message,label:o.$t("customers.zip_code")},{default:c(()=>[s(m,{modelValue:i.zip,"onUpdate:modelValue":x[6]||(x[6]=j=>i.zip=j),invalid:f(y).zip.$error,onInput:x[7]||(x[7]=j=>f(y).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:o.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),n("div",Po,[s(C,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:E},{default:c(()=>[V($(o.$t("general.cancel")),1)]),_:1}),s(C,{loading:I.value,variant:"primary",type:"submit"},{left:c(j=>[I.value?U("",!0):(a(),T(d,{key:0,name:"ArrowDownOnSquareIcon",class:R(j.class)},null,8,["class"]))]),default:c(()=>[V(" "+$(o.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},oe="Sales Tax",se="MODULE",Lo={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(t){const h=X(),e=K(),i=ee(),{t:I}=H.useI18n(),b=W(!1),u=t,k=P(()=>u.isEdit?u.store[u.storeProp].sales_tax_address_type==="billing":e.selectedCompanySettings.sales_tax_address_type==="billing"),B=P(()=>e.selectedCompanySettings.sales_tax_us_enabled==="YES"),y=P(()=>u.isEdit?u.store[u.storeProp].sales_tax_type==="customer_level":e.selectedCompanySettings.sales_tax_type==="customer_level"),D=P(()=>u.isEdit?u.store[u.storeProp].sales_tax_type==="company_level":e.selectedCompanySettings.sales_tax_type==="company_level"),q=P(()=>{if(y.value&&A.value){let r=k.value?u.customer.billing:u.customer.shipping;return{address:J.pick(r,["address_street_1","city","state","zip"]),customer_id:u.customer.id}}else if(D.value&&A.value)return{address:J.pick(address,["address_street_1","city","state","zip"])}}),A=P(()=>{var r,p;if(y.value){let C=k.value?(r=u.customer)==null?void 0:r.billing:(p=u.customer)==null?void 0:p.shipping;return E(C)}else if(D.value)return E(e.selectedCompany.address);return!1});Q(()=>u.customer,(r,p)=>{if(r&&p&&y.value){o(r,p);return}!A.value&&y.value&&r?setTimeout(()=>{x()},500):y.value&&r?d():y.value&&!r&&l()}),fe(()=>{D.value&&(A.value?d():x())});function E(r){return r?r.address_street_1&&r.city&&r.state&&r.zip:!1}function o(r,p){const C=k.value?r.billing:r.shipping,S=k.value?p.billing:p.shipping,j=J.pick(C,["address_street_1","city","state","zip"]),M=J.pick(S,["address_street_1","city","state","zip"]);J.isEqual(j,M)||d()}function x(){var C,S;if(!B.value)return;let r=null,p="";y.value?k.value?(r=(C=u.customer)==null?void 0:C.billing,p=I("settings.taxations.add_billing_address")):(r=(S=u.customer)==null?void 0:S.shipping,p=I("settings.taxations.add_shipping_address")):(r=e.selectedCompany.address,p=I("settings.taxations.add_company_address")),h.openModal({title:p,content:I("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:r,id:y.value?u.customer.id:""})}async function d(){B.value&&(b.value=!0,await i.fetchSalesTax(q.value).then(r=>{m(r.data.data),b.value=!1}).catch(r=>{r.response.data.error&&setTimeout(()=>{x()},500),b.value=!1}))}function m(r){r.tax_type_id=r.id;const p=u.store[u.storeProp].taxes.findIndex(C=>C.name===oe&&C.type===se);p>-1?Object.assign(u.store[u.storeProp].taxes[p],r):u.store[u.storeProp].taxes.push(r)}function l(){const r=u.store[u.storeProp].taxes.findIndex(C=>C.name===oe&&C.type===se);r>-1&&u.store[u.storeProp].taxes.splice(r,1);let p=i.taxTypes.findIndex(C=>C.name===oe&&C.type===se);p>-1&&i.taxTypes.splice(p,1)}return(r,p)=>(a(),T(So,{onAddTax:m}))}};export{Lo as _,Eo as a,Ao as b,Do as c,qo as d,jo as e,Vo as f};
