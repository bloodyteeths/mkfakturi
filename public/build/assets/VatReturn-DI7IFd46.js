import{a0 as E,c as i,b as e,t as a,q as w,L as _,m as j,ag as y,aP as D,Q as M,R as U,ah as q,aQ as B,F as H,e as N,j as k,k as K,s as Q,o as c}from"./main-rC5xHABW.js";const P=()=>({show:()=>{},error:()=>{},success:()=>{}}),I={name:"VatReturn",setup(){const l=H(),r=P(),n=N({period_type:"MONTHLY",selected_month:"",selected_quarter:"",selected_year:"",period_start:"",period_end:"",validate_xml:!0}),t=N(!1),R=N(null),g=k(()=>l.selectedCompany),p=k(()=>{var s;return n.value.period_start&&n.value.period_end&&((s=g.value)==null?void 0:s.id)}),S=k(()=>{const s=new Date().getFullYear(),d=[];for(let o=0;o<=5;o++)d.push(s-o);return d}),F=k(()=>[{value:0,label:"Јануари"},{value:1,label:"Февруари"},{value:2,label:"Март"},{value:3,label:"Април"},{value:4,label:"Мај"},{value:5,label:"Јуни"},{value:6,label:"Јули"},{value:7,label:"Август"},{value:8,label:"Септември"},{value:9,label:"Октомври"},{value:10,label:"Ноември"},{value:11,label:"Декември"}]),V=k(()=>[{value:1,label:"Q1 (Јануари - Март)"},{value:2,label:"Q2 (Април - Јуни)"},{value:3,label:"Q3 (Јули - Септември)"},{value:4,label:"Q4 (Октомври - Декември)"}]),h=()=>{const s=new Date;if(n.value.period_type==="MONTHLY")n.value.selected_month=s.getMonth()-1<0?11:s.getMonth()-1,n.value.selected_year=s.getMonth()-1<0?s.getFullYear()-1:s.getFullYear();else if(n.value.period_type==="QUARTERLY"){const d=Math.floor(s.getMonth()/3)+1;n.value.selected_quarter=d-1<1?4:d-1,n.value.selected_year=d-1<1?s.getFullYear()-1:s.getFullYear()}else if(n.value.period_type==="CUSTOM"){const d=new Date(s.getFullYear(),s.getMonth()-1,1),o=new Date(s.getFullYear(),s.getMonth(),0);n.value.period_start=u(d),n.value.period_end=u(o)}x()},u=s=>{const d=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),m=String(s.getDate()).padStart(2,"0");return`${d}-${o}-${m}`},x=()=>{if(n.value.period_type==="MONTHLY"){const s=new Date(n.value.selected_year,n.value.selected_month,1),d=new Date(n.value.selected_year,n.value.selected_month+1,0);n.value.period_start=u(s),n.value.period_end=u(d)}else if(n.value.period_type==="QUARTERLY"){const s=(n.value.selected_quarter-1)*3,d=new Date(n.value.selected_year,s,1),o=new Date(n.value.selected_year,s+3,0);n.value.period_start=u(d),n.value.period_end=u(o)}},C=s=>s?new Date(s).toLocaleDateString("mk-MK",{year:"numeric",month:"long",day:"numeric"}):"",L=async()=>{var s,d;if(p.value)try{t.value=!0;const o=await Q.post("/api/v1/tax/vat-return/preview",{company_id:g.value.id,period_start:n.value.period_start,period_end:n.value.period_end,period_type:n.value.period_type});R.value=o.data.data,r.showNotification({type:"success",message:"VAT data preview loaded successfully"})}catch(o){console.error("Failed to preview VAT data:",o),r.showNotification({type:"error",message:((d=(s=o.response)==null?void 0:s.data)==null?void 0:d.message)||"Failed to preview VAT data"})}finally{t.value=!1}},T=async()=>{var s,d,o;if(p.value)try{t.value=!0;const m=await Q.post("/api/v1/tax/vat-return",{company_id:g.value.id,period_start:n.value.period_start,period_end:n.value.period_end,period_type:n.value.period_type,validate_xml:n.value.validate_xml},{responseType:"blob"}),b=new Blob([m.data],{type:"application/xml"}),f=window.URL.createObjectURL(b),v=document.createElement("a");v.href=f;const A=g.value.name.replace(/[^a-zA-Z0-9]/g,"_"),O=`${n.value.period_start}_${n.value.period_end}`;v.download=`DDV04_${A}_${O}.xml`,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(f),r.showNotification({type:"success",message:"VAT return XML generated and downloaded successfully"})}catch(m){console.error("Failed to generate VAT return:",m);let b="Failed to generate VAT return";if(((s=m.response)==null?void 0:s.data)instanceof Blob)try{const f=await m.response.data.text(),v=JSON.parse(f);b=v.message||b,console.error("Backend error:",v)}catch(f){console.error("Could not parse error blob:",f)}else(o=(d=m.response)==null?void 0:d.data)!=null&&o.message&&(b=m.response.data.message);r.showNotification({type:"error",message:b})}finally{t.value=!1}},Y=s=>(s/100).toLocaleString("mk-MK",{minimumFractionDigits:2,maximumFractionDigits:2});return K(()=>{h()}),{form:n,isLoading:t,vatSummary:R,currentCompany:g,isFormValid:p,availableYears:S,availableMonths:F,availableQuarters:V,onPeriodTypeChange:h,updateDatesFromSelection:x,formatDate:C,previewVatData:L,generateVatReturn:T,formatMoney:Y}}},z={class:"vat-return-generator"},J={class:"bg-white shadow-sm border-b border-gray-200 mb-6"},X={class:"max-w-7xl mx-auto px-4 py-6"},Z={class:"flex items-center justify-between"},G={class:"text-2xl font-bold text-gray-900"},W={class:"mt-1 text-sm text-gray-600"},$={class:"text-sm text-gray-500"},ee={class:"max-w-7xl mx-auto px-4"},te={key:0,class:"mb-6 bg-yellow-50 border-l-4 border-yellow-400 p-4"},oe={class:"flex"},ae={class:"ml-3"},re={class:"text-sm text-yellow-700"},se={class:"font-medium"},ne={class:"bg-white rounded-lg shadow"},le={class:"p-6"},de={class:"border-b border-gray-200 pb-6"},ie={class:"text-lg font-medium text-gray-900 mb-4"},ce={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ue={class:"block text-sm font-medium text-gray-700 mb-2"},me={class:"p-3 bg-gray-50 rounded-md text-sm text-gray-800"},ve={class:"block text-sm font-medium text-gray-700 mb-2"},_e={class:"p-3 bg-gray-50 rounded-md text-sm text-gray-800"},ye={class:"border-b border-gray-200 pb-6"},ge={class:"text-lg font-medium text-gray-900 mb-4"},pe={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},be={class:"block text-sm font-medium text-gray-700 mb-2"},fe={value:"MONTHLY"},he={value:"QUARTERLY"},xe={value:"CUSTOM"},we={key:0,class:"lg:col-span-2"},De={class:"block text-sm font-medium text-gray-700 mb-2"},Me={class:"grid grid-cols-2 gap-3"},ke=["value"],Se=["value"],Fe={key:1,class:"lg:col-span-2"},Ve={class:"block text-sm font-medium text-gray-700 mb-2"},Ce={class:"grid grid-cols-2 gap-3"},Le=["value"],Te=["value"],Ye={class:"block text-sm font-medium text-gray-700 mb-2"},Ue={class:"block text-sm font-medium text-gray-700 mb-2"},Re={key:0,class:"mt-4 p-3 bg-gray-50 rounded-md"},Ne={class:"text-sm text-gray-700"},qe={class:"font-medium"},Qe={key:0,class:"border-b border-gray-200 pb-6"},Ae={class:"text-lg font-medium text-gray-900 mb-4"},Oe={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ee={class:"bg-blue-50 p-4 rounded-lg"},je={class:"text-sm font-medium text-blue-800 mb-2"},Be={class:"text-lg font-bold text-blue-900"},He={class:"text-xs text-blue-600"},Ke={class:"bg-green-50 p-4 rounded-lg"},Pe={class:"text-sm font-medium text-green-800 mb-2"},Ie={class:"text-lg font-bold text-green-900"},ze={class:"text-xs text-green-600"},Je={class:"bg-gray-50 p-4 rounded-lg"},Xe={class:"text-sm font-medium text-gray-800 mb-2"},Ze={class:"text-lg font-bold text-gray-900"},Ge={class:"text-xs text-gray-600"},We={class:"border-b border-gray-200 pb-6"},$e={class:"text-lg font-medium text-gray-900 mb-4"},et={class:"space-y-4"},tt={class:"flex items-center"},ot={for:"validate_xml",class:"ml-2 block text-sm text-gray-900"},at={class:"flex items-center justify-between pt-6"},rt=["disabled"],st=["disabled"],nt={key:0,class:"fas fa-download mr-2"},lt={key:1,class:"fas fa-spinner fa-spin mr-2"};function dt(l,r,n,t,R,g){var p,S,F,V,h,u,x,C,L,T,Y,s,d;return c(),i("div",z,[e("div",J,[e("div",X,[e("div",Z,[e("div",null,[e("h1",G,a(l.$t("vat.generate_return")),1),e("p",W,a(l.$t("vat.generate_return_description")),1)]),e("div",$,[r[15]||(r[15]=e("i",{class:"fas fa-file-alt mr-1"},null,-1)),w(" "+a(l.$t("vat.ddv_04_format")),1)])])])]),e("div",ee,[(p=t.currentCompany)!=null&&p.vat_number?_("",!0):(c(),i("div",te,[e("div",oe,[r[16]||(r[16]=e("div",{class:"flex-shrink-0"},[e("i",{class:"fas fa-exclamation-triangle text-yellow-400"})],-1)),e("div",ae,[e("p",re,[e("strong",se,a(l.$t("vat.vat_number_required")),1),w(" "+a(l.$t("vat.vat_number_warning_message")),1)])])])])),e("div",ne,[e("div",le,[e("form",{onSubmit:r[14]||(r[14]=j((...o)=>t.generateVatReturn&&t.generateVatReturn(...o),["prevent"])),class:"space-y-6"},[e("div",de,[e("h3",ie,a(l.$t("vat.company_information")),1),e("div",ce,[e("div",null,[e("label",ue,a(l.$t("general.company_name")),1),e("div",me,a(((S=t.currentCompany)==null?void 0:S.name)||l.$t("general.no_company_selected")),1)]),e("div",null,[e("label",ve,a(l.$t("vat.vat_number")),1),e("div",_e,a(((F=t.currentCompany)==null?void 0:F.vat_number)||l.$t("vat.no_vat_number")),1)])])]),e("div",ye,[e("h3",ge,a(l.$t("vat.tax_period")),1),e("div",pe,[e("div",null,[e("label",be,a(l.$t("vat.period_type")),1),y(e("select",{"onUpdate:modelValue":r[0]||(r[0]=o=>t.form.period_type=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",onChange:r[1]||(r[1]=(...o)=>t.onPeriodTypeChange&&t.onPeriodTypeChange(...o))},[e("option",fe,a(l.$t("vat.monthly")),1),e("option",he,a(l.$t("vat.quarterly")),1),e("option",xe,a(l.$t("vat.custom")),1)],544),[[D,t.form.period_type]])]),t.form.period_type==="MONTHLY"?(c(),i("div",we,[e("label",De,a(l.$t("vat.select_month")),1),e("div",Me,[y(e("select",{"onUpdate:modelValue":r[2]||(r[2]=o=>t.form.selected_month=o),onChange:r[3]||(r[3]=(...o)=>t.updateDatesFromSelection&&t.updateDatesFromSelection(...o)),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:""},[(c(!0),i(M,null,U(t.availableMonths,o=>(c(),i("option",{key:o.value,value:o.value},a(o.label),9,ke))),128))],544),[[D,t.form.selected_month]]),y(e("select",{"onUpdate:modelValue":r[4]||(r[4]=o=>t.form.selected_year=o),onChange:r[5]||(r[5]=(...o)=>t.updateDatesFromSelection&&t.updateDatesFromSelection(...o)),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:""},[(c(!0),i(M,null,U(t.availableYears,o=>(c(),i("option",{key:o,value:o},a(o),9,Se))),128))],544),[[D,t.form.selected_year]])])])):_("",!0),t.form.period_type==="QUARTERLY"?(c(),i("div",Fe,[e("label",Ve,a(l.$t("vat.select_quarter")),1),e("div",Ce,[y(e("select",{"onUpdate:modelValue":r[6]||(r[6]=o=>t.form.selected_quarter=o),onChange:r[7]||(r[7]=(...o)=>t.updateDatesFromSelection&&t.updateDatesFromSelection(...o)),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:""},[(c(!0),i(M,null,U(t.availableQuarters,o=>(c(),i("option",{key:o.value,value:o.value},a(o.label),9,Le))),128))],544),[[D,t.form.selected_quarter]]),y(e("select",{"onUpdate:modelValue":r[8]||(r[8]=o=>t.form.selected_year=o),onChange:r[9]||(r[9]=(...o)=>t.updateDatesFromSelection&&t.updateDatesFromSelection(...o)),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:""},[(c(!0),i(M,null,U(t.availableYears,o=>(c(),i("option",{key:o,value:o},a(o),9,Te))),128))],544),[[D,t.form.selected_year]])])])):_("",!0),t.form.period_type==="CUSTOM"?(c(),i(M,{key:2},[e("div",null,[e("label",Ye,a(l.$t("vat.period_start")),1),y(e("input",{"onUpdate:modelValue":r[10]||(r[10]=o=>t.form.period_start=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:""},null,512),[[q,t.form.period_start]])]),e("div",null,[e("label",Ue,a(l.$t("vat.period_end")),1),y(e("input",{"onUpdate:modelValue":r[11]||(r[11]=o=>t.form.period_end=o),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:""},null,512),[[q,t.form.period_end]])])],64)):_("",!0)]),t.form.period_start&&t.form.period_end?(c(),i("div",Re,[e("div",Ne,[e("span",qe,a(l.$t("vat.selected_period"))+":",1),w(" "+a(t.formatDate(t.form.period_start))+" - "+a(t.formatDate(t.form.period_end)),1)])])):_("",!0)]),t.vatSummary?(c(),i("div",Qe,[e("h3",Ae,a(l.$t("vat.summary_preview")),1),e("div",Oe,[e("div",Ee,[e("div",je,a(l.$t("vat.standard_rate"))+" (18%)",1),e("div",Be,a(t.formatMoney(((V=t.vatSummary.standard)==null?void 0:V.vat_amount)||0))+" "+a(((u=(h=t.currentCompany)==null?void 0:h.currency)==null?void 0:u.code)||"MKD"),1),e("div",He,a(((x=t.vatSummary.standard)==null?void 0:x.transaction_count)||0)+" "+a(l.$t("vat.transactions")),1)]),e("div",Ke,[e("div",Pe,a(l.$t("vat.reduced_rate"))+" (5%)",1),e("div",Ie,a(t.formatMoney(((C=t.vatSummary.reduced)==null?void 0:C.vat_amount)||0))+" "+a(((T=(L=t.currentCompany)==null?void 0:L.currency)==null?void 0:T.code)||"MKD"),1),e("div",ze,a(((Y=t.vatSummary.reduced)==null?void 0:Y.transaction_count)||0)+" "+a(l.$t("vat.transactions")),1)]),e("div",Je,[e("div",Xe,a(l.$t("vat.total_vat_due")),1),e("div",Ze,a(t.formatMoney(t.vatSummary.total_output_vat||0))+" "+a(((d=(s=t.currentCompany)==null?void 0:s.currency)==null?void 0:d.code)||"MKD"),1),e("div",Ge,a(l.$t("vat.output_vat")),1)])])])):_("",!0),e("div",We,[e("h3",$e,a(l.$t("vat.generation_options")),1),e("div",et,[e("div",tt,[y(e("input",{"onUpdate:modelValue":r[12]||(r[12]=o=>t.form.validate_xml=o),type:"checkbox",id:"validate_xml",class:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"},null,512),[[B,t.form.validate_xml]]),e("label",ot,a(l.$t("vat.validate_xml_schema")),1)])])]),e("div",at,[e("button",{type:"button",onClick:r[13]||(r[13]=(...o)=>t.previewVatData&&t.previewVatData(...o)),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:t.isLoading},[r[17]||(r[17]=e("i",{class:"fas fa-eye mr-2"},null,-1)),w(" "+a(l.$t("vat.preview_data")),1)],8,rt),e("button",{type:"submit",class:"px-6 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:t.isLoading||!t.isFormValid},[t.isLoading?_("",!0):(c(),i("i",nt)),t.isLoading?(c(),i("i",lt)):_("",!0),w(" "+a(t.isLoading?l.$t("vat.generating"):l.$t("vat.generate_and_download")),1)],8,st)])],32)])])])])}const ct=E(I,[["render",dt],["__scopeId","data-v-17cc714f"]]);export{ct as default};
