import{v as R,u as z,j as U,e as I,I as K,P as Q,s as C,r as u,K as H,o as c,w as l,b as e,m as X,L as S,a as n,t as s,q as V,M as k,H as W,k as Y,c as p,Q as N,N as Z,n as ee,R as q}from"./main-Ds_umSNN.js";import{P as te}from"./PermissionEditor-N7nDPd1s.js";const se={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200"},ae={class:"text-lg font-medium text-gray-900"},oe={class:"px-6 py-4"},ne={class:"mb-4"},re={class:"block text-sm font-medium text-gray-700 mb-2"},ie={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},le={class:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200"},de={__name:"AssignCompanyModal",props:{show:{type:Boolean,required:!0},partnerId:{type:Number,required:!0},company:{type:Object,default:null}},emits:["close","saved"],setup(P,{emit:A}){const{t:$}=R.useI18n(),g=z(),m=P,M=A,a=U(()=>!!m.company),f=I(!1),v=I(!1),w=I([]),r=K({company_id:null,is_primary:!1,override_commission_rate:null,permissions:[]}),j=U(()=>a.value?!0:r.company_id&&r.permissions.length>0);Q(()=>m.show,o=>{o&&(a.value?D():(G(),F()))});function D(){var o,i,_;if(m.company){r.company_id=m.company.id,r.is_primary=((o=m.company.pivot)==null?void 0:o.is_primary)||!1,r.override_commission_rate=((i=m.company.pivot)==null?void 0:i.override_commission_rate)||null;try{const h=(_=m.company.pivot)==null?void 0:_.permissions;r.permissions=typeof h=="string"?JSON.parse(h):Array.isArray(h)?h:[]}catch{r.permissions=[]}}}async function F(){f.value=!0;try{const o=await C.get(`/partners/${m.partnerId}/available-companies`);w.value=o.data}catch(o){console.error("Failed to load companies:",o),g.showNotification({type:"error",message:$("partners.failed_to_load_companies")})}finally{f.value=!1}}async function E(){var o,i;v.value=!0;try{const _={is_primary:r.is_primary,override_commission_rate:r.override_commission_rate||null,permissions:r.permissions};a.value?(await C.put(`/partners/${m.partnerId}/companies/${m.company.id}`,_),g.showNotification({type:"success",message:$("partners.assignment_updated_successfully")})):(_.company_id=r.company_id,await C.post(`/partners/${m.partnerId}/companies`,_),g.showNotification({type:"success",message:$("partners.company_assigned_successfully")})),M("saved"),t()}catch(_){g.showNotification({type:"error",message:((i=(o=_.response)==null?void 0:o.data)==null?void 0:i.message)||$("partners.assignment_failed")})}finally{v.value=!1}}function G(){r.company_id=null,r.is_primary=!1,r.override_commission_rate=null,r.permissions=[]}function t(){M("close")}return(o,i)=>{const _=u("BaseIcon"),h=u("BaseMultiselect"),x=u("BaseInputGroup"),L=u("BaseInput"),B=u("BaseSwitch"),b=u("BaseButton"),T=u("BaseModal");return c(),H(T,{show:P.show,onClose:t},{header:l(()=>[e("div",se,[e("h3",ae,s(a.value?o.$t("partners.edit_company_assignment"):o.$t("partners.assign_company")),1),e("button",{type:"button",class:"text-gray-400 hover:text-gray-500",onClick:t},[n(_,{name:"XMarkIcon",class:"w-6 h-6"})])])]),default:l(()=>[e("div",oe,[e("form",{onSubmit:X(E,["prevent"])},[a.value?S("",!0):(c(),H(x,{key:0,label:o.$t("partners.select_company"),required:"",class:"mb-4"},{default:l(()=>[n(h,{modelValue:r.company_id,"onUpdate:modelValue":i[0]||(i[0]=y=>r.company_id=y),options:w.value,"value-prop":"id",label:"name","track-by":"name",searchable:"",placeholder:o.$t("partners.search_company"),loading:f.value},null,8,["modelValue","options","placeholder","loading"])]),_:1},8,["label"])),n(x,{label:o.$t("partners.commission_rate_override"),"helper-text":o.$t("partners.commission_rate_override_help"),class:"mb-4"},{default:l(()=>[n(L,{modelValue:r.override_commission_rate,"onUpdate:modelValue":i[1]||(i[1]=y=>r.override_commission_rate=y),type:"number",step:"0.01",min:"0",max:"100",placeholder:o.$t("partners.use_default_rate")},{right:l(()=>i[4]||(i[4]=[e("span",{class:"text-gray-500"},"%",-1)])),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","helper-text"]),n(x,{class:"mb-4"},{default:l(()=>[n(B,{modelValue:r.is_primary,"onUpdate:modelValue":i[2]||(i[2]=y=>r.is_primary=y),label:o.$t("partners.set_as_primary_company")},null,8,["modelValue","label"])]),_:1}),e("div",ne,[e("label",re,s(o.$t("partners.permissions")),1),e("div",ie,[n(te,{modelValue:r.permissions,"onUpdate:modelValue":i[3]||(i[3]=y=>r.permissions=y)},null,8,["modelValue"])])]),e("div",le,[n(b,{type:"button",variant:"primary-outline",onClick:t},{default:l(()=>[V(s(o.$t("general.cancel")),1)]),_:1}),n(b,{type:"submit",loading:v.value,disabled:!j.value},{left:l(y=>[n(_,{name:"CheckIcon",class:k(y.class)},null,8,["class"])]),default:l(()=>[V(" "+s(a.value?o.$t("partners.update_assignment"):o.$t("partners.assign_company")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},ce={class:"flex items-center justify-end space-x-3"},pe={key:0,class:"px-3 py-2 text-sm font-medium bg-purple-100 text-purple-800 rounded"},ue={class:"grid grid-cols-1 gap-4 mt-6 md:grid-cols-4"},me={class:"p-4 bg-white border border-gray-200 rounded-lg"},_e={class:"text-sm text-gray-500"},ye={class:"text-2xl font-semibold"},ge={class:"p-4 bg-white border border-gray-200 rounded-lg"},he={class:"text-sm text-gray-500"},ve={class:"text-2xl font-semibold text-orange-600"},fe={class:"p-4 bg-white border border-gray-200 rounded-lg"},xe={class:"text-sm text-gray-500"},be={class:"text-2xl font-semibold text-blue-600"},$e={class:"p-4 bg-white border border-gray-200 rounded-lg"},we={class:"text-sm text-gray-500"},Be={class:"text-2xl font-semibold text-green-600"},ke={class:"mt-8"},Ie={class:"p-6 bg-white rounded-lg shadow"},Ce={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Ve={class:"text-sm font-medium text-gray-500"},Me={class:"mt-1 text-gray-900"},Ne={class:"text-sm font-medium text-gray-500"},Se={class:"mt-1 text-gray-900"},Pe={class:"text-sm font-medium text-gray-500"},Ae={class:"mt-1 text-gray-900"},je={class:"text-sm font-medium text-gray-500"},De={class:"mt-1 text-gray-900"},Fe={class:"text-sm font-medium text-gray-500"},Ee={class:"mt-1 text-gray-900"},Ge={class:"text-sm font-medium text-gray-500"},Le={class:"mt-1 text-gray-900"},Te={class:"text-sm font-medium text-gray-500"},qe={class:"mt-1 text-gray-900"},Ue={class:"text-sm font-medium text-gray-500"},He={class:"mt-1 text-gray-900"},Oe={class:"text-sm font-medium text-gray-500"},Re={class:"mt-1"},ze={class:"text-sm font-medium text-gray-500"},Je={class:"mt-1"},Ke={key:0,class:"col-span-2"},Qe={class:"text-sm font-medium text-gray-500"},Xe={class:"mt-1 text-gray-900"},We={class:"bg-white rounded-lg shadow"},Ye={class:"p-4 border-b border-gray-200"},Ze={key:0,class:"overflow-x-auto"},et={class:"min-w-full divide-y divide-gray-200"},tt={class:"bg-gray-50"},st={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},at={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},ot={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},nt={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},rt={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},it={class:"bg-white divide-y divide-gray-200"},lt={class:"px-6 py-4 whitespace-nowrap"},dt={class:"flex items-center"},ct={class:"text-sm font-medium text-gray-900"},pt={key:0,class:"inline-flex px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded"},ut={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},mt={class:"px-6 py-4 text-sm text-gray-500"},_t={class:"inline-flex px-2 py-1 text-xs bg-gray-100 rounded"},yt={class:"px-6 py-4 whitespace-nowrap"},gt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ht={key:1,class:"p-8 text-center text-gray-500"},vt={class:"bg-white rounded-lg shadow"},ft={key:0,class:"p-6"},xt={class:"text-lg font-medium text-gray-900 mb-4"},bt={class:"overflow-x-auto"},$t={class:"min-w-full divide-y divide-gray-200"},wt={class:"bg-gray-50"},Bt={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},kt={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},It={class:"bg-white divide-y divide-gray-200"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900"},Mt={key:1,class:"p-8 text-center text-gray-500"},Nt={class:"bg-white rounded-lg shadow"},St={key:0,class:"overflow-x-auto"},Pt={class:"min-w-full divide-y divide-gray-200"},At={class:"bg-gray-50"},jt={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},Dt={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},Ft={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},Et={class:"bg-white divide-y divide-gray-200"},Gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900"},Tt={class:"px-6 py-4 whitespace-nowrap"},qt={class:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded"},Ut={key:1,class:"p-8 text-center text-gray-500"},Ht={key:1,class:"flex items-center justify-center h-screen"},Jt={__name:"View",setup(P){const A=Z(),$=ee(),{t:g}=R.useI18n(),m=z(),M=W(),a=I(null),f=I(!1),v=U(()=>{var t;return((t=M.companySettings)==null?void 0:t.currency)||{code:"MKD",symbol:"ден",precision:2,thousand_separator:".",decimal_separator:",",swap_currency_symbol:!1}});async function w(){try{const t=await C.get(`/partners/${A.params.id}`);a.value=t.data}catch{m.showNotification({type:"error",message:g("partners.fetch_failed")}),$.push("/admin/partners")}}function r(t){if(!t)return 0;try{const o=typeof t=="string"?JSON.parse(t):t;return Array.isArray(o)?o.length:0}catch{return 0}}function j(t){return new Date(t).toLocaleDateString()}function D(){f.value=!0}function F(){f.value=!1}function E(){w()}async function G(t){var o,i;if(confirm(g("partners.confirm_unassign")))try{await C.delete(`/partners/${a.value.id}/companies/${t}`),m.showNotification({type:"success",message:g("partners.company_unassigned_successfully")}),w()}catch(_){m.showNotification({type:"error",message:((i=(o=_.response)==null?void 0:o.data)==null?void 0:i.message)||g("partners.unassign_failed")})}}return Y(()=>{w()}),(t,o)=>{var O;const i=u("BaseBreadcrumbItem"),_=u("BaseBreadcrumb"),h=u("BaseIcon"),x=u("BaseButton"),L=u("BasePageHeader"),B=u("BaseFormatMoney"),b=u("BaseTab"),T=u("BaseTabGroup"),y=u("BasePage"),J=u("BaseLoader");return c(),p(N,null,[a.value?(c(),H(y,{key:0},{default:l(()=>[n(L,{title:a.value.name},{actions:l(()=>[e("div",ce,[a.value.is_partner_plus?(c(),p("span",pe," Partner Plus ")):S("",!0),n(x,{variant:"primary-outline",onClick:o[0]||(o[0]=d=>t.$router.push(`/admin/partners/${a.value.id}/edit`))},{left:l(d=>[n(h,{name:"PencilIcon",class:k(d.class)},null,8,["class"])]),default:l(()=>[V(" "+s(t.$t("general.edit")),1)]),_:1})])]),default:l(()=>[n(_,null,{default:l(()=>[n(i,{title:t.$t("general.home"),to:"dashboard"},null,8,["title"]),n(i,{title:t.$t("partners.title",2),to:"/admin/partners"},null,8,["title"]),n(i,{title:a.value.name,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),e("div",ue,[e("div",me,[e("div",_e,s(t.$t("partners.total_earnings")),1),e("div",ye,[n(B,{amount:a.value.total_earnings||0,currency:v.value},null,8,["amount","currency"])])]),e("div",ge,[e("div",he,s(t.$t("partners.pending_payout")),1),e("div",ve,[n(B,{amount:a.value.pending_payout||0,currency:v.value},null,8,["amount","currency"])])]),e("div",fe,[e("div",xe,s(t.$t("partners.companies_managed")),1),e("div",be,s(a.value.companies_count||0),1)]),e("div",$e,[e("div",we,s(t.$t("partners.commission_rate")),1),e("div",Be,s(a.value.effective_commission_rate?(a.value.effective_commission_rate*100).toFixed(0):0)+"% ",1)])]),e("div",ke,[n(T,null,{default:l(()=>[n(b,{title:t.$t("partners.tabs.info")},{default:l(()=>[e("div",Ie,[e("div",Ce,[e("div",null,[e("label",Ve,s(t.$t("partners.name")),1),e("div",Me,s(a.value.name),1)]),e("div",null,[e("label",Ne,s(t.$t("partners.email")),1),e("div",Se,s(a.value.email),1)]),e("div",null,[e("label",Pe,s(t.$t("partners.phone")),1),e("div",Ae,s(a.value.phone||"-"),1)]),e("div",null,[e("label",je,s(t.$t("partners.company_name")),1),e("div",De,s(a.value.company_name||"-"),1)]),e("div",null,[e("label",Fe,s(t.$t("partners.tax_id")),1),e("div",Ee,s(a.value.tax_id||"-"),1)]),e("div",null,[e("label",Ge,s(t.$t("partners.registration_number")),1),e("div",Le,s(a.value.registration_number||"-"),1)]),e("div",null,[e("label",Te,s(t.$t("partners.bank_account")),1),e("div",qe,s(a.value.bank_account||"-"),1)]),e("div",null,[e("label",Ue,s(t.$t("partners.bank_name")),1),e("div",He,s(a.value.bank_name||"-"),1)]),e("div",null,[e("label",Oe,s(t.$t("general.status")),1),e("div",Re,[e("span",{class:k(["px-2 py-1 text-xs font-medium rounded",a.value.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},s(a.value.is_active?t.$t("general.active"):t.$t("general.inactive")),3)])]),e("div",null,[e("label",ze,s(t.$t("partners.kyc_status")),1),e("div",Je,[e("span",{class:k(["px-2 py-1 text-xs font-medium rounded",{"bg-gray-100 text-gray-800":a.value.kyc_status==="pending","bg-yellow-100 text-yellow-800":a.value.kyc_status==="under_review","bg-green-100 text-green-800":a.value.kyc_status==="approved","bg-red-100 text-red-800":a.value.kyc_status==="rejected"}])},s(t.$t(`partners.kyc.${a.value.kyc_status||"pending"}`)),3)])]),a.value.notes?(c(),p("div",Ke,[e("label",Qe,s(t.$t("partners.notes")),1),e("div",Xe,s(a.value.notes),1)])):S("",!0)])])]),_:1},8,["title"]),n(b,{title:t.$t("partners.tabs.companies"),count:a.value.companies?a.value.companies.length:0},{default:l(()=>[e("div",We,[e("div",Ye,[n(x,{onClick:D},{left:l(d=>[n(h,{name:"PlusIcon",class:k(d.class)},null,8,["class"])]),default:l(()=>[V(" "+s(t.$t("partners.assign_company")),1)]),_:1})]),a.value.companies&&a.value.companies.length>0?(c(),p("div",Ze,[e("table",et,[e("thead",tt,[e("tr",null,[e("th",st,s(t.$t("partners.company_name")),1),e("th",at,s(t.$t("partners.commission_rate")),1),e("th",ot,s(t.$t("partners.permissions")),1),e("th",nt,s(t.$t("general.status")),1),e("th",rt,s(t.$t("general.actions")),1)])]),e("tbody",it,[(c(!0),p(N,null,q(a.value.companies,d=>(c(),p("tr",{key:d.id},[e("td",lt,[e("div",dt,[e("div",null,[e("div",ct,s(d.name),1),d.pivot.is_primary?(c(),p("span",pt,s(t.$t("partners.primary")),1)):S("",!0)])])]),e("td",ut,s(d.pivot.override_commission_rate||a.value.commission_rate||0)+"% ",1),e("td",mt,[e("span",_t,s(r(d.pivot.permissions))+" "+s(t.$t("partners.permissions_label")),1)]),e("td",yt,[e("span",{class:k(["px-2 py-1 text-xs font-medium rounded",d.pivot.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},s(d.pivot.is_active?t.$t("general.active"):t.$t("general.inactive")),3)]),e("td",gt,[n(x,{variant:"danger-outline",size:"sm",onClick:Ot=>G(d.id)},{default:l(()=>[V(s(t.$t("partners.unassign")),1)]),_:2},1032,["onClick"])])]))),128))])])])):(c(),p("div",ht,s(t.$t("partners.no_companies_assigned")),1))])]),_:1},8,["title","count"]),n(b,{title:t.$t("partners.tabs.commissions")},{default:l(()=>[e("div",vt,[a.value.monthly_commissions&&a.value.monthly_commissions.length>0?(c(),p("div",ft,[e("h3",xt,s(t.$t("partners.monthly_commissions")),1),e("div",bt,[e("table",$t,[e("thead",wt,[e("tr",null,[e("th",Bt,s(t.$t("partners.month")),1),e("th",kt,s(t.$t("partners.amount")),1)])]),e("tbody",It,[(c(!0),p(N,null,q(a.value.monthly_commissions,d=>(c(),p("tr",{key:d.month},[e("td",Ct,s(d.month),1),e("td",Vt,[n(B,{amount:d.total,currency:v.value},null,8,["amount","currency"])])]))),128))])])])])):(c(),p("div",Mt,s(t.$t("partners.no_commissions")),1))])]),_:1},8,["title"]),n(b,{title:t.$t("partners.tabs.payouts")},{default:l(()=>[e("div",Nt,[a.value.payouts&&a.value.payouts.length>0?(c(),p("div",St,[e("table",Pt,[e("thead",At,[e("tr",null,[e("th",jt,s(t.$t("partners.date")),1),e("th",Dt,s(t.$t("partners.amount")),1),e("th",Ft,s(t.$t("general.status")),1)])]),e("tbody",Et,[(c(!0),p(N,null,q(a.value.payouts,d=>(c(),p("tr",{key:d.id},[e("td",Gt,s(j(d.created_at)),1),e("td",Lt,[n(B,{amount:d.amount,currency:v.value},null,8,["amount","currency"])]),e("td",Tt,[e("span",qt,s(d.status||"Paid"),1)])]))),128))])])])):(c(),p("div",Ut,s(t.$t("partners.no_payouts")),1))])]),_:1},8,["title"])]),_:1})])]),_:1})):(c(),p("div",Ht,[n(J)])),n(de,{show:f.value,"partner-id":(O=a.value)==null?void 0:O.id,company:null,onClose:F,onSaved:E},null,8,["show","partner-id"])],64)}}};export{Jt as default};
