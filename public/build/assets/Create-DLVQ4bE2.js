import{v as W,u as Y,e as _,I as Z,i as ee,K as M,w as l,r as c,n as te,aD as T,J as L,g as S,o as h,a,b as n,q as z,t as d,L as $,m as B,l as g,c as b,Q as ae,R as se}from"./main-C3HD31Qx.js";import{u as oe}from"./ticket-CiwRtVCh.js";const le={class:"max-w-4xl mx-auto mt-8"},re={class:"text-sm text-gray-500"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6"},ie={class:"text-sm text-gray-600"},ce={class:"text-xs text-gray-500 mt-1"},ue={key:0,class:"mt-4 space-y-2"},me={class:"flex items-center space-x-3"},de={class:"text-sm font-medium text-gray-900"},pe={class:"text-xs text-gray-500"},ge=["onClick"],fe={key:0,class:"text-sm text-red-500"},_e={__name:"Create",setup(ve){const{t:r}=W.useI18n(),A=te(),F=oe(),w=Y(),k=_(!1),f=_(""),v=_([]),N=_(null),s=Z({title:"",message:"",priority:{label:r("tickets.normal"),value:"normal"},categories:[]}),P=[{label:r("tickets.low"),value:"low"},{label:r("tickets.normal"),value:"normal"},{label:r("tickets.high"),value:"high"},{label:r("tickets.urgent"),value:"urgent"}],q=[{label:r("tickets.billing_subscriptions"),value:1},{label:r("tickets.technical_issues"),value:2},{label:r("tickets.feature_requests"),value:3},{label:r("tickets.general_questions"),value:4}],E={formData:{title:{required:S,minLength:L(3),maxLength:T(255)},message:{required:S,minLength:L(10),maxLength:T(5e3)}}},u=ee(E,{formData:s}),U=t=>{const e=Array.from(t.target.files);I(e)},j=t=>{const e=Array.from(t.dataTransfer.files);I(e)},I=t=>{f.value="";for(const e of t){if(e.size>5*1024*1024){f.value=r("tickets.file_too_large",{filename:e.name});continue}if(!["image/jpeg","image/png","image/gif","image/webp","application/pdf"].includes(e.type)){f.value=r("tickets.invalid_file_type",{filename:e.name});continue}v.value.find(i=>i.name===e.name&&i.size===e.size)||v.value.push(e)}},G=t=>{v.value.splice(t,1),f.value=""},H=t=>t.startsWith("image/")?"PhotoIcon":t==="application/pdf"?"DocumentTextIcon":"DocumentIcon",K=t=>{if(t===0)return"0 Bytes";const e=1024,m=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,i)*100)/100+" "+m[i]},D=async()=>{var t;if(u.value.$touch(),u.value.$invalid){w.showNotification({type:"error",message:r("validation.invalid_form")});return}k.value=!0;try{const e=new FormData;e.append("title",s.title),e.append("message",s.message);const m=((t=s.priority)==null?void 0:t.value)||s.priority||"normal";m&&["low","normal","high","urgent"].includes(m)&&e.append("priority",m),s.categories.length&&s.categories.forEach((i,p)=>{e.append(`categories[${p}]`,i.value)}),v.value.forEach((i,p)=>{e.append(`attachments[${p}]`,i)}),await F.createTicket(e),w.showNotification({type:"success",message:r("tickets.created_message")}),A.push("/admin/support")}catch(e){console.error("Error creating ticket:",e)}finally{k.value=!1}};return(t,e)=>{const m=c("BaseBreadcrumbItem"),i=c("BaseBreadcrumb"),p=c("BaseIcon"),V=c("BaseButton"),O=c("BasePageHeader"),R=c("BaseInput"),y=c("BaseInputGroup"),X=c("BaseTextarea"),x=c("BaseMultiselect"),J=c("BaseCard"),Q=c("BasePage");return h(),M(Q,null,{default:l(()=>[a(O,{title:t.$t("tickets.new_ticket")},{actions:l(()=>[a(V,{variant:"primary-outline",type:"button",onClick:e[0]||(e[0]=o=>t.$router.push("/admin/support"))},{default:l(()=>[a(p,{name:"XMarkIcon",class:"h-5 w-5 mr-1"}),z(" "+d(t.$t("general.cancel")),1)]),_:1}),a(V,{loading:k.value,disabled:k.value,variant:"primary",type:"submit",class:"ml-4",onClick:D},{default:l(()=>[k.value?$("",!0):(h(),M(p,{key:0,name:"PaperAirplaneIcon",class:"h-5 w-5 mr-1"})),z(" "+d(t.$t("tickets.create_ticket")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[a(i,null,{default:l(()=>[a(m,{title:t.$t("general.home"),to:"dashboard"},null,8,["title"]),a(m,{title:t.$t("tickets.ticket",2),to:"support"},null,8,["title"]),a(m,{title:t.$t("tickets.new_ticket"),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),n("div",le,[a(J,{class:"p-6"},{default:l(()=>[n("form",{onSubmit:B(D,["prevent"])},[a(y,{label:t.$t("tickets.title"),error:g(u).formData.title.$error&&g(u).formData.title.$errors[0].$message,required:""},{default:l(()=>[a(R,{modelValue:s.title,"onUpdate:modelValue":e[1]||(e[1]=o=>s.title=o),invalid:g(u).formData.title.$error,placeholder:t.$t("tickets.title_placeholder"),onInput:e[2]||(e[2]=o=>g(u).formData.title.$touch())},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["label","error"]),a(y,{label:t.$t("tickets.description"),error:g(u).formData.message.$error&&g(u).formData.message.$errors[0].$message,required:"",class:"mt-6"},{help:l(()=>[n("span",re,d(s.message.length)+" / 5000 "+d(t.$t("general.characters")),1)]),default:l(()=>[a(X,{modelValue:s.message,"onUpdate:modelValue":e[3]||(e[3]=o=>s.message=o),invalid:g(u).formData.message.$error,placeholder:t.$t("tickets.description_placeholder"),rows:"8",onInput:e[4]||(e[4]=o=>g(u).formData.message.$touch())},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["label","error"]),n("div",ne,[a(y,{label:t.$t("tickets.priority")},{default:l(()=>[a(x,{modelValue:s.priority,"onUpdate:modelValue":e[5]||(e[5]=o=>s.priority=o),options:P,placeholder:t.$t("tickets.select_priority"),searchable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(y,{label:t.$t("tickets.category")},{default:l(()=>[a(x,{modelValue:s.categories,"onUpdate:modelValue":e[6]||(e[6]=o=>s.categories=o),options:q,placeholder:t.$t("tickets.select_category"),searchable:"",multiple:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),a(y,{label:t.$t("tickets.attachments"),class:"mt-6"},{help:l(()=>[f.value?(h(),b("span",fe,d(f.value),1)):$("",!0)]),default:l(()=>[n("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary-400 transition-colors cursor-pointer",onDrop:B(j,["prevent"]),onDragover:e[7]||(e[7]=B(()=>{},["prevent"])),onClick:e[8]||(e[8]=o=>t.$refs.fileInput.click())},[n("input",{ref_key:"fileInput",ref:N,type:"file",class:"hidden",multiple:"",accept:"image/*,application/pdf",onChange:U},null,544),a(p,{name:"DocumentArrowUpIcon",class:"h-12 w-12 mx-auto text-gray-400 mb-2"}),n("p",ie,d(t.$t("tickets.drag_drop_files")),1),n("p",ce,d(t.$t("tickets.file_types"))+": Images, PDF ("+d(t.$t("tickets.max_size"))+": 5MB) ",1)],32),v.value.length?(h(),b("div",ue,[(h(!0),b(ae,null,se(v.value,(o,C)=>(h(),b("div",{key:C,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[n("div",me,[a(p,{name:H(o.type),class:"h-5 w-5 text-gray-500"},null,8,["name"]),n("div",null,[n("p",de,d(o.name),1),n("p",pe,d(K(o.size)),1)])]),n("button",{type:"button",class:"text-red-500 hover:text-red-700",onClick:he=>G(C)},[a(p,{name:"XMarkIcon",class:"h-5 w-5"})],8,ge)]))),128))])):$("",!0)]),_:1},8,["label"])],32)]),_:1})])]),_:1})}}};export{_e as default};
