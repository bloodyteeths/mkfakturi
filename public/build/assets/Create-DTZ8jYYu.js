import{v as Q,F as x,e as D,j as q,f as p,g as y,i as W,N as X,K as _,w as u,r as i,n as Y,aF as S,J as E,h as Z,o as g,a as o,b as w,m as ee,L as h,c as ae,t as L,b9 as te,p as se,l as e,Q as oe,R as ne,q as re,M as le}from"./main-DpDYmbyp.js";import{V as ue}from"./index-DuTj-qZa.js";import{u as ie}from"./users-DA-BxhG3.js";const de={class:"grid grid-cols-12"},me={class:"mb-4 flex items-center justify-between"},ce={class:"text-sm font-medium text-gray-700"},pe={class:"space-y-6"},_e={__name:"Create",setup(ge){const t=ie(),{t:d}=Q.useI18n(),I=X(),N=Y(),R=x();let f=D(!1),l=D(!1);D([]);let U=D([]),m=D(!1);const v=q(()=>I.name==="users.edit"),M=q(()=>v.value?d("users.edit_user"):d("users.new_user")),j=q(()=>({userData:{name:{required:p.withMessage(d("validation.required"),S(()=>!m.value)),minLength:p.withMessage(d("validation.name_min_length",{count:3}),E(3))},email:{required:p.withMessage(d("validation.required"),y),email:p.withMessage(d("validation.email_incorrect"),Z)},password:{required:S(function(){return p.withMessage(d("validation.required"),y),!v.value&&!m.value}),minLength:p.withMessage(d("validation.password_min_length",{count:8}),E(8))},companies:{required:p.withMessage(d("validation.required"),y)}}})),F={role:{required:p.withMessage(d("validation.required"),y)}},n=W(j,t,{$scope:!0});G(),t.resetUserData();async function G(){var r;l.value=!0;try{v.value&&await t.fetchUser(I.params.id);let a=await R.fetchUserCompanies();(r=a==null?void 0:a.data)!=null&&r.data&&(U.value=a.data.data.map(c=>(c.role=null,c)))}catch{l.value=!1}l.value=!1}async function P(){if(n.value.$touch(),n.value.$invalid)return!0;try{f.value=!0;let r={...t.userData,is_existing_user:m.value,companies:t.userData.companies.map(c=>({role:c.role,id:c.id}))};await(v.value?t.updateUser:t.addUser)(r),N.push("/admin/users"),f.value=!1}catch{f.value=!1}}return(r,a)=>{const c=i("BaseBreadcrumbItem"),A=i("BaseBreadcrumb"),H=i("BasePageHeader"),b=i("BaseInput"),$=i("BaseInputGroup"),C=i("BaseMultiselect"),T=i("BaseInputGrid"),z=i("BaseIcon"),J=i("BaseButton"),K=i("BaseCard"),O=i("BasePage");return g(),_(O,null,{default:u(()=>[o(H,{title:M.value},{default:u(()=>[o(A,null,{default:u(()=>[o(c,{title:r.$t("general.home"),to:"dashboard"},null,8,["title"]),o(c,{title:r.$t("users.user",2),to:"/admin/users"},null,8,["title"]),o(c,{title:M.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),w("form",{action:"",autocomplete:"off",onSubmit:ee(P,["prevent"])},[w("div",de,[o(K,{class:"mt-6 col-span-12 md:col-span-8"},{default:u(()=>[o(T,{layout:"one-column"},{default:u(()=>[w("div",me,[w("label",ce,L(r.$t("users.add_existing_user")),1),o(te,{modelValue:e(m),"onUpdate:modelValue":a[0]||(a[0]=s=>se(m)?m.value=s:m=s)},null,8,["modelValue"])]),e(m)?h("",!0):(g(),_($,{key:0,"content-loading":e(l),label:r.$t("users.name"),error:e(n).userData.name.$error&&e(n).userData.name.$errors[0].$message,required:""},{default:u(()=>[o(b,{modelValue:e(t).userData.name,"onUpdate:modelValue":a[1]||(a[1]=s=>e(t).userData.name=s),modelModifiers:{trim:!0},"content-loading":e(l),invalid:e(n).userData.name.$error,onInput:a[2]||(a[2]=s=>e(n).userData.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error"])),o($,{"content-loading":e(l),label:r.$t("users.email"),error:e(n).userData.email.$error&&e(n).userData.email.$errors[0].$message,required:""},{default:u(()=>[o(b,{modelValue:e(t).userData.email,"onUpdate:modelValue":a[3]||(a[3]=s=>e(t).userData.email=s),modelModifiers:{trim:!0},type:"email","content-loading":e(l),invalid:e(n).userData.email.$error,onInput:a[4]||(a[4]=s=>e(n).userData.email.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error"]),o($,{"content-loading":e(l),label:r.$t("users.companies"),error:e(n).userData.companies.$error&&e(n).userData.companies.$errors[0].$message,required:""},{default:u(()=>[o(C,{modelValue:e(t).userData.companies,"onUpdate:modelValue":a[5]||(a[5]=s=>e(t).userData.companies=s),mode:"tags",object:!0,autocomplete:"new-password",label:"name",options:e(U),"value-prop":"id",invalid:e(n).userData.companies.$error,"content-loading":e(l),searchable:"","can-deselect":!1,class:"w-full","track-by":"name"},null,8,["modelValue","options","invalid","content-loading"])]),_:1},8,["content-loading","label","error"]),(g(!0),ae(oe,null,ne(e(t).userData.companies,(s,B)=>(g(),_(e(ue),{key:B,state:s,rules:F},{default:u(({v:V})=>[w("div",pe,[o($,{"content-loading":e(l),label:r.$t("users.select_company_role",{company:s.name}),error:V.role.$error&&V.role.$errors[0].$message,required:""},{default:u(()=>[o(C,{modelValue:e(t).userData.companies[B].role,"onUpdate:modelValue":k=>e(t).userData.companies[B].role=k,"value-prop":"name","track-by":"id",autocomplete:"off","content-loading":e(l),label:"name",options:e(t).userData.companies[B].roles,"can-deselect":!1,invalid:V.role.$invalid,onChange:k=>V.role.$touch()},null,8,["modelValue","onUpdate:modelValue","content-loading","options","invalid","onChange"])]),_:2},1032,["content-loading","label","error"])])]),_:2},1032,["state"]))),128)),e(m)?h("",!0):(g(),_($,{key:1,"content-loading":e(l),label:r.$t("users.password"),error:e(n).userData.password.$error&&e(n).userData.password.$errors[0].$message,required:!v.value},{default:u(()=>[o(b,{modelValue:e(t).userData.password,"onUpdate:modelValue":a[6]||(a[6]=s=>e(t).userData.password=s),name:"new-password",autocomplete:"new-password","content-loading":e(l),type:"password",invalid:e(n).userData.password.$error,onInput:a[7]||(a[7]=s=>e(n).userData.password.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error","required"])),e(m)?h("",!0):(g(),_($,{key:2,"content-loading":e(l),label:r.$t("users.phone")},{default:u(()=>[o(b,{modelValue:e(t).userData.phone,"onUpdate:modelValue":a[8]||(a[8]=s=>e(t).userData.phone=s),modelModifiers:{trim:!0},"content-loading":e(l)},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label"]))]),_:1}),o(J,{"content-loading":e(l),type:"submit",loading:e(f),disabled:e(f),class:"mt-6"},{left:u(s=>[e(f)?h("",!0):(g(),_(z,{key:0,name:"ArrowDownOnSquareIcon",class:le(s.class)},null,8,["class"]))]),default:u(()=>[re(" "+L(v.value?r.$t("users.update_user"):r.$t("users.save_user")),1)]),_:1},8,["content-loading","loading","disabled"])]),_:1})])],32)]),_:1})}}};export{_e as default};
