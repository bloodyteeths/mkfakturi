import{v as X,e as E,k as Z,c as h,o as d,b as t,L as w,a as n,bv as p,t as e,q as u,Q as O,R as A,M as z,K as P,m as et,j as F,ap as mt,ak as Q,a4 as xt,bw as gt,aj as st,a6 as $t,s as H,a3 as K,u as rt,w as v,bx as dt,l,ar as q,at as ot,by as ft,bz as vt,aq as ct,aw as V,n as yt,P as ht,bA as bt,bB as wt,bC as kt,ag as nt,bD as at,aB as lt,bE as Ct}from"./main-C3HD31Qx.js";const St={class:"bg-gradient-to-br from-primary-50 via-purple-50 to-blue-50 border-2 border-primary-200 rounded-xl shadow-lg overflow-hidden"},It={class:"bg-gradient-to-r from-primary-600 to-purple-600 px-6 py-4"},Mt={class:"flex items-center justify-between"},Tt={class:"flex items-center text-white"},Rt={class:"font-bold text-xl"},Pt={class:"p-6 space-y-6"},jt={class:"text-center"},qt={class:"inline-flex items-center justify-center w-16 h-16 bg-white rounded-full shadow-md mb-4"},zt={class:"text-2xl font-bold text-gray-900 mb-2"},Et={class:"text-lg text-gray-600"},Ft={class:"bg-white rounded-lg p-6 shadow-sm"},Lt={class:"font-semibold text-gray-900 mb-4 text-center"},Vt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Ut={class:"text-center"},Bt={class:"relative"},Dt={class:"w-16 h-16 mx-auto bg-primary-100 rounded-full flex items-center justify-center mb-3"},Ot={class:"font-medium text-gray-900 mb-1"},At={class:"text-xs text-gray-600"},Wt={class:"text-center"},Jt={class:"relative"},Qt={class:"w-16 h-16 mx-auto bg-purple-100 rounded-full flex items-center justify-center mb-3"},Ht={class:"font-medium text-gray-900 mb-1"},Xt={class:"text-xs text-gray-600"},Nt={class:"text-center"},Gt={class:"relative"},Yt={class:"w-16 h-16 mx-auto bg-blue-100 rounded-full flex items-center justify-center mb-3"},Kt={class:"font-medium text-gray-900 mb-1"},Zt={class:"text-xs text-gray-600"},te={class:"text-center"},ee={class:"w-16 h-16 mx-auto bg-green-100 rounded-full flex items-center justify-center mb-3"},se={class:"font-medium text-gray-900 mb-1"},oe={class:"text-xs text-gray-600"},ie={class:"flex items-center justify-center space-x-2 text-gray-600"},re={class:"font-medium"},ne={class:"bg-white rounded-lg p-6 shadow-sm"},ae={class:"font-semibold text-gray-900 mb-4 flex items-center"},le={class:"space-y-3"},ce={class:"flex-shrink-0 mt-0.5"},de={class:"ml-3 flex-1"},me={key:0,class:"text-xs text-gray-500 mt-1"},pe={class:"space-y-3"},ue={key:0,class:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded"},_e={class:"flex items-start"},he={class:"text-sm"},ge={class:"font-medium text-yellow-900 mb-1"},fe={class:"text-yellow-800"},ve={class:"border-t border-gray-200 pt-4"},ye={class:"flex items-center"},xe={class:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mr-4"},$e={class:"font-medium text-gray-900"},be={class:"text-sm text-gray-600"},we={__name:"QuickStartPanel",emits:["close","startTour","skip"],setup(m,{emit:a}){const{t:o}=X.useI18n(),s=a,g=E(!1),y=E([{text:o("imports.prereq_data_file"),hint:o("imports.prereq_data_file_hint"),checked:!0},{text:o("imports.prereq_backup"),hint:o("imports.prereq_backup_hint"),checked:!0},{text:o("imports.prereq_format"),hint:o("imports.prereq_format_hint"),checked:!0},{text:o("imports.prereq_time"),hint:null,checked:!0}]),I=()=>{localStorage.setItem("migration-wizard-tour-skipped","true"),s("skip"),s("close")},k=()=>{window.open("https://example.com/migration-wizard-tutorial","_blank")};return Z(()=>{const $=localStorage.getItem("migration-wizard-tour-completed"),C=localStorage.getItem("migration-wizard-tour-skipped");g.value=!$&&!C}),($,C)=>(d(),h("div",St,[t("div",It,[t("div",Mt,[t("div",Tt,[n(p,{name:"RocketLaunchIcon",class:"w-6 h-6 mr-3"}),t("h3",Rt,e($.$t("imports.quick_start_guide")),1)]),g.value?w("",!0):(d(),h("button",{key:0,onClick:C[0]||(C[0]=S=>$.$emit("close")),class:"text-white/80 hover:text-white transition-colors"},[n(p,{name:"XMarkIcon",class:"w-5 h-5"})]))])]),t("div",Pt,[t("div",jt,[t("div",qt,[n(p,{name:"FlagIcon",class:"w-8 h-8 text-primary-600"})]),t("h4",zt,e($.$t("imports.quickstart_goal")),1),t("p",Et,e($.$t("imports.quickstart_goal_description")),1)]),t("div",Ft,[t("h5",Lt,e($.$t("imports.quickstart_steps_title")),1),t("div",Vt,[t("div",Ut,[t("div",Bt,[t("div",Dt,[n(p,{name:"CloudArrowUpIcon",class:"w-8 h-8 text-primary-600"})]),C[2]||(C[2]=t("div",{class:"absolute top-8 left-full w-full h-0.5 bg-gray-300 hidden md:block",style:{left:"calc(50% + 32px)",width:"calc(100% - 64px)"}},[t("div",{class:"absolute -right-2 -top-1.5 w-0 h-0 border-l-8 border-l-gray-300 border-t-4 border-t-transparent border-b-4 border-b-transparent"})],-1))]),t("p",Ot,e($.$t("imports.step_1_upload")),1),t("p",At,e($.$t("imports.step_1_upload_desc")),1)]),t("div",Wt,[t("div",Jt,[t("div",Qt,[n(p,{name:"ArrowsRightLeftIcon",class:"w-8 h-8 text-purple-600"})]),C[3]||(C[3]=t("div",{class:"absolute top-8 left-full w-full h-0.5 bg-gray-300 hidden md:block",style:{left:"calc(50% + 32px)",width:"calc(100% - 64px)"}},[t("div",{class:"absolute -right-2 -top-1.5 w-0 h-0 border-l-8 border-l-gray-300 border-t-4 border-t-transparent border-b-4 border-b-transparent"})],-1))]),t("p",Ht,e($.$t("imports.step_2_map")),1),t("p",Xt,e($.$t("imports.step_2_map_desc")),1)]),t("div",Nt,[t("div",Gt,[t("div",Yt,[n(p,{name:"ShieldCheckIcon",class:"w-8 h-8 text-blue-600"})]),C[4]||(C[4]=t("div",{class:"absolute top-8 left-full w-full h-0.5 bg-gray-300 hidden md:block",style:{left:"calc(50% + 32px)",width:"calc(100% - 64px)"}},[t("div",{class:"absolute -right-2 -top-1.5 w-0 h-0 border-l-8 border-l-gray-300 border-t-4 border-t-transparent border-b-4 border-b-transparent"})],-1))]),t("p",Kt,e($.$t("imports.step_3_validate")),1),t("p",Zt,e($.$t("imports.step_3_validate_desc")),1)]),t("div",te,[t("div",ee,[n(p,{name:"CheckCircleIcon",class:"w-8 h-8 text-green-600"})]),t("p",se,e($.$t("imports.step_4_complete")),1),t("p",oe,e($.$t("imports.step_4_complete_desc")),1)])])]),t("div",ie,[n(p,{name:"ClockIcon",class:"w-5 h-5"}),t("span",re,e($.$t("imports.estimated_time")),1)]),t("div",ne,[t("h5",ae,[n(p,{name:"ClipboardDocumentCheckIcon",class:"w-5 h-5 mr-2 text-green-600"}),u(" "+e($.$t("imports.prerequisites_checklist")),1)]),t("div",le,[(d(!0),h(O,null,A(y.value,(S,B)=>(d(),h("div",{key:B,class:"flex items-start"},[t("div",ce,[t("div",{class:z(["w-5 h-5 rounded border-2 flex items-center justify-center transition-colors",S.checked?"bg-green-500 border-green-500":"border-gray-300"])},[S.checked?(d(),P(p,{key:0,name:"CheckIcon",class:"w-3 h-3 text-white"})):w("",!0)],2)]),t("div",de,[t("p",{class:z(["text-sm",S.checked?"text-gray-900":"text-gray-600"])},e(S.text),3),S.hint?(d(),h("p",me,e(S.hint),1)):w("",!0)])]))),128))])]),t("div",pe,[t("button",{onClick:C[1]||(C[1]=S=>$.$emit("startTour")),class:"w-full px-6 py-4 bg-gradient-to-r from-primary-600 to-purple-600 text-white font-semibold rounded-lg hover:from-primary-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl flex items-center justify-center"},[n(p,{name:"PlayCircleIcon",class:"w-6 h-6 mr-3"}),u(" "+e($.$t("imports.start_interactive_tour")),1)]),g.value?(d(),h("button",{key:0,onClick:I,class:"w-full px-6 py-3 bg-white text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors border border-gray-300 flex items-center justify-center"},[u(e($.$t("imports.skip_and_start"))+" ",1),n(p,{name:"ArrowRightIcon",class:"w-5 h-5 ml-2"})])):w("",!0)]),g.value?(d(),h("div",ue,[t("div",_e,[n(p,{name:"LightBulbIcon",class:"w-5 h-5 text-yellow-600 mr-3 mt-0.5 flex-shrink-0"}),t("div",he,[t("p",ge,e($.$t("imports.new_to_migration")),1),t("p",fe,e($.$t("imports.new_to_migration_tip")),1)])])])):w("",!0),t("div",ve,[t("a",{href:"#",onClick:et(k,["prevent"]),class:"flex items-center justify-between px-4 py-3 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-all"},[t("div",ye,[t("div",xe,[n(p,{name:"PlayIcon",class:"w-6 h-6 text-red-600"})]),t("div",null,[t("p",$e,e($.$t("imports.watch_quick_tutorial")),1),t("p",be,e($.$t("imports.video_duration_3min")),1)])]),n(p,{name:"ArrowTopRightOnSquareIcon",class:"w-5 h-5 text-gray-400"})])])])]))}},ke={class:"bg-gray-900 text-white rounded-lg shadow-xl overflow-hidden"},Ce={class:"relative p-4"},Se={key:0,class:"flex items-center justify-between mb-2"},Ie={class:"font-semibold text-sm"},Me=["href"],tt={__name:"HelpTooltip",props:{content:{type:String,default:""},title:{type:String,default:""},icon:{type:String,default:"QuestionMarkCircleIcon"},iconSize:{type:String,default:"sm"},iconClass:{type:String,default:"text-gray-400 hover:text-gray-600"},placement:{type:String,default:"top"},trigger:{type:String,default:"hover"},link:{type:String,default:""},linkText:{type:String,default:""},showCloseButton:{type:Boolean,default:!1}},setup(m){const{t:a}=X.useI18n(),o=m,s=E(!1),g=E(!1),y=E(null);E(null);const I=E({}),k=E({}),$=E(null),C=E(null),S=F(()=>{const M={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return M[o.iconSize]||M.sm}),B=()=>{o.trigger==="hover"&&(clearTimeout($.value),$.value=setTimeout(()=>{s.value=!0,st(()=>{U(),setTimeout(()=>{g.value=!0},10)})},200))},j=()=>{o.trigger==="hover"&&(clearTimeout($.value),clearTimeout(C.value),C.value=setTimeout(()=>{g.value=!1,setTimeout(()=>{s.value=!1},200)},100))},L=M=>{o.trigger==="click"&&(M.stopPropagation(),s.value?(g.value=!1,setTimeout(()=>{s.value=!1},200)):(s.value=!0,st(()=>{U(),setTimeout(()=>{g.value=!0},10)})))},W=()=>{clearTimeout(C.value)},U=()=>{var _t;const M=((_t=event==null?void 0:event.target)==null?void 0:_t.closest("button"))||document.querySelector(".help-tooltip-trigger");if(!M)return;const _=M.getBoundingClientRect(),x=y.value;if(!x)return;const i=x.getBoundingClientRect(),c=window.pageYOffset||document.documentElement.scrollTop,b=window.pageXOffset||document.documentElement.scrollLeft;let r=0,f=0,R="",T="",J="",N="";const G=12,Y=6;switch(o.placement){case"top":r=_.top+c-i.height-G,f=_.left+b+_.width/2-i.width/2,N=`-${Y}px`,T="50%",k.value={bottom:N,left:T,transform:"translateX(-50%)"};break;case"bottom":r=_.bottom+c+G,f=_.left+b+_.width/2-i.width/2,R=`-${Y}px`,T="50%",k.value={top:R,left:T,transform:"translateX(-50%)"};break;case"left":r=_.top+c+_.height/2-i.height/2,f=_.left+b-i.width-G,R="50%",J=`-${Y}px`,k.value={top:R,right:J,transform:"translateY(-50%)"};break;case"right":r=_.top+c+_.height/2-i.height/2,f=_.right+b+G,R="50%",T=`-${Y}px`,k.value={top:R,left:T,transform:"translateY(-50%)"};break}const pt=window.innerWidth,ut=window.innerHeight;f<10&&(f=10),f+i.width>pt-10&&(f=pt-i.width-10),r<10&&(r=10),r+i.height>ut+c-10&&(r=ut+c-i.height-10),I.value={top:`${r}px`,left:`${f}px`}},D=M=>{if(o.trigger!=="click")return;const _=M.target.closest("button"),x=y.value;!_&&!(x!=null&&x.contains(M.target))&&(g.value=!1,setTimeout(()=>{s.value=!1},200))};return mt(()=>{clearTimeout($.value),clearTimeout(C.value),document.removeEventListener("click",D)}),o.trigger==="click"&&document.addEventListener("click",D),(M,_)=>(d(),h("div",{class:"inline-flex items-center relative",onMouseenter:B,onMouseleave:j},[t("button",{type:"button",class:z(["inline-flex items-center justify-center transition-colors focus:outline-none",m.iconClass]),onClick:L},[n(p,{name:m.icon,class:z(S.value)},null,8,["name","class"])],2),(d(),P(gt,{to:"body"},[s.value?(d(),h("div",{key:0,ref_key:"tooltipRef",ref:y,class:z(["fixed z-50 max-w-sm transition-opacity duration-200",{"opacity-0":!g.value,"opacity-100":g.value}]),style:Q(I.value),onMouseenter:W,onMouseleave:j},[t("div",ke,[t("div",{class:"absolute w-3 h-3 bg-gray-900 transform rotate-45",style:Q(k.value)},null,4),t("div",Ce,[m.title?(d(),h("div",Se,[t("h5",Ie,e(m.title),1),m.showCloseButton?(d(),h("button",{key:0,onClick:j,class:"text-white/70 hover:text-white transition-colors ml-2"},[n(p,{name:"XMarkIcon",class:"w-4 h-4"})])):w("",!0)])):w("",!0),t("div",{class:z(["text-sm leading-relaxed",{"text-gray-300":m.title}])},[xt(M.$slots,"default",{},()=>[u(e(m.content),1)])],2),m.link?(d(),h("a",{key:1,href:m.link,target:"_blank",class:"inline-flex items-center mt-3 text-primary-400 hover:text-primary-300 text-sm font-medium"},[u(e(m.linkText||M.$t("imports.learn_more"))+" ",1),n(p,{name:"ArrowTopRightOnSquareIcon",class:"w-4 h-4 ml-1"})],8,Me)):w("",!0)])])],38)):w("",!0)]))],32))}},it=$t("import",{state:()=>({currentStep:1,totalSteps:4,canProceed:!1,isLoading:!1,importJob:null,importId:null,uploadedFile:null,fileInfo:null,supportedFormats:["csv","xls","xlsx","xml"],uploadProgress:0,isUploading:!1,detectedImportType:null,detectionConfidence:0,manualTypeOverride:null,detectedFields:[],mappingSuggestions:{},fieldMappings:{},mappingErrors:[],autoMappingConfidence:0,validationResults:null,validationErrors:[],validationWarnings:[],conflictResolutions:{},isValidating:!1,commitProgress:0,commitStatus:"pending",commitResults:null,isCommitting:!1,pollingInterval:null,errors:{},hasErrors:!1}),getters:{isStep1Valid(){return this.uploadedFile&&this.fileInfo&&!this.isUploading},isStep2Valid(){return Object.keys(this.fieldMappings).length>0&&this.mappingErrors.length===0},isStep3Valid(){return this.validationResults&&this.validationErrors.length===0&&!this.isValidating},isStep4Valid(){return this.commitStatus==="completed"},overallProgress(){const m=(this.currentStep-1)/this.totalSteps*100;return this.currentStep===4&&this.isCommitting?m+this.commitProgress/this.totalSteps:m},fileType(){if(!this.fileInfo)return null;const m=this.fileInfo.name.split(".").pop().toLowerCase();return this.supportedFormats.includes(m)?m:null},totalRecords(){var m;return((m=this.validationResults)==null?void 0:m.total_records)||0},validRecords(){var m;return((m=this.validationResults)==null?void 0:m.valid_records)||0},invalidRecords(){var m;return((m=this.validationResults)==null?void 0:m.invalid_records)||0}},actions:{nextStep(){this.currentStep<this.totalSteps&&this.canProceedToNextStep()&&(this.currentStep++,this.updateCanProceed())},previousStep(){this.currentStep>1&&(this.currentStep--,this.updateCanProceed())},goToStep(m){m>=1&&m<=this.totalSteps&&(this.currentStep=m,this.updateCanProceed())},canProceedToNextStep(){switch(this.currentStep){case 1:return this.isStep1Valid;case 2:return this.isStep2Valid;case 3:return this.isStep3Valid;case 4:return!1;default:return!1}},updateCanProceed(){const m=this.canProceedToNextStep();console.log("[importStore] updateCanProceed",{currentStep:this.currentStep,canProceed:m,isStep1Valid:this.isStep1Valid,uploadedFile:this.uploadedFile,fileInfo:this.fileInfo,isUploading:this.isUploading}),this.canProceed=m},detectTypeFromHeaders(m){if(!m||m.length===0)return{type:null,confidence:0};const a=m.map(k=>k.toLowerCase().trim().replace(/[\s_-]/g,"_")),o={customers:{requiredPatterns:["name","email"],optionalPatterns:["phone","address","vat_number","customer_name","telephone","mobile","street","city","zip","postal_code","country","tax_id","website","currency","billing_address"]},invoices:{requiredPatterns:["invoice_number","invoice_date"],optionalPatterns:["due_date","total","subtotal","tax","amount","discount","notes","description","customer_name","status","currency","customer_id"]},items:{requiredPatterns:["name","price"],optionalPatterns:["description","unit","sku","tax_rate","quantity","qty","category","tax_type","unit_price","product_name","item_name"]},payments:{requiredPatterns:["payment_date","amount"],optionalPatterns:["payment_method","invoice_number","paid_on","payment_type","currency","reference","notes","description"]}},s={};let g=0,y=null;for(const[k,$]of Object.entries(o)){let C=0;const S=$.requiredPatterns.length+$.optionalPatterns.length;for(const j of $.requiredPatterns)a.some(L=>L.includes(j)||j.includes(L))&&(C+=2);for(const j of $.optionalPatterns)a.some(L=>L.includes(j)||j.includes(L))&&(C+=1);s[k]=C,C/(S*2)>.3&&C>g&&(g=C,y=k)}const I=y?s[y]/(o[y].requiredPatterns.length+o[y].optionalPatterns.length)/2:0;return{type:y,confidence:Math.min(I,1),scores:s}},async detectTypeFromFile(m){return new Promise(a=>{if(m.name.split(".").pop().toLowerCase()!=="csv"){a({type:null,confidence:0});return}const s=new FileReader;s.onload=y=>{try{const $=y.target.result.split(`
`)[0],C=this.parseCSVLine($);console.log("[importStore] Detected headers:",C);const S=this.detectTypeFromHeaders(C);console.log("[importStore] Type detection result:",{type:S.type,confidence:S.confidence,scores:S.scores}),a(S)}catch(I){console.error("[importStore] Error detecting type from file:",I),a({type:null,confidence:0})}},s.onerror=()=>{console.error("[importStore] FileReader error"),a({type:null,confidence:0})};const g=m.slice(0,1024);s.readAsText(g,"utf-8")})},parseCSVLine(m){const a=[];let o="",s=!1;for(let g=0;g<m.length;g++){const y=m[g],I=m[g+1];y==='"'?s&&I==='"'?(o+='"',g++):s=!s:y===","&&!s?(a.push(o.trim()),o=""):o+=y}return o&&a.push(o.trim()),a},async uploadFile(m){var a,o;this.isUploading=!0,this.uploadProgress=0,this.resetErrors();try{let s="universal_migration",g=0;const y=await this.detectTypeFromFile(m);y.type&&y.confidence>=.3?(s=y.type,g=y.confidence,console.log("[importStore] Using detected type:",{type:s,confidence:g})):console.log("[importStore] Using default type: universal_migration"),this.detectedImportType=y.type,this.detectionConfidence=y.confidence,this.manualTypeOverride&&(s=this.manualTypeOverride,console.log("[importStore] Using manual type override:",s));const I=new FormData;I.append("file",m),I.append("type",s);const k=await H.post("/admin/imports",I,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:S=>{this.uploadProgress=Math.round(S.loaded*100/S.total)}});console.log("[importStore] Upload response:",k.data),this.importJob=k.data.data,this.importId=this.importJob.id,this.uploadedFile=m,this.fileInfo={name:m.name,size:m.size,type:m.type,lastModified:m.lastModified},console.log("[importStore] State after upload:",{importJob:this.importJob,importId:this.importId,uploadedFile:this.uploadedFile,fileInfo:this.fileInfo,isUploading:this.isUploading});const $=rt(),{global:C}=window.i18n;return $.showNotification({type:"success",message:C.t("imports.file_uploaded_successfully")}),k.data}catch(s){throw this.setError("upload",((o=(a=s.response)==null?void 0:a.data)==null?void 0:o.message)||"Upload failed"),K(s),s}finally{this.isUploading=!1,this.updateCanProceed()}},removeFile(){this.uploadedFile=null,this.fileInfo=null,this.uploadProgress=0,this.importJob=null,this.importId=null,this.detectedImportType=null,this.detectionConfidence=0,this.manualTypeOverride=null,this.resetState(),this.updateCanProceed()},async detectFields(){var m,a;if(this.importId){this.isLoading=!0,this.resetErrors();try{const s=(await H.get(`/admin/imports/${this.importId}`)).data.data;this.importJob=s,this.detectedFields=s.detected_fields||[],this.mappingSuggestions=s.mapping_suggestions||{},this.autoMappingConfidence=s.auto_mapping_confidence||0,this.applyAutoMapping()}catch(o){this.setError("detection",((a=(m=o.response)==null?void 0:m.data)==null?void 0:a.message)||"Field detection failed"),K(o)}finally{this.isLoading=!1}}},applyAutoMapping(){this.fieldMappings={...this.mappingSuggestions},this.validateMappings(),this.updateCanProceed()},updateMapping(m,a){a?this.fieldMappings[m]=a:delete this.fieldMappings[m],this.validateMappings(),this.updateCanProceed()},validateMappings(){var y,I,k;this.mappingErrors=[];const m=((y=this.importJob)==null?void 0:y.type)||"customers";console.log("[validateMappings] Debug:",{importType:m,hasImportJob:!!this.importJob,importJobType:(I=this.importJob)==null?void 0:I.type,importJobId:(k=this.importJob)==null?void 0:k.id});const o={customers:["name","email"],invoices:["invoice_number","customer_name","invoice_date","total"],items:["name","price"],payments:["payment_date","amount"],expenses:["expense_date","amount"]}[m]||[],s=Object.values(this.fieldMappings);console.log("[validateMappings] Required fields for",m,":",o),console.log("[validateMappings] Mapped targets:",s),o.forEach($=>{s.includes($)||this.mappingErrors.push(`Required field '${$}' is not mapped`)}),s.filter(($,C)=>s.indexOf($)!==C).forEach($=>{this.mappingErrors.push(`Field '${$}' is mapped multiple times`)})},async saveMapping(){var m,a;if(this.importId){this.isLoading=!0,this.resetErrors();try{const o=await H.post(`/admin/imports/${this.importId}/mapping`,{mappings:this.fieldMappings});this.importJob=o.data.data,this.updateCanProceed();const s=rt(),{global:g}=window.i18n;return s.showNotification({type:"success",message:g.t("imports.mapping_saved_successfully")}),o.data}catch(o){throw this.setError("mapping",((a=(m=o.response)==null?void 0:m.data)==null?void 0:a.message)||"Mapping save failed"),K(o),o}finally{this.isLoading=!1}}},async validateData(){var m,a;if(this.importId){this.isValidating=!0,this.resetErrors();try{const o=await H.post(`/admin/imports/${this.importId}/validate`);return this.validationResults=o.data.data,this.validationErrors=o.data.data.errors||[],this.validationWarnings=o.data.data.warnings||[],o.data.data.status==="validating"&&this.startProgressPolling(),o.data}catch(o){throw this.setError("validation",((a=(m=o.response)==null?void 0:m.data)==null?void 0:a.message)||"Validation failed"),K(o),o}finally{this.isValidating=!1,this.updateCanProceed()}}},resolveConflict(m,a){this.conflictResolutions[m]=a},async commitImport(){var m,a;if(this.importId){this.isCommitting=!0,this.commitStatus="processing",this.commitProgress=0,this.resetErrors();try{const o=await H.post(`/admin/imports/${this.importId}/commit`,{conflict_resolutions:this.conflictResolutions});return this.commitResults=o.data.data,this.startProgressPolling(),o.data}catch(o){throw this.commitStatus="failed",this.isCommitting=!1,this.setError("commit",((a=(m=o.response)==null?void 0:m.data)==null?void 0:a.message)||"Commit failed"),K(o),o}}},async startProgressPolling(){this.pollingInterval&&clearInterval(this.pollingInterval),this.pollingInterval=setInterval(async()=>{try{await this.fetchProgress()}catch(m){console.error("Progress polling error:",m),this.stopProgressPolling()}},2e3)},stopProgressPolling(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)},async fetchProgress(){if(this.importId)try{const a=(await H.get(`/admin/imports/${this.importId}/progress`)).data.data;if(this.currentStep===3&&this.isValidating)a.status==="completed"&&(this.validationResults=a.results,this.isValidating=!1,this.stopProgressPolling(),this.updateCanProceed());else if(this.currentStep===4&&this.isCommitting)if(this.commitProgress=a.progress||0,a.status==="completed"){this.commitStatus="completed",this.commitResults=a.results,this.isCommitting=!1,this.stopProgressPolling(),this.updateCanProceed();const o=rt(),{global:s}=window.i18n;o.showNotification({type:"success",message:s.t("imports.import_completed_successfully")})}else a.status==="failed"&&(this.commitStatus="failed",this.isCommitting=!1,this.stopProgressPolling(),this.setError("commit",a.error||"Import failed"));return a}catch(m){console.error("Progress fetch error:",m)}},resetState(){this.currentStep=1,this.canProceed=!1,this.detectedFields=[],this.mappingSuggestions={},this.fieldMappings={},this.mappingErrors=[],this.validationResults=null,this.validationErrors=[],this.validationWarnings=[],this.conflictResolutions={},this.commitProgress=0,this.commitStatus="pending",this.commitResults=null,this.resetErrors(),this.stopProgressPolling()},resetErrors(){this.errors={},this.hasErrors=!1},setError(m,a){this.errors[m]=a,this.hasErrors=!0},getError(m){return this.errors[m]||null},async cancelImport(){if(this.importId)try{await H.delete(`/admin/imports/${this.importId}`);const m=rt(),{global:a}=window.i18n;m.showNotification({type:"success",message:a.t("imports.import_cancelled_successfully")})}catch(m){K(m)}finally{this.resetState(),this.removeFile()}},async fetchLogs(){if(!this.importId)return[];try{return(await H.get(`/admin/imports/${this.importId}/logs`)).data.data}catch(m){return K(m),[]}}}}),Te={class:"space-y-6"},Re={key:0,class:"mb-6"},Pe={class:"text-center"},je={class:"text-gray-600 max-w-2xl mx-auto"},qe={class:"max-w-4xl mx-auto"},ze={key:0,class:"space-y-6"},Ee={class:"space-y-4"},Fe={class:"mx-auto w-16 h-16 flex items-center justify-center"},Le={class:"text-lg font-medium text-gray-900 mb-1"},Ve={class:"text-sm text-gray-500"},Ue={key:0,class:"max-w-xs mx-auto"},Be={class:"flex justify-between text-sm font-medium text-gray-900 mb-2"},De={class:"w-full bg-gray-200 rounded-full h-2"},Oe=["accept","disabled"],Ae={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},We={class:"flex items-start"},Je={class:"flex-1"},Qe={class:"flex items-center justify-between mb-1"},He={class:"text-sm font-medium text-blue-900"},Xe={class:"text-sm text-blue-700 space-y-2"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ge={class:"font-medium mb-1"},Ye={class:"space-y-1"},Ke={class:"flex items-center"},Ze={class:"flex items-center"},ts={class:"flex items-center"},es={class:"font-medium mb-1"},ss={class:"space-y-1"},os={class:"flex items-center"},is={class:"flex items-center"},rs={class:"flex items-center"},ns={class:"flex items-center"},as={class:"template-download-section bg-green-50 border border-green-200 rounded-lg p-4"},ls={class:"flex items-start"},cs={class:"flex-1"},ds={class:"flex items-center justify-between mb-1"},ms={class:"text-sm font-medium text-green-900"},ps={class:"text-sm text-green-700 mb-3"},us={class:"grid grid-cols-1 md:grid-cols-2 gap-2"},_s={class:"flex items-center text-green-900"},hs={class:"flex items-center text-green-900"},gs={class:"flex items-center text-green-900"},fs={class:"flex items-center text-green-900"},vs={key:1,class:"space-y-6"},ys={class:"bg-green-50 border border-green-200 rounded-lg p-6"},xs={class:"flex items-start"},$s={class:"flex-1"},bs={class:"text-lg font-medium text-green-900 mb-2"},ws={class:"bg-white rounded-lg border border-green-200 p-4"},ks={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Cs={class:"space-y-2"},Ss={class:"flex justify-between"},Is={class:"text-sm font-medium text-gray-500"},Ms={class:"text-sm text-gray-900"},Ts={class:"flex justify-between"},Rs={class:"text-sm font-medium text-gray-500"},Ps={class:"text-sm text-gray-900 uppercase"},js={class:"flex justify-between"},qs={class:"text-sm font-medium text-gray-500"},zs={class:"text-sm text-gray-900"},Es={class:"space-y-2"},Fs={class:"flex justify-between"},Ls={class:"text-sm font-medium text-gray-500"},Vs={class:"text-sm text-gray-900 font-mono"},Us={class:"flex justify-between"},Bs={class:"text-sm font-medium text-gray-500"},Ds={class:"text-sm"},Os={class:"flex justify-between"},As={class:"text-sm font-medium text-gray-500"},Ws={class:"text-sm text-gray-900"},Js={key:0,class:"mt-4 pt-4 border-t border-green-200"},Qs={class:"flex items-center justify-between"},Hs={class:"flex items-center"},Xs={class:"text-sm font-medium text-gray-700"},Ns={class:"flex items-center space-x-2"},Gs={class:"text-xs text-gray-500"},Ys={class:"mt-4 pt-4 border-t border-green-200"},Ks={class:"space-y-2"},Zs={class:"text-sm font-medium text-gray-700 flex items-center"},to={class:"flex justify-between items-center mt-4"},eo={class:"text-sm text-green-700"},so={key:0,class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},oo={class:"text-sm font-medium text-gray-900 mb-2"},io={class:"grid grid-cols-2 gap-4 text-sm"},ro={class:"flex justify-between"},no={class:"text-gray-500"},ao={class:"text-gray-900"},lo={class:"flex justify-between"},co={class:"text-gray-500"},mo={class:"text-gray-900"},po={class:"max-w-4xl mx-auto"},uo={class:"tips-section bg-gray-50 border border-gray-200 rounded-lg p-6"},_o={class:"flex items-center justify-between mb-3"},ho={class:"text-sm font-medium text-gray-900"},go={class:"space-y-2 text-sm text-gray-600"},fo={class:"flex items-start"},vo={class:"flex items-start"},yo={class:"flex items-start"},xo={class:"flex items-start"},$o={__name:"Step1Upload",emits:["startTour"],setup(m,{emit:a}){const{t:o}=X.useI18n(),s=it(),g=E(!1),y=E(null),I=E(!1),k=E(null),$=F(()=>s.supportedFormats.map(r=>`.${r}`).join(",")),C=F(()=>[{id:"auto",value:null,label:o("imports.use_detected_type")},{id:"customers",value:"customers",label:o("imports.type_customers")},{id:"invoices",value:"invoices",label:o("imports.type_invoices")},{id:"items",value:"items",label:o("imports.type_items")},{id:"payments",value:"payments",label:o("imports.type_payments")},{id:"expenses",value:"expenses",label:o("imports.type_expenses")}]),S=r=>{const f=(r==null?void 0:r.value)??null;s.manualTypeOverride=f,console.log("[Step1Upload] Manual type override set to:",f)},B=r=>{r.preventDefault(),g.value=!0},j=r=>{r.preventDefault(),g.value=!1},L=r=>{r.preventDefault(),g.value=!1;const f=r.dataTransfer.files;f.length>0&&U(f[0])},W=r=>{const f=r.target.files[0];f&&U(f),r.target.value=""},U=async r=>{var T,J;y.value=null;const f=r.name.split(".").pop().toLowerCase();if(!s.supportedFormats.includes(f)){y.value=o("imports.unsupported_file_format",{format:f,supported:s.supportedFormats.join(", ")});return}const R=50*1024*1024;if(r.size>R){y.value=o("imports.file_too_large",{size:M(r.size),maxSize:M(R)});return}try{await s.uploadFile(r)}catch(N){y.value=((J=(T=N.response)==null?void 0:T.data)==null?void 0:J.message)||o("imports.upload_failed")}},D=()=>{s.removeFile(),y.value=null,k.value=null},M=r=>{if(r===0)return"0 Bytes";const f=1024,R=["Bytes","KB","MB","GB"],T=Math.floor(Math.log(r)/Math.log(f));return parseFloat((r/Math.pow(f,T)).toFixed(2))+" "+R[T]},_=r=>new Date(r).toLocaleString(),x=async r=>{try{const f=await window.axios.get(`/migration/templates/${r}`,{responseType:"blob"}),R=new Blob([f.data],{type:"text/csv; charset=UTF-8"}),T=window.URL.createObjectURL(R),J=document.createElement("a");J.href=T;const N=f.headers["content-disposition"];let G=`${r}_import_template.csv`;if(N){const Y=N.match(/filename="?(.+)"?/);Y&&(G=Y[1])}J.download=G,document.body.appendChild(J),J.click(),document.body.removeChild(J),window.URL.revokeObjectURL(T)}catch(f){console.error("Template download failed:",f),y.value=o("imports.template_download_failed")}},i=()=>{I.value=!1,localStorage.setItem("migration-wizard-quickstart-hidden","true")},c=r=>r?{customers:o("imports.type_customers"),invoices:o("imports.type_invoices"),items:o("imports.type_items"),payments:o("imports.type_payments")}[r]||r.charAt(0).toUpperCase()+r.slice(1):"-",b=()=>{const r=s.detectionConfidence;return r>=.7?"success":r>=.5?"warning":"info"};return Z(()=>{console.log("[Step1Upload] Component mounted"),console.log("[Step1Upload] importStore:",s),console.log("[Step1Upload] importStore.uploadedFile:",s.uploadedFile),console.log("[Step1Upload] importStore.supportedFormats:",s.supportedFormats),k.value=s.manualTypeOverride;const r=localStorage.getItem("migration-wizard-quickstart-hidden"),f=localStorage.getItem("migration-wizard-tour-completed");console.log("[Step1Upload] hasSeenQuickStart:",r),console.log("[Step1Upload] tourCompleted:",f),!r&&!f&&(I.value=!0,console.log("[Step1Upload] Showing QuickStart panel")),console.log("[Step1Upload] showQuickStart.value:",I.value),console.log("[Step1Upload] Component setup complete")}),(r,f)=>{var R;return d(),h("div",Te,[I.value?(d(),h("div",Re,[n(we,{onClose:i,onStartTour:f[0]||(f[0]=T=>r.$emit("startTour")),onSkip:i})])):w("",!0),t("div",Pe,[n(dt,{tag:"h2",class:"text-2xl font-bold text-gray-900 mb-2 flex items-center justify-center"},{default:v(()=>[u(e(r.$t("imports.upload_file"))+" ",1),n(tt,{title:r.$t("imports.upload_step_help_title"),content:r.$t("imports.upload_step_help_content"),icon:"QuestionMarkCircleIcon",placement:"right",class:"ml-2"},null,8,["title","content"])]),_:1}),t("p",je,e(r.$t("imports.upload_file_description_detailed")),1)]),t("div",qe,[l(s).uploadedFile?(d(),h("div",vs,[t("div",ys,[t("div",xs,[n(p,{name:"CheckCircleIcon",class:"w-6 h-6 text-green-400 mt-1 mr-4 flex-shrink-0"}),t("div",$s,[t("h3",bs,e(r.$t("imports.file_uploaded_successfully")),1),t("div",ws,[t("div",ks,[t("div",Cs,[t("div",Ss,[t("span",Is,e(r.$t("imports.filename"))+":",1),t("span",Ms,e(l(s).fileInfo.name),1)]),t("div",Ts,[t("span",Rs,e(r.$t("imports.format"))+":",1),t("span",Ps,e(l(s).fileType),1)]),t("div",js,[t("span",qs,e(r.$t("imports.file_size"))+":",1),t("span",zs,e(M(l(s).fileInfo.size)),1)])]),t("div",Es,[t("div",Fs,[t("span",Ls,e(r.$t("imports.import_id"))+":",1),t("span",Vs,e(l(s).importId),1)]),t("div",Us,[t("span",Bs,e(r.$t("imports.status"))+":",1),t("span",Ds,[n(ot,{variant:"success"},{default:v(()=>[u(e(r.$t("imports.uploaded")),1)]),_:1})])]),t("div",Os,[t("span",As,e(r.$t("imports.uploaded_at"))+":",1),t("span",Ws,e(_(l(s).fileInfo.lastModified)),1)])])]),l(s).detectedImportType?(d(),h("div",Js,[t("div",Qs,[t("div",Hs,[n(p,{name:"LightBulbIcon",class:"w-5 h-5 text-yellow-500 mr-2"}),t("span",Xs,e(r.$t("imports.detected_type"))+":",1)]),t("div",Ns,[n(ot,{variant:b()},{default:v(()=>[u(e(c(l(s).detectedImportType)),1)]),_:1},8,["variant"]),t("span",Gs," ("+e(Math.round(l(s).detectionConfidence*100))+"% "+e(r.$t("imports.confidence"))+") ",1)])])])):w("",!0),t("div",Ys,[t("div",Ks,[t("label",Zs,[u(e(r.$t("imports.override_type"))+" ",1),n(tt,{content:r.$t("imports.override_type_help"),icon:"InformationCircleIcon","icon-class":"text-gray-500 hover:text-gray-700",placement:"right",class:"ml-2"},null,8,["content"])]),n(ft,{modelValue:k.value,"onUpdate:modelValue":[f[6]||(f[6]=T=>k.value=T),S],options:C.value,placeholder:r.$t("imports.select_type_override")},null,8,["modelValue","options","placeholder"])])])]),t("div",to,[n(q,{variant:"secondary",size:"sm",onClick:D},{default:v(()=>[u(e(r.$t("imports.upload_different_file")),1)]),_:1}),t("div",eo,e(r.$t("imports.ready_for_mapping")),1)])])])]),l(s).importJob?(d(),h("div",so,[t("h4",oo,e(r.$t("imports.import_job_details")),1),t("div",io,[t("div",ro,[t("span",no,e(r.$t("imports.job_type"))+":",1),t("span",ao,e(l(s).importJob.type),1)]),t("div",lo,[t("span",co,e(r.$t("imports.company"))+":",1),t("span",mo,e(((R=l(s).importJob.company)==null?void 0:R.name)||"-"),1)])])])):w("",!0)])):(d(),h("div",ze,[t("div",{class:z(["upload-area",["border-2 border-dashed rounded-lg p-8 text-center transition-colors",{"border-primary-300 bg-primary-50":g.value,"border-gray-300 hover:border-gray-400":!g.value&&!l(s).isUploading,"border-gray-200 bg-gray-50":l(s).isUploading}]]),onDragover:et(B,["prevent"]),onDragleave:et(j,["prevent"]),onDrop:et(L,["prevent"])},[t("div",Ee,[t("div",Fe,[l(s).isUploading?(d(),P(ct,{key:1,class:"w-12 h-12 text-primary-600"})):(d(),P(p,{key:0,name:"CloudUploadIcon",class:"w-12 h-12 text-gray-400"}))]),t("div",null,[t("p",Le,e(l(s).isUploading?r.$t("imports.uploading"):r.$t("imports.drag_drop_files")),1),t("p",Ve,e(r.$t("imports.or_click_to_browse")),1)]),l(s).isUploading?(d(),h("div",Ue,[t("div",Be,[t("span",null,e(r.$t("imports.uploading")),1),t("span",null,e(l(s).uploadProgress)+"%",1)]),t("div",De,[t("div",{class:"bg-primary-600 h-2 rounded-full transition-all duration-300",style:Q({width:`${l(s).uploadProgress}%`})},null,4)])])):w("",!0),t("input",{ref:"fileInput",type:"file",accept:$.value,onChange:W,disabled:l(s).isUploading,class:"hidden"},null,40,Oe),l(s).isUploading?w("",!0):(d(),P(q,{key:1,variant:"primary",onClick:f[1]||(f[1]=T=>r.$refs.fileInput.click())},{default:v(()=>[u(e(r.$t("imports.browse_files")),1)]),_:1}))])],34),t("div",Ae,[t("div",We,[n(p,{name:"InformationCircleIcon",class:"w-5 h-5 text-blue-400 mt-0.5 mr-3 flex-shrink-0"}),t("div",Je,[t("div",Qe,[t("h4",He,e(r.$t("imports.supported_formats")),1),n(tt,{title:r.$t("imports.format_help_title"),content:r.$t("imports.format_help_content"),icon:"QuestionMarkCircleIcon","icon-class":"text-blue-500 hover:text-blue-700",placement:"left"},null,8,["title","content"])]),t("div",Xe,[t("div",Ne,[t("div",null,[t("p",Ge,e(r.$t("imports.file_formats"))+":",1),t("ul",Ye,[t("li",Ke,[n(p,{name:"DocumentIcon",class:"w-4 h-4 mr-2"}),f[7]||(f[7]=u(" CSV (.csv) ",-1))]),t("li",Ze,[n(p,{name:"DocumentIcon",class:"w-4 h-4 mr-2"}),f[8]||(f[8]=u(" Excel (.xls, .xlsx) ",-1))]),t("li",ts,[n(p,{name:"DocumentIcon",class:"w-4 h-4 mr-2"}),f[9]||(f[9]=u(" XML (.xml) ",-1))])])]),t("div",null,[t("p",es,e(r.$t("imports.supported_sources"))+":",1),t("ul",ss,[t("li",os,[n(p,{name:"BuildingOfficeIcon",class:"w-4 h-4 mr-2"}),f[10]||(f[10]=u(" Onivo ",-1))]),t("li",is,[n(p,{name:"BuildingOfficeIcon",class:"w-4 h-4 mr-2"}),f[11]||(f[11]=u(" Megasoft ",-1))]),t("li",rs,[n(p,{name:"BuildingOfficeIcon",class:"w-4 h-4 mr-2"}),f[12]||(f[12]=u(" Pantheon ",-1))]),t("li",ns,[n(p,{name:"DocumentIcon",class:"w-4 h-4 mr-2"}),u(" "+e(r.$t("imports.generic_formats")),1)])])])])])])])]),t("div",as,[t("div",ls,[n(p,{name:"DocumentDownloadIcon",class:"w-5 h-5 text-green-400 mt-0.5 mr-3 flex-shrink-0"}),t("div",cs,[t("div",ds,[t("h4",ms,e(r.$t("imports.download_csv_templates")),1),n(tt,{title:r.$t("imports.template_help_title"),content:r.$t("imports.template_help_content"),icon:"QuestionMarkCircleIcon","icon-class":"text-green-600 hover:text-green-800",placement:"left"},null,8,["title","content"])]),t("p",ps,e(r.$t("imports.download_csv_templates_description")),1),t("div",us,[t("button",{onClick:f[2]||(f[2]=T=>x("customers")),class:"flex items-center justify-between px-3 py-2 bg-white border border-green-300 rounded-md hover:bg-green-100 transition-colors text-sm"},[t("span",_s,[n(p,{name:"UsersIcon",class:"w-4 h-4 mr-2"}),u(" "+e(r.$t("imports.customer_template")),1)]),n(p,{name:"ArrowDownTrayIcon",class:"w-4 h-4 text-green-600"})]),t("button",{onClick:f[3]||(f[3]=T=>x("items")),class:"flex items-center justify-between px-3 py-2 bg-white border border-green-300 rounded-md hover:bg-green-100 transition-colors text-sm"},[t("span",hs,[n(p,{name:"CubeIcon",class:"w-4 h-4 mr-2"}),u(" "+e(r.$t("imports.items_template")),1)]),n(p,{name:"ArrowDownTrayIcon",class:"w-4 h-4 text-green-600"})]),t("button",{onClick:f[4]||(f[4]=T=>x("invoices")),class:"flex items-center justify-between px-3 py-2 bg-white border border-green-300 rounded-md hover:bg-green-100 transition-colors text-sm"},[t("span",gs,[n(p,{name:"DocumentTextIcon",class:"w-4 h-4 mr-2"}),u(" "+e(r.$t("imports.invoice_template")),1)]),n(p,{name:"ArrowDownTrayIcon",class:"w-4 h-4 text-green-600"})]),t("button",{onClick:f[5]||(f[5]=T=>x("invoice_with_items")),class:"flex items-center justify-between px-3 py-2 bg-white border border-green-300 rounded-md hover:bg-green-100 transition-colors text-sm"},[t("span",fs,[n(p,{name:"DocumentDuplicateIcon",class:"w-4 h-4 mr-2"}),u(" "+e(r.$t("imports.invoice_with_items_template")),1)]),n(p,{name:"ArrowDownTrayIcon",class:"w-4 h-4 text-green-600"})])])])])])]))]),y.value?(d(),P(vt,{key:1,class:"max-w-4xl mx-auto"},{default:v(()=>[u(e(y.value),1)]),_:1})):w("",!0),t("div",po,[t("div",uo,[t("div",_o,[t("h4",ho,e(r.$t("imports.tips_for_best_results")),1),n(tt,{content:r.$t("imports.tips_help_content"),icon:"InformationCircleIcon","icon-class":"text-gray-500 hover:text-gray-700",placement:"left"},null,8,["content"])]),t("ul",go,[t("li",fo,[n(p,{name:"LightBulbIcon",class:"w-4 h-4 mt-0.5 mr-2 text-yellow-500 flex-shrink-0"}),u(" "+e(r.$t("imports.tip_column_headers")),1)]),t("li",vo,[n(p,{name:"LightBulbIcon",class:"w-4 h-4 mt-0.5 mr-2 text-yellow-500 flex-shrink-0"}),u(" "+e(r.$t("imports.tip_macedonian_headers")),1)]),t("li",yo,[n(p,{name:"LightBulbIcon",class:"w-4 h-4 mt-0.5 mr-2 text-yellow-500 flex-shrink-0"}),u(" "+e(r.$t("imports.tip_file_size")),1)]),t("li",xo,[n(p,{name:"LightBulbIcon",class:"w-4 h-4 mt-0.5 mr-2 text-yellow-500 flex-shrink-0"}),u(" "+e(r.$t("imports.tip_backup_data")),1)])])])])])}}},bo={class:"space-y-6"},wo={class:"text-center"},ko={class:"text-gray-600 max-w-3xl mx-auto"},Co={key:0,class:"max-w-6xl mx-auto"},So={class:"flex items-start"},Io={class:"flex-1"},Mo={class:"text-sm font-medium mb-1"},To={class:"text-sm mb-3"},Ro={class:"flex items-center space-x-4"},Po={class:"flex-1"},jo={class:"w-full bg-gray-200 rounded-full h-2"},qo={class:"max-w-6xl mx-auto"},zo={class:"flex justify-between items-center"},Eo={class:"text-lg font-medium text-gray-900"},Fo={class:"flex space-x-2"},Lo={class:"overflow-x-auto"},Vo={class:"min-w-full divide-y divide-gray-200"},Uo={class:"bg-gray-50"},Bo={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Do={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Oo={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Ao={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Wo={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Jo={class:"bg-white divide-y divide-gray-200"},Qo={class:"px-6 py-4 whitespace-nowrap"},Ho={class:"flex items-center"},Xo={class:"text-sm font-medium text-gray-900"},No={class:"text-sm text-gray-500"},Go={class:"px-6 py-4"},Yo={class:"max-w-xs"},Ko={key:0,class:"space-y-1"},Zo={key:0,class:"text-xs text-gray-400"},ti={key:1,class:"text-xs text-gray-400 italic"},ei={class:"px-6 py-4 whitespace-nowrap"},si={class:"px-6 py-4 whitespace-nowrap"},oi={key:0},ii={class:"flex items-center"},ri={class:"flex-1 mr-2"},ni={class:"w-16 bg-gray-200 rounded-full h-2"},ai={class:"text-xs font-medium text-gray-900"},li={key:1,class:"text-xs text-gray-400"},ci={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},di={class:"flex space-x-2"},mi={key:0,class:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg"},pi={class:"flex"},ui={class:"text-sm font-medium text-red-800 mb-2"},_i={class:"text-sm text-red-700 space-y-1"},hi={class:"max-w-6xl mx-auto"},gi={class:"text-lg font-medium text-gray-900"},fi={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},vi={class:"font-medium text-gray-900 flex items-center"},yi={class:"space-y-2"},xi={key:0,class:"text-red-500"},$i={class:"max-w-6xl mx-auto"},bi={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},wi={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center"},ki={class:"text-2xl font-bold text-gray-900"},Ci={class:"text-sm text-gray-500"},Si={class:"text-2xl font-bold text-green-600"},Ii={class:"text-sm text-gray-500"},Mi={class:"text-2xl font-bold text-red-600"},Ti={class:"text-sm text-gray-500"},Ri={class:"text-2xl font-bold text-blue-600"},Pi={class:"text-sm text-gray-500"},ji={__name:"Step2Mapping",setup(m){const{t:a}=X.useI18n(),o=it(),s=F(()=>[{label:a("imports.do_not_import"),value:""},{label:"--- "+a("imports.customer_fields")+" ---",value:"",disabled:!0},{label:a("imports.field_customer_name"),value:"customer_name"},{label:a("imports.field_customer_email"),value:"customer_email"},{label:a("imports.field_customer_phone"),value:"customer_phone"},{label:a("imports.field_customer_address"),value:"customer_address"},{label:a("imports.field_customer_tax_id"),value:"customer_tax_id"},{label:a("imports.field_customer_website"),value:"customer_website"},{label:"--- "+a("imports.invoice_fields")+" ---",value:"",disabled:!0},{label:a("imports.field_invoice_number"),value:"invoice_number"},{label:a("imports.field_invoice_date"),value:"invoice_date"},{label:a("imports.field_due_date"),value:"due_date"},{label:a("imports.field_subtotal"),value:"subtotal"},{label:a("imports.field_tax_amount"),value:"tax_amount"},{label:a("imports.field_total_amount"),value:"total_amount"},{label:a("imports.field_notes"),value:"notes"},{label:"--- "+a("imports.item_fields")+" ---",value:"",disabled:!0},{label:a("imports.field_item_name"),value:"item_name"},{label:a("imports.field_item_description"),value:"item_description"},{label:a("imports.field_quantity"),value:"quantity"},{label:a("imports.field_unit_price"),value:"unit_price"},{label:a("imports.field_unit"),value:"unit"},{label:a("imports.field_tax_rate"),value:"tax_rate"},{label:"--- "+a("imports.payment_fields")+" ---",value:"",disabled:!0},{label:a("imports.field_payment_date"),value:"payment_date"},{label:a("imports.field_payment_amount"),value:"payment_amount"},{label:a("imports.field_payment_method"),value:"payment_method"},{label:a("imports.field_payment_reference"),value:"payment_reference"}]),g=F(()=>{var i;const _=((i=o.importJob)==null?void 0:i.type)||"customers",x={customers:[{name:"customers",icon:"UserIcon",fields:[{key:"name",required:!0},{key:"email",required:!0},{key:"phone",required:!1},{key:"address",required:!1},{key:"vat_number",required:!1}]}],invoices:[{name:"invoices",icon:"DocumentIcon",fields:[{key:"invoice_number",required:!0},{key:"customer_name",required:!0},{key:"invoice_date",required:!0},{key:"total",required:!0},{key:"due_date",required:!1},{key:"subtotal",required:!1},{key:"tax",required:!1},{key:"status",required:!1},{key:"currency",required:!1},{key:"notes",required:!1}]}],items:[{name:"items",icon:"CubeIcon",fields:[{key:"name",required:!0},{key:"price",required:!0},{key:"description",required:!1},{key:"unit",required:!1},{key:"tax_rate",required:!1}]}],payments:[{name:"payments",icon:"CashIcon",fields:[{key:"payment_date",required:!0},{key:"amount",required:!0},{key:"payment_method",required:!1},{key:"reference",required:!1},{key:"customer_name",required:!1},{key:"invoice_number",required:!1}]}],expenses:[{name:"expenses",icon:"ReceiptTaxIcon",fields:[{key:"expense_date",required:!0},{key:"amount",required:!0},{key:"category",required:!1},{key:"customer_name",required:!1},{key:"notes",required:!1}]}]};return x[_]||x.customers}),y=F(()=>Object.keys(o.fieldMappings).filter(_=>o.fieldMappings[_]).length),I=F(()=>{var b;const _=Object.values(o.fieldMappings),x=((b=o.importJob)==null?void 0:b.type)||"customers";return({customers:["name","email"],invoices:["invoice_number","customer_name","invoice_date","total"],items:["name","price"],payments:["payment_date","amount"],expenses:["expense_date","amount"]}[x]||[]).filter(r=>!_.includes(r)).length}),k=F(()=>{if(o.detectedFields.length===0)return 0;const _=y.value,x=o.detectedFields.length,i=g.value.reduce((f,R)=>f+R.fields.filter(T=>T.required&&C(T.key)).length,0),c=g.value.reduce((f,R)=>f+R.fields.filter(T=>T.required).length,0),b=_/x,r=c>0?i/c:1;return b*.3+r*.7}),$=_=>o.fieldMappings[_]&&o.fieldMappings[_]!=="",C=_=>Object.values(o.fieldMappings).includes(_),S=_=>o.mappingSuggestions[_]===o.fieldMappings[_]?o.autoMappingConfidence:o.fieldMappings[_]?1:0,B=_=>_>=.8?"CheckCircleIcon":_>=.6?"ExclamationTriangleIcon":"XCircleIcon",j=(_,x)=>{o.updateMapping(_,x)},L=_=>{const x=o.mappingSuggestions[_];x&&o.updateMapping(_,x)},W=_=>{o.updateMapping(_,"")},U=()=>{o.applyAutoMapping()},D=()=>{o.fieldMappings={},o.validateMappings(),o.updateCanProceed()},M=()=>{D()};return Z(async()=>{o.detectedFields.length===0&&await o.detectFields()}),(_,x)=>(d(),h("div",bo,[t("div",wo,[n(dt,{tag:"h2",class:"text-2xl font-bold text-gray-900 mb-2"},{default:v(()=>[u(e(_.$t("imports.map_fields")),1)]),_:1}),t("p",ko,e(_.$t("imports.map_fields_description_detailed")),1)]),l(o).autoMappingConfidence>0?(d(),h("div",Co,[t("div",{class:z(["border rounded-lg p-4",{"bg-green-50 border-green-200":l(o).autoMappingConfidence>=.8,"bg-yellow-50 border-yellow-200":l(o).autoMappingConfidence>=.6&&l(o).autoMappingConfidence<.8,"bg-red-50 border-red-200":l(o).autoMappingConfidence<.6}])},[t("div",So,[n(p,{name:B(l(o).autoMappingConfidence),class:z(["w-5 h-5 mt-0.5 mr-3 flex-shrink-0",{"text-green-400":l(o).autoMappingConfidence>=.8,"text-yellow-400":l(o).autoMappingConfidence>=.6&&l(o).autoMappingConfidence<.8,"text-red-400":l(o).autoMappingConfidence<.6}])},null,8,["name","class"]),t("div",Io,[t("h4",Mo,e(_.$t("imports.auto_mapping_results")),1),t("p",To,e(_.$t("imports.auto_mapping_confidence",{confidence:Math.round(l(o).autoMappingConfidence*100)})),1),t("div",Ro,[t("div",Po,[t("div",jo,[t("div",{class:z(["h-2 rounded-full transition-all duration-300",{"bg-green-500":l(o).autoMappingConfidence>=.8,"bg-yellow-500":l(o).autoMappingConfidence>=.6&&l(o).autoMappingConfidence<.8,"bg-red-500":l(o).autoMappingConfidence<.6}]),style:Q({width:`${l(o).autoMappingConfidence*100}%`})},null,6)])]),l(o).autoMappingConfidence<.8?(d(),P(q,{key:0,variant:"secondary",size:"sm",onClick:D},{default:v(()=>[u(e(_.$t("imports.reset_mapping")),1)]),_:1})):w("",!0)])])])],2)])):w("",!0),t("div",qo,[n(V,null,{header:v(()=>[t("div",zo,[t("h3",Eo,e(_.$t("imports.field_mapping")),1),t("div",Fo,[n(q,{variant:"secondary",size:"sm",onClick:U,disabled:l(o).isLoading},{default:v(()=>[u(e(_.$t("imports.apply_auto_mapping")),1)]),_:1},8,["disabled"]),n(q,{variant:"secondary",size:"sm",onClick:M},{default:v(()=>[u(e(_.$t("imports.clear_all")),1)]),_:1})])])]),default:v(()=>[t("div",Lo,[t("table",Vo,[t("thead",Uo,[t("tr",null,[t("th",Bo,e(_.$t("imports.source_field")),1),t("th",Do,e(_.$t("imports.sample_data")),1),t("th",Oo,e(_.$t("imports.target_field")),1),t("th",Ao,e(_.$t("imports.confidence")),1),t("th",Wo,e(_.$t("general.actions")),1)])]),t("tbody",Jo,[(d(!0),h(O,null,A(l(o).detectedFields,i=>(d(),h("tr",{key:i.name,class:z({"bg-green-50":$(i.name)&&S(i.name)>=.8,"bg-yellow-50":$(i.name)&&S(i.name)>=.6&&S(i.name)<.8,"bg-red-50":$(i.name)&&S(i.name)<.6})},[t("td",Qo,[t("div",Ho,[t("div",null,[t("div",Xo,e(i.name),1),t("div",No,e(i.type||"string"),1)])])]),t("td",Go,[t("div",Yo,[i.sample_data&&i.sample_data.length>0?(d(),h("div",Ko,[(d(!0),h(O,null,A(i.sample_data.slice(0,3),(c,b)=>(d(),h("div",{key:b,class:"text-xs text-gray-600 truncate bg-gray-100 px-2 py-1 rounded"},e(c),1))),128)),i.sample_data.length>3?(d(),h("div",Zo," +"+e(i.sample_data.length-3)+" "+e(_.$t("imports.more_samples")),1)):w("",!0)])):(d(),h("div",ti,e(_.$t("imports.no_sample_data")),1))])]),t("td",ei,[n(ft,{value:l(o).fieldMappings[i.name]||"",onInput:c=>j(i.name,c),options:s.value,placeholder:_.$t("imports.select_target_field"),size:"sm"},null,8,["value","onInput","options","placeholder"])]),t("td",si,[$(i.name)?(d(),h("div",oi,[t("div",ii,[t("div",ri,[t("div",ni,[t("div",{class:z(["h-2 rounded-full",{"bg-green-500":S(i.name)>=.8,"bg-yellow-500":S(i.name)>=.6&&S(i.name)<.8,"bg-red-500":S(i.name)<.6}]),style:Q({width:`${S(i.name)*100}%`})},null,6)])]),t("span",ai,e(Math.round(S(i.name)*100))+"% ",1)])])):(d(),h("span",li,"-"))]),t("td",ci,[t("div",di,[l(o).mappingSuggestions[i.name]?(d(),P(q,{key:0,variant:"secondary",size:"xs",onClick:c=>L(i.name),disabled:l(o).fieldMappings[i.name]===l(o).mappingSuggestions[i.name]},{default:v(()=>[u(e(_.$t("imports.use_suggestion")),1)]),_:2},1032,["onClick","disabled"])):w("",!0),$(i.name)?(d(),P(q,{key:1,variant:"danger",size:"xs",onClick:c=>W(i.name)},{default:v(()=>[u(e(_.$t("imports.clear")),1)]),_:2},1032,["onClick"])):w("",!0)])])],2))),128))])])]),l(o).mappingErrors.length>0?(d(),h("div",mi,[t("div",pi,[n(p,{name:"ExclamationTriangleIcon",class:"w-5 h-5 text-red-400 mr-3 flex-shrink-0"}),t("div",null,[t("h4",ui,e(_.$t("imports.mapping_errors")),1),t("ul",_i,[(d(!0),h(O,null,A(l(o).mappingErrors,i=>(d(),h("li",{key:i},e(i),1))),128))])])])])):w("",!0)]),_:1})]),t("div",hi,[n(V,null,{header:v(()=>[t("h3",gi,e(_.$t("imports.required_fields")),1)]),default:v(()=>[t("div",fi,[(d(!0),h(O,null,A(g.value,i=>(d(),h("div",{key:i.name,class:"space-y-3"},[t("h4",vi,[n(p,{name:i.icon,class:"w-4 h-4 mr-2"},null,8,["name"]),u(" "+e(_.$t(`imports.${i.name}`)),1)]),t("ul",yi,[(d(!0),h(O,null,A(i.fields,c=>(d(),h("li",{key:c.key,class:"flex items-center text-sm"},[t("span",{class:z(["w-3 h-3 rounded-full mr-2 flex-shrink-0",{"bg-green-500":C(c.key),"bg-red-500":c.required&&!C(c.key),"bg-gray-300":!c.required&&!C(c.key)}])},null,2),t("span",{class:z({"text-gray-500":!c.required})},[u(e(_.$t(`imports.field_${c.key}`))+" ",1),c.required?(d(),h("span",xi,"*")):w("",!0)],2)]))),128))])]))),128))])]),_:1})]),t("div",$i,[t("div",bi,[t("div",wi,[t("div",null,[t("div",ki,e(l(o).detectedFields.length),1),t("div",Ci,e(_.$t("imports.detected_fields")),1)]),t("div",null,[t("div",Si,e(y.value),1),t("div",Ii,e(_.$t("imports.mapped_fields")),1)]),t("div",null,[t("div",Mi,e(I.value),1),t("div",Ti,e(_.$t("imports.missing_required")),1)]),t("div",null,[t("div",Ri,e(Math.round(k.value*100))+"%",1),t("div",Pi,e(_.$t("imports.mapping_score")),1)])])])])]))}},qi={class:"space-y-6"},zi={class:"text-center"},Ei={class:"text-gray-600 max-w-3xl mx-auto"},Fi={key:0,class:"max-w-4xl mx-auto"},Li={class:"text-center py-8"},Vi={class:"text-lg font-medium text-gray-900 mb-2"},Ui={class:"text-gray-600 mb-4"},Bi={key:1,class:"max-w-6xl mx-auto space-y-6"},Di={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Oi={class:"text-center"},Ai={class:"text-3xl font-bold text-gray-900 mb-1"},Wi={class:"text-sm text-gray-500"},Ji={class:"text-center"},Qi={class:"text-3xl font-bold text-green-600 mb-1"},Hi={class:"text-sm text-gray-500"},Xi={class:"text-center"},Ni={class:"text-3xl font-bold text-yellow-600 mb-1"},Gi={class:"text-sm text-gray-500"},Yi={class:"text-center"},Ki={class:"text-3xl font-bold text-red-600 mb-1"},Zi={class:"text-sm text-gray-500"},tr={class:"flex justify-between items-center"},er={class:"text-lg font-medium text-gray-900"},sr={class:"space-y-4"},or={class:"flex justify-between text-sm font-medium text-gray-900 mb-2"},ir={class:"w-full bg-gray-200 rounded-full h-3"},rr={class:"flex items-start"},nr={class:"text-sm font-medium mb-1"},ar={class:"text-sm text-gray-600"},lr={class:"flex items-center"},cr={class:"text-lg font-medium text-gray-900"},dr={class:"text-red-600"},mr={class:"space-y-4"},pr={class:"bg-red-50 border border-red-200 rounded-lg p-4"},ur={class:"text-sm text-red-800 mb-2"},_r={class:"max-h-96 overflow-y-auto"},hr={class:"space-y-3"},gr={class:"flex justify-between items-start"},fr={class:"flex-1"},vr={class:"flex items-center mb-2"},yr={class:"text-sm font-medium text-gray-900 mr-2"},xr={class:"text-sm text-red-600 font-medium"},$r={class:"text-sm text-red-800 mb-2"},br={key:0,class:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded"},wr={class:"flex space-x-2 ml-4"},kr={key:0,class:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded"},Cr={class:"flex items-center mb-1"},Sr={class:"text-sm font-medium text-blue-800"},Ir={class:"text-sm text-blue-700"},Mr={class:"flex items-center"},Tr={class:"text-lg font-medium text-gray-900"},Rr={class:"text-yellow-600"},Pr={class:"space-y-4"},jr={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},qr={class:"text-sm text-yellow-800 mb-2"},zr={class:"max-h-64 overflow-y-auto"},Er={class:"space-y-3"},Fr={class:"flex justify-between items-start"},Lr={class:"flex-1"},Vr={class:"flex items-center mb-2"},Ur={class:"text-sm font-medium text-gray-900 mr-2"},Br={class:"text-sm text-yellow-600 font-medium"},Dr={class:"text-sm text-yellow-800 mb-2"},Or={key:0,class:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded"},Ar={class:"flex space-x-2 ml-4"},Wr={class:"flex justify-between items-center"},Jr={class:"text-lg font-medium text-gray-900"},Qr={class:"overflow-x-auto"},Hr={class:"min-w-full divide-y divide-gray-200"},Xr={class:"bg-gray-50"},Nr={class:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Gr={class:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Yr={class:"bg-white divide-y divide-gray-200"},Kr={class:"px-3 py-2 whitespace-nowrap text-sm text-gray-900"},Zr={class:"px-3 py-2 whitespace-nowrap"},tn={key:2,class:"max-w-4xl mx-auto"},en={class:"text-center py-8"},sn={class:"text-lg font-medium text-gray-900 mb-2"},on={class:"text-gray-600 mb-4"},rn={__name:"Step3Validation",setup(m){const{t:a}=X.useI18n(),o=it(),s=E(!1);Z(async()=>{!o.validationResults&&!o.isValidating&&await M()});const g=F(()=>o.validationErrors.length>0),y=F(()=>o.validationWarnings.length>0),I=F(()=>!g.value&&o.validationResults),k=F(()=>{if(!o.validationResults)return 0;const c=o.totalRecords,b=o.validRecords,r=o.validationErrors.length,f=o.validationWarnings.length;if(c===0)return 0;const R=b/c,T=Math.min(r/c,.5),J=Math.min(f/c,.2);return Math.max(0,R-T-J)}),$=F(()=>{if(!o.validationResults||!o.validationResults.preview)return[];const c=o.validationResults.preview[0];return c?Object.keys(c.data).slice(0,s.value?void 0:5):[]}),C=F(()=>!o.validationResults||!o.validationResults.preview?[]:o.validationResults.preview.slice(0,s.value?50:10)),S=()=>g.value?"danger":y.value?"warning":"success",B=()=>g.value?a("imports.validation_failed"):y.value?a("imports.validation_warnings"):a("imports.validation_passed"),j=()=>g.value?"XCircleIcon":y.value?"ExclamationTriangleIcon":"CheckCircleIcon",L=()=>g.value?a("imports.validation_failed_message",{count:o.validationErrors.length}):y.value?a("imports.validation_warnings_message",{count:o.validationWarnings.length}):a("imports.validation_passed_message"),W=()=>g.value?a("imports.fix_errors_to_proceed"):y.value?a("imports.warnings_can_be_ignored"):a("imports.data_ready_for_import"),U=c=>c.has_errors?"danger":c.has_warnings?"warning":"success",D=c=>c.has_errors?a("imports.error"):c.has_warnings?a("imports.warning"):a("imports.valid"),M=async()=>{try{await o.validateData()}catch(c){console.error("Validation failed:",c)}},_=c=>{console.log("Applying suggestion for:",c)},x=c=>{const b=o.validationErrors.indexOf(c);b>-1&&o.validationErrors.splice(b,1)},i=c=>{const b=o.validationWarnings.indexOf(c);b>-1&&o.validationWarnings.splice(b,1)};return(c,b)=>(d(),h("div",qi,[t("div",zi,[n(dt,{tag:"h2",class:"text-2xl font-bold text-gray-900 mb-2"},{default:v(()=>[u(e(c.$t("imports.validate_data")),1)]),_:1}),t("p",Ei,e(c.$t("imports.validate_data_description_detailed")),1)]),l(o).isValidating?(d(),h("div",Fi,[n(V,null,{default:v(()=>[t("div",Li,[n(ct,{class:"w-12 h-12 text-primary-600 mx-auto mb-4"}),t("h3",Vi,e(c.$t("imports.validating_data")),1),t("p",Ui,e(c.$t("imports.validation_in_progress")),1),b[1]||(b[1]=t("div",{class:"max-w-md mx-auto"},[t("div",{class:"w-full bg-gray-200 rounded-full h-2"},[t("div",{class:"bg-primary-600 h-2 rounded-full animate-pulse",style:{width:"60%"}})])],-1))])]),_:1})])):l(o).validationResults?(d(),h("div",Bi,[t("div",Di,[n(V,null,{default:v(()=>[t("div",Oi,[t("div",Ai,e(l(o).totalRecords),1),t("div",Wi,e(c.$t("imports.total_records")),1)])]),_:1}),n(V,null,{default:v(()=>[t("div",Ji,[t("div",Qi,e(l(o).validRecords),1),t("div",Hi,e(c.$t("imports.valid_records")),1)])]),_:1}),n(V,null,{default:v(()=>[t("div",Xi,[t("div",Ni,e(l(o).validationWarnings.length),1),t("div",Gi,e(c.$t("imports.warnings")),1)])]),_:1}),n(V,null,{default:v(()=>[t("div",Yi,[t("div",Ki,e(l(o).validationErrors.length),1),t("div",Zi,e(c.$t("imports.errors")),1)])]),_:1})]),n(V,null,{header:v(()=>[t("div",tr,[t("h3",er,e(c.$t("imports.validation_status")),1),n(ot,{variant:S(),class:"px-3 py-1 text-sm font-medium"},{default:v(()=>[u(e(B()),1)]),_:1},8,["variant"])])]),default:v(()=>[t("div",sr,[t("div",null,[t("div",or,[t("span",null,e(c.$t("imports.data_quality")),1),t("span",null,e(Math.round(k.value*100))+"%",1)]),t("div",ir,[t("div",{class:z(["h-3 rounded-full transition-all duration-300",{"bg-green-500":k.value>=.8,"bg-yellow-500":k.value>=.6&&k.value<.8,"bg-red-500":k.value<.6}]),style:Q({width:`${k.value*100}%`})},null,6)])]),t("div",{class:z(["p-4 rounded-lg border",{"bg-green-50 border-green-200":I.value,"bg-yellow-50 border-yellow-200":y.value&&!g.value,"bg-red-50 border-red-200":g.value}])},[t("div",rr,[n(p,{name:j(),class:z(["w-5 h-5 mt-0.5 mr-3 flex-shrink-0",{"text-green-400":I.value,"text-yellow-400":y.value&&!g.value,"text-red-400":g.value}])},null,8,["name","class"]),t("div",null,[t("p",nr,e(L()),1),t("p",ar,e(W()),1)])])],2)])]),_:1}),l(o).validationErrors.length>0?(d(),P(V,{key:0},{header:v(()=>[t("div",lr,[n(p,{name:"ExclamationTriangleIcon",class:"w-5 h-5 text-red-500 mr-2"}),t("h3",cr,[u(e(c.$t("imports.validation_errors"))+" ",1),t("span",dr,"("+e(l(o).validationErrors.length)+")",1)])])]),default:v(()=>[t("div",mr,[t("div",pr,[t("div",ur,e(c.$t("imports.errors_must_be_fixed")),1)]),t("div",_r,[t("div",hr,[(d(!0),h(O,null,A(l(o).validationErrors,(r,f)=>(d(),h("div",{key:f,class:"bg-white border border-red-200 rounded-lg p-4"},[t("div",gr,[t("div",fr,[t("div",vr,[t("span",yr,e(c.$t("imports.row"))+" "+e(r.row_number)+": ",1),t("span",xr,e(r.field),1)]),t("p",$r,e(r.message),1),r.value?(d(),h("div",br,e(c.$t("imports.invalid_value"))+': "'+e(r.value)+'" ',1)):w("",!0)]),t("div",wr,[r.suggestion?(d(),P(q,{key:0,variant:"secondary",size:"xs",onClick:R=>_(r)},{default:v(()=>[u(e(c.$t("imports.apply_suggestion")),1)]),_:2},1032,["onClick"])):w("",!0),n(q,{variant:"danger",size:"xs",onClick:R=>x(r)},{default:v(()=>[u(e(c.$t("imports.ignore")),1)]),_:2},1032,["onClick"])])]),r.suggestion?(d(),h("div",kr,[t("div",Cr,[n(p,{name:"LightBulbIcon",class:"w-4 h-4 text-blue-500 mr-2"}),t("span",Sr,e(c.$t("imports.suggestion"))+":",1)]),t("p",Ir,e(r.suggestion),1)])):w("",!0)]))),128))])])])]),_:1})):w("",!0),l(o).validationWarnings.length>0?(d(),P(V,{key:1},{header:v(()=>[t("div",Mr,[n(p,{name:"ExclamationTriangleIcon",class:"w-5 h-5 text-yellow-500 mr-2"}),t("h3",Tr,[u(e(c.$t("imports.validation_warnings"))+" ",1),t("span",Rr,"("+e(l(o).validationWarnings.length)+")",1)])])]),default:v(()=>[t("div",Pr,[t("div",jr,[t("div",qr,e(c.$t("imports.warnings_can_proceed")),1)]),t("div",zr,[t("div",Er,[(d(!0),h(O,null,A(l(o).validationWarnings,(r,f)=>(d(),h("div",{key:f,class:"bg-white border border-yellow-200 rounded-lg p-4"},[t("div",Fr,[t("div",Lr,[t("div",Vr,[t("span",Ur,e(c.$t("imports.row"))+" "+e(r.row_number)+": ",1),t("span",Br,e(r.field),1)]),t("p",Dr,e(r.message),1),r.value?(d(),h("div",Or,e(c.$t("imports.current_value"))+': "'+e(r.value)+'" ',1)):w("",!0)]),t("div",Ar,[r.suggestion?(d(),P(q,{key:0,variant:"secondary",size:"xs",onClick:R=>_(r)},{default:v(()=>[u(e(c.$t("imports.apply_suggestion")),1)]),_:2},1032,["onClick"])):w("",!0),n(q,{variant:"secondary",size:"xs",onClick:R=>i(r)},{default:v(()=>[u(e(c.$t("imports.ignore")),1)]),_:2},1032,["onClick"])])])]))),128))])])])]),_:1})):w("",!0),n(V,null,{header:v(()=>[t("div",Wr,[t("h3",Jr,e(c.$t("imports.data_preview")),1),n(q,{variant:"secondary",size:"sm",onClick:b[0]||(b[0]=r=>s.value=!s.value)},{default:v(()=>[u(e(s.value?c.$t("imports.show_less"):c.$t("imports.show_more")),1)]),_:1})])]),default:v(()=>[t("div",Qr,[t("table",Hr,[t("thead",Xr,[t("tr",null,[t("th",Nr,e(c.$t("imports.row")),1),(d(!0),h(O,null,A($.value,r=>(d(),h("th",{key:r,class:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},e(r),1))),128)),t("th",Gr,e(c.$t("imports.status")),1)])]),t("tbody",Yr,[(d(!0),h(O,null,A(C.value,(r,f)=>(d(),h("tr",{key:f,class:z({"bg-red-50":r.has_errors,"bg-yellow-50":r.has_warnings&&!r.has_errors,"bg-green-50":!r.has_errors&&!r.has_warnings})},[t("td",Kr,e(r.row_number),1),(d(!0),h(O,null,A($.value,R=>(d(),h("td",{key:R,class:"px-3 py-2 text-sm text-gray-900 max-w-xs truncate"},e(r.data[R]||"-"),1))),128)),t("td",Zr,[n(ot,{variant:U(r),size:"sm"},{default:v(()=>[u(e(D(r)),1)]),_:2},1032,["variant"])])],2))),128))])])])]),_:1})])):(d(),h("div",tn,[n(V,null,{default:v(()=>[t("div",en,[n(p,{name:"ExclamationTriangleIcon",class:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t("h3",sn,e(c.$t("imports.no_validation_results")),1),t("p",on,e(c.$t("imports.validation_not_started")),1),n(q,{variant:"primary",onClick:M,loading:l(o).isValidating},{default:v(()=>[u(e(c.$t("imports.start_validation")),1)]),_:1},8,["loading"])])]),_:1})]))]))}},nn={class:"space-y-6"},an={class:"text-center"},ln={class:"text-gray-600 max-w-3xl mx-auto"},cn={class:"max-w-6xl mx-auto space-y-6"},dn={class:"text-lg font-medium text-gray-900"},mn={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},pn={class:"space-y-4"},un={class:"font-medium text-gray-900 flex items-center"},_n={class:"space-y-2 text-sm"},hn={class:"flex justify-between"},gn={class:"text-gray-500"},fn={class:"font-medium"},vn={class:"flex justify-between"},yn={class:"text-gray-500"},xn={class:"font-medium text-green-600"},$n={key:0,class:"flex justify-between"},bn={class:"text-gray-500"},wn={class:"font-medium text-red-600"},kn={class:"space-y-4"},Cn={class:"font-medium text-gray-900 flex items-center"},Sn={class:"space-y-2 text-sm"},In={class:"flex justify-between"},Mn={class:"text-gray-500"},Tn={class:"font-medium"},Rn={class:"flex justify-between"},Pn={class:"text-gray-500"},jn={class:"font-medium uppercase"},qn={class:"flex justify-between"},zn={class:"text-gray-500"},En={class:"font-medium"},Fn={class:"space-y-4"},Ln={class:"font-medium text-gray-900 flex items-center"},Vn={class:"space-y-2 text-sm"},Un={class:"flex justify-between"},Bn={class:"text-gray-500"},Dn={class:"font-medium"},On={class:"flex justify-between"},An={class:"text-gray-500"},Wn={class:"font-medium"},Jn={class:"flex justify-between"},Qn={class:"text-gray-500"},Hn={class:"font-medium"},Xn={class:"space-y-4"},Nn={class:"font-medium text-gray-900 flex items-center"},Gn={class:"space-y-2 text-sm"},Yn={class:"flex justify-between"},Kn={class:"text-gray-500"},Zn={class:"font-medium"},ta={class:"flex justify-between"},ea={class:"text-gray-500"},sa={class:"font-medium"},oa={key:0,class:"flex justify-between"},ia={class:"text-gray-500"},ra={class:"font-medium"},na={class:"flex items-center justify-between"},aa={class:"text-lg font-medium text-gray-900"},la={class:"space-y-6"},ca={class:"flex justify-between text-sm font-medium text-gray-900 mb-2"},da={class:"w-full bg-gray-200 rounded-full h-3"},ma={class:"space-y-3"},pa={key:3},ua={class:"flex-1"},_a={class:"text-sm font-medium"},ha={class:"text-xs text-gray-500"},ga={key:0,class:"text-sm text-gray-500"},fa={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},va={class:"flex items-center"},ya={class:"text-sm font-medium text-blue-900"},xa={class:"text-xs text-blue-700"},$a={class:"flex items-center"},ba={class:"text-lg font-medium text-gray-900"},wa={class:"space-y-6"},ka={class:"bg-green-50 border border-green-200 rounded-lg p-4"},Ca={class:"flex items-start"},Sa={class:"text-sm font-medium text-green-800 mb-1"},Ia={class:"text-sm text-green-700"},Ma={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ta={class:"text-sm text-gray-600"},Ra={class:"flex justify-center space-x-4"},Pa={class:"flex items-center"},ja={class:"text-lg font-medium text-gray-900"},qa={class:"space-y-4"},za={class:"bg-red-50 border border-red-200 rounded-lg p-4"},Ea={class:"flex items-start"},Fa={class:"text-sm font-medium text-red-800 mb-1"},La={class:"text-sm text-red-700"},Va={class:"flex justify-center space-x-4"},Ua={class:"text-lg font-medium text-gray-900"},Ba={class:"space-y-4"},Da={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Oa={class:"flex items-start"},Aa={class:"text-sm font-medium text-blue-800 mb-1"},Wa={class:"text-sm text-blue-700 mb-3"},Ja={class:"text-sm text-blue-700 space-y-1"},Qa={class:"flex items-center"},Ha={class:"flex items-center"},Xa={class:"flex items-center"},Na={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Ga={class:"flex items-start"},Ya={class:"text-sm font-medium text-yellow-800 mb-2"},Ka={class:"text-sm text-yellow-700 space-y-1"},Za={__name:"Step4Commit",setup(m){const{t:a}=X.useI18n(),o=yt(),s=it(),g=F(()=>Object.keys(s.fieldMappings).filter(i=>s.fieldMappings[i]).length),y=F(()=>Object.keys(s.mappingSuggestions).filter(i=>s.fieldMappings[i]===s.mappingSuggestions[i]).length),I=F(()=>{const i=s.totalRecords;return i<=100?"< 1 min":i<=1e3?"1-3 min":i<=5e3?"3-10 min":"10+ min"}),k=F(()=>{var i,c,b,r,f;return[{key:"prepare",number:1,title:a("imports.preparing_data"),description:a("imports.preparing_data_desc"),status:j("prepare"),count:(i=s.commitResults)==null?void 0:i.prepared_records},{key:"customers",number:2,title:a("imports.importing_customers"),description:a("imports.importing_customers_desc"),status:j("customers"),count:(c=s.commitResults)==null?void 0:c.imported_customers},{key:"invoices",number:3,title:a("imports.importing_invoices"),description:a("imports.importing_invoices_desc"),status:j("invoices"),count:(b=s.commitResults)==null?void 0:b.imported_invoices},{key:"items",number:4,title:a("imports.importing_items"),description:a("imports.importing_items_desc"),status:j("items"),count:(r=s.commitResults)==null?void 0:r.imported_items},{key:"payments",number:5,title:a("imports.importing_payments"),description:a("imports.importing_payments_desc"),status:j("payments"),count:(f=s.commitResults)==null?void 0:f.imported_payments},{key:"finalize",number:6,title:a("imports.finalizing"),description:a("imports.finalizing_desc"),status:j("finalize")}]}),$=F(()=>{const i=k.value.find(c=>c.status==="in_progress");return i?i.title:a("imports.processing")}),C=F(()=>s.commitResults?[{key:"customers",label:a("imports.customers_imported"),count:s.commitResults.imported_customers||0,color:"text-blue-600"},{key:"invoices",label:a("imports.invoices_imported"),count:s.commitResults.imported_invoices||0,color:"text-green-600"},{key:"items",label:a("imports.items_imported"),count:s.commitResults.imported_items||0,color:"text-purple-600"},{key:"payments",label:a("imports.payments_imported"),count:s.commitResults.imported_payments||0,color:"text-orange-600"}]:[]),S=()=>{switch(s.commitStatus){case"processing":return"info";case"completed":return"success";case"failed":return"danger";default:return"secondary"}},B=()=>{switch(s.commitStatus){case"processing":return a("imports.importing");case"completed":return a("imports.completed");case"failed":return a("imports.failed");default:return a("imports.pending")}},j=i=>!s.commitResults||!s.commitResults.step_status?s.isCommitting&&i==="prepare"?"in_progress":"pending":s.commitResults.step_status[i]||"pending",L=async()=>{try{await s.commitImport()}catch(i){console.error("Retry import failed:",i)}},W=()=>{o.push("/admin/customers")},U=async()=>{try{const i=await s.fetchLogs(),c=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),b=URL.createObjectURL(c),r=document.createElement("a");r.href=b,r.download=`import-log-${s.importId}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(b)}catch(i){console.error("Failed to download log:",i)}},D=()=>{console.log("View logs")},M=i=>{if(!i)return"0 Bytes";const c=1024,b=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(i)/Math.log(c));return parseFloat((i/Math.pow(c,r)).toFixed(2))+" "+b[r]},_=i=>i?new Date(i).toLocaleString():"-",x=i=>{if(!i)return"0s";const c=Math.floor(i/60),b=i%60;return c>0?`${c}m ${b}s`:`${i}s`};return(i,c)=>(d(),h("div",nn,[t("div",an,[n(dt,{tag:"h2",class:"text-2xl font-bold text-gray-900 mb-2"},{default:v(()=>[u(e(i.$t("imports.commit_import")),1)]),_:1}),t("p",ln,e(i.$t("imports.commit_import_description_detailed")),1)]),t("div",cn,[n(V,null,{header:v(()=>[t("h3",dn,e(i.$t("imports.import_summary")),1)]),default:v(()=>{var b,r,f,R;return[t("div",mn,[t("div",pn,[t("h4",un,[n(p,{name:"ChartBarIcon",class:"w-4 h-4 mr-2"}),u(" "+e(i.$t("imports.data_statistics")),1)]),t("div",_n,[t("div",hn,[t("span",gn,e(i.$t("imports.total_records")),1),t("span",fn,e(l(s).totalRecords),1)]),t("div",vn,[t("span",yn,e(i.$t("imports.valid_records")),1),t("span",xn,e(l(s).validRecords),1)]),l(s).invalidRecords>0?(d(),h("div",$n,[t("span",bn,e(i.$t("imports.invalid_records")),1),t("span",wn,e(l(s).invalidRecords),1)])):w("",!0)])]),t("div",kn,[t("h4",Cn,[n(p,{name:"DocumentIcon",class:"w-4 h-4 mr-2"}),u(" "+e(i.$t("imports.file_information")),1)]),t("div",Sn,[t("div",In,[t("span",Mn,e(i.$t("imports.filename")),1),t("span",Tn,e((b=l(s).fileInfo)==null?void 0:b.name),1)]),t("div",Rn,[t("span",Pn,e(i.$t("imports.format")),1),t("span",jn,e(l(s).fileType),1)]),t("div",qn,[t("span",zn,e(i.$t("imports.file_size")),1),t("span",En,e(M((r=l(s).fileInfo)==null?void 0:r.size)),1)])])]),t("div",Fn,[t("h4",Ln,[n(p,{name:"ArrowsRightLeftIcon",class:"w-4 h-4 mr-2"}),u(" "+e(i.$t("imports.field_mapping")),1)]),t("div",Vn,[t("div",Un,[t("span",Bn,e(i.$t("imports.mapped_fields")),1),t("span",Dn,e(g.value),1)]),t("div",On,[t("span",An,e(i.$t("imports.auto_mapped")),1),t("span",Wn,e(y.value),1)]),t("div",Jn,[t("span",Qn,e(i.$t("imports.confidence")),1),t("span",Hn,e(Math.round(l(s).autoMappingConfidence*100))+"%",1)])])]),t("div",Xn,[t("h4",Nn,[n(p,{name:"ClockIcon",class:"w-4 h-4 mr-2"}),u(" "+e(i.$t("imports.time_estimation")),1)]),t("div",Gn,[t("div",Yn,[t("span",Kn,e(i.$t("imports.estimated_time")),1),t("span",Zn,e(I.value),1)]),t("div",ta,[t("span",ea,e(i.$t("imports.started_at")),1),t("span",sa,e(_((f=l(s).importJob)==null?void 0:f.created_at)),1)]),l(s).commitStatus==="completed"?(d(),h("div",oa,[t("span",ia,e(i.$t("imports.completed_at")),1),t("span",ra,e(_((R=l(s).commitResults)==null?void 0:R.completed_at)),1)])):w("",!0)])])])]}),_:1}),l(s).isCommitting||l(s).commitStatus!=="pending"?(d(),P(V,{key:0},{header:v(()=>[t("div",na,[t("h3",aa,e(i.$t("imports.import_progress")),1),n(ot,{variant:S(),class:"px-3 py-1 text-sm font-medium"},{default:v(()=>[u(e(B()),1)]),_:1},8,["variant"])])]),default:v(()=>[t("div",la,[t("div",null,[t("div",ca,[t("span",null,e(i.$t("imports.overall_progress")),1),t("span",null,e(Math.round(l(s).commitProgress))+"%",1)]),t("div",da,[t("div",{class:z(["h-3 rounded-full transition-all duration-300",{"bg-blue-500":l(s).isCommitting,"bg-green-500":l(s).commitStatus==="completed","bg-red-500":l(s).commitStatus==="failed"}]),style:Q({width:`${l(s).commitProgress}%`})},null,6)])]),t("div",ma,[(d(!0),h(O,null,A(k.value,b=>(d(),h("div",{key:b.key,class:"flex items-center"},[t("div",{class:z(["flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full text-xs mr-3",{"bg-blue-600 text-white":b.status==="in_progress","bg-green-500 text-white":b.status==="completed","bg-red-500 text-white":b.status==="failed","bg-gray-300 text-gray-600":b.status==="pending"}])},[b.status==="completed"?(d(),P(p,{key:0,name:"CheckIcon",class:"w-4 h-4"})):b.status==="failed"?(d(),P(p,{key:1,name:"XMarkIcon",class:"w-4 h-4"})):b.status==="in_progress"?(d(),P(ct,{key:2,class:"w-4 h-4"})):(d(),h("span",pa,e(b.number),1))],2),t("div",ua,[t("div",_a,e(b.title),1),t("div",ha,e(b.description),1)]),b.count!==void 0?(d(),h("div",ga,e(b.count)+" "+e(i.$t("imports.records")),1)):w("",!0)]))),128))]),l(s).isCommitting?(d(),h("div",fa,[t("div",va,[n(ct,{class:"w-5 h-5 text-blue-600 mr-3"}),t("div",null,[t("div",ya,e($.value),1),t("div",xa,e(i.$t("imports.please_wait_importing")),1)])])])):w("",!0)])]),_:1})):w("",!0),l(s).commitResults&&l(s).commitStatus==="completed"?(d(),P(V,{key:1},{header:v(()=>[t("div",$a,[n(p,{name:"CheckCircleIcon",class:"w-5 h-5 text-green-500 mr-2"}),t("h3",ba,e(i.$t("imports.import_results")),1)])]),default:v(()=>[t("div",wa,[t("div",ka,[t("div",Ca,[n(p,{name:"CheckCircleIcon",class:"w-5 h-5 text-green-400 mt-0.5 mr-3 flex-shrink-0"}),t("div",null,[t("h4",Sa,e(i.$t("imports.import_completed_successfully")),1),t("p",Ia,e(i.$t("imports.import_success_message",{records:l(s).commitResults.imported_records,duration:x(l(s).commitResults.duration)})),1)])])]),t("div",Ma,[(d(!0),h(O,null,A(C.value,b=>(d(),h("div",{key:b.key,class:"text-center p-4 bg-gray-50 rounded-lg"},[t("div",{class:z(["text-2xl font-bold mb-1",b.color])},e(b.count),3),t("div",Ta,e(b.label),1)]))),128))]),t("div",Ra,[n(q,{variant:"secondary",onClick:W},{default:v(()=>[u(e(i.$t("imports.view_imported_data")),1)]),_:1}),n(q,{variant:"secondary",onClick:U},{default:v(()=>[u(e(i.$t("imports.download_log")),1)]),_:1})])])]),_:1})):w("",!0),l(s).commitStatus==="failed"?(d(),P(V,{key:2},{header:v(()=>[t("div",Pa,[n(p,{name:"XCircleIcon",class:"w-5 h-5 text-red-500 mr-2"}),t("h3",ja,e(i.$t("imports.import_failed")),1)])]),default:v(()=>[t("div",qa,[t("div",za,[t("div",Ea,[n(p,{name:"XCircleIcon",class:"w-5 h-5 text-red-400 mt-0.5 mr-3 flex-shrink-0"}),t("div",null,[t("h4",Fa,e(i.$t("imports.import_failed_title")),1),t("p",La,e(l(s).getError("commit")||i.$t("imports.unknown_error")),1)])])]),t("div",Va,[n(q,{variant:"primary",onClick:L,loading:l(s).isCommitting},{default:v(()=>[u(e(i.$t("imports.retry_import")),1)]),_:1},8,["loading"]),n(q,{variant:"secondary",onClick:D},{default:v(()=>[u(e(i.$t("imports.view_logs")),1)]),_:1})])])]),_:1})):w("",!0),l(s).commitStatus==="pending"?(d(),P(V,{key:3},{header:v(()=>[t("h3",Ua,e(i.$t("imports.ready_to_import")),1)]),default:v(()=>[t("div",Ba,[t("div",Da,[t("div",Oa,[n(p,{name:"InformationCircleIcon",class:"w-5 h-5 text-blue-400 mt-0.5 mr-3 flex-shrink-0"}),t("div",null,[t("h4",Aa,e(i.$t("imports.final_check")),1),t("p",Wa,e(i.$t("imports.final_check_description")),1),t("ul",Ja,[t("li",Qa,[n(p,{name:"CheckIcon",class:"w-4 h-4 mr-2"}),u(" "+e(i.$t("imports.backup_completed")),1)]),t("li",Ha,[n(p,{name:"CheckIcon",class:"w-4 h-4 mr-2"}),u(" "+e(i.$t("imports.validation_passed")),1)]),t("li",Xa,[n(p,{name:"CheckIcon",class:"w-4 h-4 mr-2"}),u(" "+e(i.$t("imports.mapping_verified")),1)])])])])]),t("div",Na,[t("div",Ga,[n(p,{name:"ExclamationTriangleIcon",class:"w-5 h-5 text-yellow-400 mt-0.5 mr-3 flex-shrink-0"}),t("div",null,[t("h4",Ya,e(i.$t("imports.important_notes")),1),t("ul",Ka,[t("li",null," "+e(i.$t("imports.note_irreversible")),1),t("li",null," "+e(i.$t("imports.note_backup_created")),1),t("li",null," "+e(i.$t("imports.note_audit_logged")),1),t("li",null," "+e(i.$t("imports.note_notifications_sent")),1)])])])])])]),_:1})):w("",!0)])]))}},tl={class:"bg-white border border-gray-200 rounded-lg shadow-sm"},el={class:"px-4 py-3 border-b border-gray-200 bg-gray-50"},sl={class:"flex items-center justify-between"},ol={class:"text-lg font-semibold text-gray-900 flex items-center"},il={class:"p-4 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto"},rl={key:0,class:"space-y-4"},nl={class:"space-y-3"},al={class:"font-semibold text-gray-900 flex items-center"},ll={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},cl={class:"flex items-start"},dl={class:"text-sm"},ml={class:"font-medium text-blue-900 mb-2"},pl={class:"space-y-1 text-blue-700"},ul={class:"flex items-start"},_l={class:"flex items-start"},hl={class:"flex items-start"},gl={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},fl={class:"font-medium text-yellow-900 mb-2 flex items-center"},vl={class:"space-y-1 text-sm text-yellow-800"},yl={class:"flex items-start"},xl={class:"flex items-start"},$l={class:"flex items-start"},bl={class:"bg-green-50 border border-green-200 rounded-lg p-4"},wl={class:"font-medium text-green-900 mb-2 flex items-center"},kl={class:"space-y-1 text-sm text-green-800"},Cl={class:"flex items-start"},Sl={class:"flex items-start"},Il={key:1,class:"space-y-4"},Ml={class:"space-y-3"},Tl={class:"font-semibold text-gray-900 flex items-center"},Rl={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Pl={class:"flex items-start"},jl={class:"text-sm"},ql={class:"font-medium text-blue-900 mb-2"},zl={class:"space-y-1 text-blue-700"},El={class:"flex items-start"},Fl={class:"flex items-start"},Ll={class:"flex items-start"},Vl={class:"bg-purple-50 border border-purple-200 rounded-lg p-4"},Ul={class:"font-medium text-purple-900 mb-2"},Bl={class:"text-sm text-purple-800 space-y-2"},Dl={class:"flex items-center"},Ol={class:"bg-white px-2 py-1 rounded text-xs"},Al={class:"font-medium"},Wl={class:"flex items-center"},Jl={class:"bg-white px-2 py-1 rounded text-xs"},Ql={class:"font-medium"},Hl={key:2,class:"space-y-4"},Xl={class:"space-y-3"},Nl={class:"font-semibold text-gray-900 flex items-center"},Gl={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Yl={class:"flex items-start"},Kl={class:"text-sm"},Zl={class:"font-medium text-blue-900 mb-2"},tc={class:"space-y-1 text-blue-700"},ec={class:"flex items-start"},sc={class:"flex items-start"},oc={class:"flex items-start"},ic={class:"bg-red-50 border border-red-200 rounded-lg p-4"},rc={class:"font-medium text-red-900 mb-2"},nc={class:"space-y-1 text-sm text-red-800"},ac={class:"flex items-start"},lc={class:"flex items-start"},cc={class:"flex items-start"},dc={key:3,class:"space-y-4"},mc={class:"space-y-3"},pc={class:"font-semibold text-gray-900 flex items-center"},uc={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},_c={class:"flex items-start"},hc={class:"text-sm"},gc={class:"font-medium text-blue-900 mb-2"},fc={class:"space-y-1 text-blue-700"},vc={class:"flex items-start"},yc={class:"flex items-start"},xc={class:"flex items-start"},$c={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},bc={class:"font-medium text-yellow-900 mb-2 flex items-center"},wc={class:"text-sm text-yellow-800"},kc={class:"border-t border-gray-200 pt-4"},Cc={class:"flex items-center"},Sc={class:"font-medium text-gray-900"},Ic={class:"text-sm text-gray-600"},Mc={class:"border-t border-gray-200 pt-4"},Tc={class:"font-medium text-gray-900 mb-3"},Rc={class:"space-y-2"},Pc={href:"#",class:"flex items-center text-sm text-primary-600 hover:text-primary-700"},jc={href:"#",class:"flex items-center text-sm text-primary-600 hover:text-primary-700"},qc={href:"#",class:"flex items-center text-sm text-primary-600 hover:text-primary-700"},zc={__name:"HelpGuidePanel",props:{currentStep:{type:Number,required:!0}},emits:["close"],setup(m,{emit:a}){const o=()=>{window.open("https://example.com/migration-wizard-tutorial","_blank")};return(s,g)=>(d(),h("div",tl,[t("div",el,[t("div",sl,[t("h3",ol,[n(p,{name:"QuestionMarkCircleIcon",class:"w-5 h-5 mr-2 text-primary-600"}),u(" "+e(s.$t("imports.help_guide")),1)]),t("button",{onClick:g[0]||(g[0]=y=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[n(p,{name:"XMarkIcon",class:"w-5 h-5"})])])]),t("div",il,[m.currentStep===1?(d(),h("div",rl,[t("div",nl,[t("h4",al,[g[1]||(g[1]=t("span",{class:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-primary-100 text-primary-700 text-sm mr-2"},"1",-1)),u(" "+e(s.$t("imports.help_step1_title")),1)]),t("div",ll,[t("div",cl,[n(p,{name:"CloudArrowUpIcon",class:"w-8 h-8 text-blue-500 mr-3 flex-shrink-0"}),t("div",dl,[t("p",ml,e(s.$t("imports.help_upload_visual_title")),1),t("ul",pl,[t("li",ul,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_upload_step1")),1)]),t("li",_l,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_upload_step2")),1)]),t("li",hl,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_upload_step3")),1)])])])])]),t("div",gl,[t("h5",fl,[n(p,{name:"ExclamationTriangleIcon",class:"w-4 h-4 mr-2"}),u(" "+e(s.$t("imports.common_pitfalls")),1)]),t("ul",vl,[t("li",yl,[g[2]||(g[2]=t("span",{class:"mr-2"},"",-1)),u(" "+e(s.$t("imports.pitfall_file_size")),1)]),t("li",xl,[g[3]||(g[3]=t("span",{class:"mr-2"},"",-1)),u(" "+e(s.$t("imports.pitfall_file_format")),1)]),t("li",$l,[g[4]||(g[4]=t("span",{class:"mr-2"},"",-1)),u(" "+e(s.$t("imports.pitfall_encoding")),1)])])]),t("div",bl,[t("h5",wl,[n(p,{name:"LightBulbIcon",class:"w-4 h-4 mr-2"}),u(" "+e(s.$t("imports.pro_tips")),1)]),t("ul",kl,[t("li",Cl,[n(p,{name:"SparklesIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0 text-green-600"}),u(" "+e(s.$t("imports.tip_use_templates")),1)]),t("li",Sl,[n(p,{name:"SparklesIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0 text-green-600"}),u(" "+e(s.$t("imports.tip_test_small_file")),1)])])])])])):w("",!0),m.currentStep===2?(d(),h("div",Il,[t("div",Ml,[t("h4",Tl,[g[5]||(g[5]=t("span",{class:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-primary-100 text-primary-700 text-sm mr-2"},"2",-1)),u(" "+e(s.$t("imports.help_step2_title")),1)]),t("div",Rl,[t("div",Pl,[n(p,{name:"ArrowsRightLeftIcon",class:"w-8 h-8 text-blue-500 mr-3 flex-shrink-0"}),t("div",jl,[t("p",ql,e(s.$t("imports.help_mapping_visual_title")),1),t("ul",zl,[t("li",El,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_mapping_step1")),1)]),t("li",Fl,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_mapping_step2")),1)]),t("li",Ll,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_mapping_step3")),1)])])])])]),t("div",Vl,[t("h5",Ul,e(s.$t("imports.example_mappings")),1),t("div",Bl,[t("div",Dl,[t("code",Ol,e(s.$t("imports.example_csv_column_name")),1),n(p,{name:"ArrowRightIcon",class:"w-4 h-4 mx-2"}),t("span",Al,e(s.$t("imports.example_field_customer_name")),1)]),t("div",Wl,[t("code",Jl,e(s.$t("imports.example_csv_column_email")),1),n(p,{name:"ArrowRightIcon",class:"w-4 h-4 mx-2"}),t("span",Ql,e(s.$t("imports.example_field_email")),1)])])])])])):w("",!0),m.currentStep===3?(d(),h("div",Hl,[t("div",Xl,[t("h4",Nl,[g[6]||(g[6]=t("span",{class:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-primary-100 text-primary-700 text-sm mr-2"},"3",-1)),u(" "+e(s.$t("imports.help_step3_title")),1)]),t("div",Gl,[t("div",Yl,[n(p,{name:"ShieldCheckIcon",class:"w-8 h-8 text-blue-500 mr-3 flex-shrink-0"}),t("div",Kl,[t("p",Zl,e(s.$t("imports.help_validation_visual_title")),1),t("ul",tc,[t("li",ec,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_validation_step1")),1)]),t("li",sc,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_validation_step2")),1)]),t("li",oc,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_validation_step3")),1)])])])])]),t("div",ic,[t("h5",rc,e(s.$t("imports.common_validation_errors")),1),t("ul",nc,[t("li",ac,[g[7]||(g[7]=t("span",{class:"mr-2"},"",-1)),u(" "+e(s.$t("imports.validation_error_missing_required")),1)]),t("li",lc,[g[8]||(g[8]=t("span",{class:"mr-2"},"",-1)),u(" "+e(s.$t("imports.validation_error_invalid_format")),1)]),t("li",cc,[g[9]||(g[9]=t("span",{class:"mr-2"},"",-1)),u(" "+e(s.$t("imports.validation_error_duplicate")),1)])])])])])):w("",!0),m.currentStep===4?(d(),h("div",dc,[t("div",mc,[t("h4",pc,[g[10]||(g[10]=t("span",{class:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-primary-100 text-primary-700 text-sm mr-2"},"4",-1)),u(" "+e(s.$t("imports.help_step4_title")),1)]),t("div",uc,[t("div",_c,[n(p,{name:"RocketLaunchIcon",class:"w-8 h-8 text-blue-500 mr-3 flex-shrink-0"}),t("div",hc,[t("p",gc,e(s.$t("imports.help_commit_visual_title")),1),t("ul",fc,[t("li",vc,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_commit_step1")),1)]),t("li",yc,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_commit_step2")),1)]),t("li",xc,[n(p,{name:"CheckCircleIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),u(" "+e(s.$t("imports.help_commit_step3")),1)])])])])]),t("div",$c,[t("h5",bc,[n(p,{name:"ExclamationTriangleIcon",class:"w-4 h-4 mr-2"}),u(" "+e(s.$t("imports.important_note")),1)]),t("p",wc,e(s.$t("imports.commit_warning")),1)])])])):w("",!0),t("div",kc,[t("a",{href:"#",onClick:et(o,["prevent"]),class:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-primary-50 to-purple-50 border border-primary-200 rounded-lg hover:shadow-md transition-all"},[t("div",Cc,[n(p,{name:"PlayCircleIcon",class:"w-6 h-6 text-primary-600 mr-3"}),t("div",null,[t("p",Sc,e(s.$t("imports.watch_video_tutorial")),1),t("p",Ic,e(s.$t("imports.video_tutorial_duration")),1)])]),n(p,{name:"ArrowTopRightOnSquareIcon",class:"w-5 h-5 text-gray-400"})])]),t("div",Mc,[t("h5",Tc,e(s.$t("imports.quick_links")),1),t("div",Rc,[t("a",Pc,[n(p,{name:"DocumentTextIcon",class:"w-4 h-4 mr-2"}),u(" "+e(s.$t("imports.full_documentation")),1)]),t("a",jc,[n(p,{name:"QuestionMarkCircleIcon",class:"w-4 h-4 mr-2"}),u(" "+e(s.$t("imports.faq")),1)]),t("a",qc,[n(p,{name:"ChatBubbleLeftRightIcon",class:"w-4 h-4 mr-2"}),u(" "+e(s.$t("imports.contact_support")),1)])])])])]))}},Ec={key:0,class:"fixed inset-0 z-50"},Fc={class:"relative bg-white rounded-lg overflow-hidden"},Lc={class:"bg-gradient-to-r from-primary-600 to-purple-600 px-6 py-4"},Vc={class:"flex items-center justify-between"},Uc={class:"flex items-center text-white"},Bc={class:"font-semibold text-lg"},Dc={class:"px-6 py-4"},Oc={class:"text-gray-700 leading-relaxed"},Ac={key:0,class:"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3"},Wc={class:"text-sm text-blue-900 flex items-start"},Jc={class:"px-6 py-4 bg-gray-50 border-t border-gray-200"},Qc={class:"flex items-center justify-between"},Hc={class:"flex items-center space-x-2"},Xc={class:"text-sm text-gray-600"},Nc={class:"flex space-x-1"},Gc={class:"flex space-x-2"},Yc={__name:"InteractiveTour",props:{isActive:{type:Boolean,default:!1},wizardStep:{type:Number,default:1}},emits:["update:isActive","tourComplete"],setup(m,{emit:a}){const{t:o}=X.useI18n(),s=m,g=a,y=E(null),I=E(null),k=E(null),$=E({}),C=F(()=>s.wizardStep===1?[{target:".import-wizard-header",title:o("imports.tour_welcome_title"),content:o("imports.tour_welcome_content"),icon:"SparklesIcon",action:null},{target:".upload-area",title:o("imports.tour_upload_title"),content:o("imports.tour_upload_content"),icon:"CloudArrowUpIcon",action:o("imports.tour_upload_action")},{target:".template-download-section",title:o("imports.tour_template_title"),content:o("imports.tour_template_content"),icon:"DocumentArrowDownIcon",action:o("imports.tour_template_action")},{target:".tips-section",title:o("imports.tour_tips_title"),content:o("imports.tour_tips_content"),icon:"LightBulbIcon",action:null},{target:".progress-sidebar",title:o("imports.tour_progress_title"),content:o("imports.tour_progress_content"),icon:"ChartBarIcon",action:null}]:s.wizardStep===2?[{target:".field-mapping-table",title:o("imports.tour_mapping_title"),content:o("imports.tour_mapping_content"),icon:"ArrowsRightLeftIcon",action:o("imports.tour_mapping_action")},{target:".auto-detect-button",title:o("imports.tour_autodetect_title"),content:o("imports.tour_autodetect_content"),icon:"SparklesIcon",action:o("imports.tour_autodetect_action")}]:s.wizardStep===3?[{target:".validation-results",title:o("imports.tour_validation_title"),content:o("imports.tour_validation_content"),icon:"ShieldCheckIcon",action:null},{target:".error-list",title:o("imports.tour_errors_title"),content:o("imports.tour_errors_content"),icon:"ExclamationCircleIcon",action:o("imports.tour_errors_action")}]:s.wizardStep===4?[{target:".commit-summary",title:o("imports.tour_commit_title"),content:o("imports.tour_commit_content"),icon:"RocketLaunchIcon",action:null},{target:".commit-button",title:o("imports.tour_final_title"),content:o("imports.tour_final_content"),icon:"CheckCircleIcon",action:o("imports.tour_final_action")}]:[]),S=F(()=>y.value!==null&&C.value[y.value]?C.value[y.value]:null),B=()=>{y.value=0,st(()=>{U()})},j=()=>{y.value<C.value.length-1&&(y.value++,st(()=>{U()}))},L=()=>{y.value>0&&(y.value--,st(()=>{U()}))},W=()=>{y.value=null,I.value=null,k.value=null,g("update:isActive",!1),g("tourComplete"),localStorage.setItem("migration-wizard-tour-completed","true")},U=()=>{if(!S.value||!S.value.target)return;const M=document.querySelector(S.value.target);if(!M){console.warn("Tour target not found:",S.value.target);return}M.getBoundingClientRect();const _=window.pageYOffset||document.documentElement.scrollTop,x=window.pageXOffset||document.documentElement.scrollLeft;M.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{const i=M.getBoundingClientRect();I.value={top:i.top+_-8,left:i.left+x-8,width:i.width+16,height:i.height+16};const c=window.innerWidth,b=window.innerHeight,r=384,f=300;let R=i.top+_,T=i.right+x+20;T+r>c&&(T=i.left+x-r-20),T<0&&(T=i.left+x,R=i.bottom+_+20),R+f>b+_&&(R=i.top+_-f-20),k.value={top:R,left:T},T>i.right+x?$.value={left:"-8px",top:"60px"}:T+r<i.left+x?$.value={right:"-8px",top:"60px"}:$.value={top:"-8px",left:"24px"}},500)},D=()=>{y.value!==null&&U()};return ht(()=>s.isActive,M=>{M?B():y.value=null}),ht(()=>s.wizardStep,()=>{s.isActive&&B()}),Z(()=>{window.addEventListener("resize",D)}),mt(()=>{window.removeEventListener("resize",D)}),(M,_)=>(d(),P(gt,{to:"body"},[m.isActive&&y.value!==null?(d(),h("div",Ec,[_[0]||(_[0]=t("div",{class:"absolute inset-0 bg-black/50 transition-all duration-300"},null,-1)),I.value?(d(),h("div",{key:0,class:"absolute border-4 border-primary-500 rounded-lg shadow-2xl transition-all duration-300 pointer-events-none",style:Q({top:I.value.top+"px",left:I.value.left+"px",width:I.value.width+"px",height:I.value.height+"px",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5), 0 0 20px rgba(59, 130, 246, 0.5)"})},null,4)):w("",!0),k.value?(d(),h("div",{key:1,class:"absolute bg-white rounded-lg shadow-2xl max-w-md z-[60] transition-all duration-300",style:Q({top:k.value.top+"px",left:k.value.left+"px"})},[t("div",{class:"absolute w-4 h-4 bg-white transform rotate-45",style:Q($.value)},null,4),t("div",Fc,[t("div",Lc,[t("div",Vc,[t("div",Uc,[n(p,{name:S.value.icon,class:"w-6 h-6 mr-3"},null,8,["name"]),t("h3",Bc,e(S.value.title),1)]),t("button",{onClick:W,class:"text-white/80 hover:text-white transition-colors"},[n(p,{name:"XMarkIcon",class:"w-5 h-5"})])])]),t("div",Dc,[t("p",Oc,e(S.value.content),1),S.value.action?(d(),h("div",Ac,[t("p",Wc,[n(p,{name:"CursorArrowRaysIcon",class:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),t("span",null,e(S.value.action),1)])])):w("",!0)]),t("div",Jc,[t("div",Qc,[t("div",Hc,[t("span",Xc,e(M.$t("imports.tour_step_counter",{current:y.value+1,total:C.value.length})),1),t("div",Nc,[(d(!0),h(O,null,A(C.value,(x,i)=>(d(),h("div",{key:i,class:z(["w-2 h-2 rounded-full transition-all",i===y.value?"bg-primary-600 w-6":"bg-gray-300"])},null,2))),128))])]),t("div",Gc,[y.value>0?(d(),h("button",{key:0,onClick:L,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"},e(M.$t("general.previous")),1)):w("",!0),y.value<C.value.length-1?(d(),h("button",{key:1,onClick:j,class:"px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700 transition-colors flex items-center"},[u(e(M.$t("general.next"))+" ",1),n(p,{name:"ArrowRightIcon",class:"w-4 h-4 ml-2"})])):(d(),h("button",{key:2,onClick:W,class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition-colors flex items-center"},[u(e(M.$t("imports.finish_tour"))+" ",1),n(p,{name:"CheckIcon",class:"w-4 h-4 ml-2"})]))])])])])],4)):w("",!0)])):w("",!0)]))}},Kc={class:"flex items-center space-x-3"},Zc={class:"grid grid-cols-12 gap-6"},td={class:"text-lg font-medium leading-6 text-gray-900"},ed={class:"space-y-6"},sd={class:"flex justify-between text-sm font-medium text-gray-900 mb-2"},od={class:"w-full bg-gray-200 rounded-full h-2"},id={class:"space-y-2"},rd=["onClick"],nd={key:1},ad={class:"flex-1"},ld={class:"font-medium"},cd={class:"text-xs text-gray-500 mt-1"},dd={key:0,class:"pt-4 border-t border-gray-200"},md={class:"text-sm font-medium text-gray-900 mb-3"},pd={class:"space-y-2 text-sm"},ud={class:"flex justify-between"},_d={class:"text-gray-500"},hd={class:"font-medium"},gd={class:"flex justify-between"},fd={class:"text-gray-500"},vd={class:"font-medium text-green-600"},yd={key:0,class:"flex justify-between"},xd={class:"text-gray-500"},$d={class:"font-medium text-red-600"},bd={class:"flex justify-between"},wd={key:1},kd={class:"flex space-x-3"},Cd={key:0,class:"col-span-3"},Sd={class:"text-sm text-gray-500"},Id={class:"flex justify-end space-x-3"},Md={class:"list-disc list-inside space-y-1"},Rd={__name:"ImportWizard",setup(m){const{t:a}=X.useI18n(),o=yt(),s=it(),g=E(!1),y=E(!1),I=E(!1),k=E(!1),$=E(!1),C=F(()=>[{number:1,title:a("imports.upload_file"),description:a("imports.upload_file_description"),completed:s.currentStep>1&&s.isStep1Valid,accessible:!0},{number:2,title:a("imports.map_fields"),description:a("imports.map_fields_description"),completed:s.currentStep>2&&s.isStep2Valid,accessible:s.isStep1Valid},{number:3,title:a("imports.validate_data"),description:a("imports.validate_data_description"),completed:s.currentStep>3&&s.isStep3Valid,accessible:s.isStep2Valid},{number:4,title:a("imports.commit_import"),description:a("imports.commit_import_description"),completed:s.isStep4Valid,accessible:s.isStep3Valid}]),S=x=>{const i=C.value.find(c=>c.number===x);i&&i.accessible&&!s.isLoading&&s.goToStep(x)},B=async()=>{g.value=!0;try{switch(s.currentStep){case 1:await s.detectFields();break;case 2:await s.saveMapping();break}s.nextStep()}catch(x){console.error("Error proceeding to next step:",x)}finally{g.value=!1}},j=async()=>{try{await s.commitImport()}catch(x){console.error("Error committing import:",x)}},L=()=>{y.value=!0},W=async()=>{I.value=!0;try{await s.cancelImport(),o.push("/admin/dashboard")}catch(x){console.error("Error cancelling import:",x)}finally{I.value=!1,y.value=!1}},U=()=>{o.push("/admin/dashboard")},D=()=>{k.value=!k.value},M=()=>{$.value=!0},_=()=>{console.log("Tour completed!")};return Z(()=>{console.log("[ImportWizard] Component mounted"),console.log("[ImportWizard] importStore:",s),console.log("[ImportWizard] importStore.currentStep:",s.currentStep),s.resetState(),console.log("[ImportWizard] Store state reset");const x=localStorage.getItem("migration-wizard-help-seen");console.log("[ImportWizard] hasSeenHelp:",x),!x&&s.currentStep===1&&(k.value=!0,localStorage.setItem("migration-wizard-help-seen","true"),console.log("[ImportWizard] Showing help guide")),console.log("[ImportWizard] showHelpGuide.value:",k.value),console.log("[ImportWizard] Component setup complete")}),mt(()=>{s.stopProgressPolling()}),(x,i)=>(d(),P(bt,null,{default:v(()=>[n(wt,{title:x.$t("imports.universal_migration_wizard"),class:"import-wizard-header"},{actions:v(()=>[t("div",Kc,[n(q,{variant:"secondary",size:"sm",onClick:D},{default:v(()=>[n(p,{name:"QuestionMarkCircleIcon",class:"w-4 h-4 mr-2"}),u(" "+e(k.value?x.$t("imports.hide_help"):x.$t("imports.show_help")),1)]),_:1}),n(q,{variant:"primary-outline",size:"sm",onClick:M},{default:v(()=>[n(p,{name:"AcademicCapIcon",class:"w-4 h-4 mr-2"}),u(" "+e(x.$t("imports.start_tour")),1)]),_:1}),l(s).importId?(d(),P(q,{key:0,variant:"danger",size:"sm",onClick:L},{default:v(()=>[u(e(x.$t("general.cancel")),1)]),_:1})):w("",!0)])]),_:1},8,["title"]),t("div",Zc,[t("div",{class:z([k.value?"col-span-2":"col-span-3","progress-sidebar"])},[n(V,null,{header:v(()=>[t("h3",td,e(x.$t("imports.progress")),1)]),default:v(()=>[t("div",ed,[t("div",null,[t("div",sd,[t("span",null,e(x.$t("imports.overall_progress")),1),t("span",null,e(Math.round(l(s).overallProgress))+"%",1)]),t("div",od,[t("div",{class:"bg-primary-600 h-2 rounded-full transition-all duration-300",style:Q({width:`${l(s).overallProgress}%`})},null,4)])]),t("nav",id,[(d(!0),h(O,null,A(C.value,c=>(d(),h("div",{key:c.number,class:z(["flex items-center px-3 py-2 rounded-lg text-sm font-medium cursor-pointer transition-colors",{"bg-primary-100 text-primary-700 border border-primary-200":c.number===l(s).currentStep,"text-gray-500 hover:text-gray-700 hover:bg-gray-50":c.number!==l(s).currentStep&&!c.completed,"text-green-600 hover:text-green-700 hover:bg-green-50":c.completed,"opacity-50 cursor-not-allowed":!c.accessible}]),onClick:b=>S(c.number)},[t("span",{class:z(["flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full text-xs mr-3",{"bg-primary-600 text-white":c.number===l(s).currentStep,"bg-gray-300 text-gray-600":c.number!==l(s).currentStep&&!c.completed,"bg-green-500 text-white":c.completed}])},[c.completed?(d(),P(p,{key:0,name:"CheckIcon",class:"w-4 h-4"})):(d(),h("span",nd,e(c.number),1))],2),t("div",ad,[t("div",ld,e(c.title),1),t("div",cd,e(c.description),1)])],10,rd))),128))]),l(s).validationResults?(d(),h("div",dd,[t("h4",md,e(x.$t("imports.statistics")),1),t("div",pd,[t("div",ud,[t("span",_d,e(x.$t("imports.total_records")),1),t("span",hd,e(l(s).totalRecords),1)]),t("div",gd,[t("span",fd,e(x.$t("imports.valid_records")),1),t("span",vd,e(l(s).validRecords),1)]),l(s).invalidRecords>0?(d(),h("div",yd,[t("span",xd,e(x.$t("imports.invalid_records")),1),t("span",$d,e(l(s).invalidRecords),1)])):w("",!0)])])):w("",!0)])]),_:1})],2),t("div",{class:z(k.value?"col-span-7":"col-span-9")},[n(V,null,{footer:v(()=>[t("div",bd,[l(s).currentStep>1?(d(),P(q,{key:0,variant:"secondary",onClick:i[0]||(i[0]=c=>l(s).previousStep()),disabled:l(s).isLoading||l(s).isUploading||l(s).isValidating||l(s).isCommitting},{default:v(()=>[u(e(x.$t("general.previous")),1)]),_:1},8,["disabled"])):(d(),h("div",wd)),t("div",kd,[l(s).currentStep<4?(d(),P(q,{key:0,variant:"primary",onClick:B,disabled:!l(s).canProceed||l(s).isLoading,loading:g.value},{default:v(()=>[u(e(x.$t("general.next")),1)]),_:1},8,["disabled","loading"])):w("",!0),l(s).currentStep===4&&l(s).commitStatus!=="completed"?(d(),P(q,{key:1,variant:"primary",onClick:j,disabled:!l(s).isStep3Valid||l(s).isCommitting,loading:l(s).isCommitting},{default:v(()=>[u(e(x.$t("imports.commit_import")),1)]),_:1},8,["disabled","loading"])):w("",!0),l(s).currentStep===4&&l(s).commitStatus==="completed"?(d(),P(q,{key:2,variant:"primary",onClick:U},{default:v(()=>[u(e(x.$t("imports.finish")),1)]),_:1})):w("",!0)])])]),default:v(()=>[n(kt,{"current-step":l(s).currentStep-1,steps:4,"wizard-steps-container-class":"min-h-96 p-6"},{default:v(()=>[nt(n(at,null,{default:v(()=>[n($o)]),_:1},512),[[lt,l(s).currentStep===1]]),nt(n(at,null,{default:v(()=>[n(ji)]),_:1},512),[[lt,l(s).currentStep===2]]),nt(n(at,null,{default:v(()=>[n(rn)]),_:1},512),[[lt,l(s).currentStep===3]]),nt(n(at,null,{default:v(()=>[n(Za)]),_:1},512),[[lt,l(s).currentStep===4]])]),_:1},8,["current-step"])]),_:1})],2),k.value?(d(),h("div",Cd,[n(zc,{"current-step":l(s).currentStep,onClose:D},null,8,["current-step"])])):w("",!0)]),n(Yc,{isActive:$.value,"onUpdate:isActive":i[1]||(i[1]=c=>$.value=c),"wizard-step":l(s).currentStep,onTourComplete:_},null,8,["isActive","wizard-step"]),n(Ct,{show:y.value,title:x.$t("imports.cancel_import"),onClose:i[3]||(i[3]=c=>y.value=!1)},{footer:v(()=>[t("div",Id,[n(q,{variant:"secondary",onClick:i[2]||(i[2]=c=>y.value=!1)},{default:v(()=>[u(e(x.$t("general.no")),1)]),_:1}),n(q,{variant:"danger",onClick:W,loading:I.value},{default:v(()=>[u(e(x.$t("general.yes")),1)]),_:1},8,["loading"])])]),default:v(()=>[t("div",Sd,e(x.$t("imports.cancel_import_confirmation")),1)]),_:1},8,["show","title"]),l(s).hasErrors?(d(),P(vt,{key:0,class:"mt-6"},{default:v(()=>[t("ul",Md,[(d(!0),h(O,null,A(l(s).errors,(c,b)=>(d(),h("li",{key:b},e(c),1))),128))])]),_:1})):w("",!0)]),_:1}))}};export{Rd as default};
