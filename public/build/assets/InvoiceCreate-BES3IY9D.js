import{al as T,F as P,j as v,r as l,c as M,o as _,a as n,l as t,w as s,aC as A,aO as z,aU as K,v as Q,e as q,f as I,$ as J,g as h,aD as W,i as X,P as Z,K as w,L as V,Q as ee,aF as te,N as ne,n as oe,b as C,m as ie,t as F,q as ae,M as se,S as le}from"./main-DpDYmbyp.js";import{_ as ce,a as re,b as ue,c as de,d as me,e as ve,f as pe}from"./SalesTax-DaUR7fNN.js";import{_ as ge}from"./ExchangeRateConverter-C0WLa-5M.js";import{_ as _e}from"./CreateCustomFields-B13Z4-HD.js";import{_ as fe}from"./TaxTypeModal-BJCBWiwS.js";import"./DragIcon-CeeWVm9Y.js";import"./SelectNotePopup-DUO919h6.js";import"./NoteModal-LQwzMr_4.js";import"./payment-zQDBnf7-.js";import"./exchange-rate-DKRdhF9a.js";import"./dynamic-import-helper-BheWnx7M.js";const Ie={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},be={__name:"InvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(i){const e=T(),$=P(),B=v(()=>$.selectedCompanySettings||{}),x=v(()=>{var c;return((c=B.value)==null?void 0:c.invoice_use_time)==="YES"}),r=v(()=>{var a;const c=(a=B.value)==null?void 0:a.carbon_time_format;return typeof c=="string"?c.indexOf("H")>-1:!1});return(c,a)=>{const p=l("BaseCustomerSelectPopup"),S=l("BaseDatePicker"),b=l("BaseInputGroup"),g=l("BaseInput"),k=l("BaseInputGrid");return _(),M("div",Ie,[n(p,{modelValue:t(e).newInvoice.customer,"onUpdate:modelValue":a[0]||(a[0]=u=>t(e).newInvoice.customer=u),valid:i.v.customer_id,"content-loading":i.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),n(k,{class:"col-span-12 lg:col-span-7"},{default:s(()=>[n(b,{label:c.$t("invoices.invoice_date"),"content-loading":i.isLoading,required:"",error:i.v.invoice_date.$error&&i.v.invoice_date.$errors[0].$message},{default:s(()=>[n(S,{modelValue:t(e).newInvoice.invoice_date,"onUpdate:modelValue":a[1]||(a[1]=u=>t(e).newInvoice.invoice_date=u),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",enableTime:x.value,time24hr:r.value},null,8,["modelValue","content-loading","enableTime","time24hr"])]),_:1},8,["label","content-loading","error"]),n(b,{label:c.$t("invoices.due_date"),"content-loading":i.isLoading},{default:s(()=>[n(S,{modelValue:t(e).newInvoice.due_date,"onUpdate:modelValue":a[2]||(a[2]=u=>t(e).newInvoice.due_date=u),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),n(b,{label:c.$t("invoices.invoice_number"),"content-loading":i.isLoading,error:i.v.invoice_number.$error&&i.v.invoice_number.$errors[0].$message,required:""},{default:s(()=>[n(g,{modelValue:t(e).newInvoice.invoice_number,"onUpdate:modelValue":a[3]||(a[3]=u=>t(e).newInvoice.invoice_number=u),"content-loading":i.isLoading,onInput:a[4]||(a[4]=u=>i.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),n(ge,{store:t(e),"store-prop":"newInvoice",v:i.v,"is-loading":i.isLoading,"is-edit":i.isEdit,"customer-currency":t(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ye={class:"flex"},we={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},$e={class:"relative w-full lg:w-1/2 lg:mr-4"},E="newInvoice",Te={__name:"InvoiceCreate",setup(i){const e=T(),$=P(),B=A(),x=z();K();const{t:r}=Q.useI18n();let c=ne(),a=oe(),p=q(!1);const S=q(!1),b=q(["customer","company","customerCustom","invoice","invoiceCustom"]);let g=v(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),k=v(()=>f.value?r("invoices.edit_invoice"):r("invoices.new_invoice"));const u=v(()=>$.selectedCompanySettings.sales_tax_us_enabled==="YES"&&x.salesTaxUSEnabled);let f=v(()=>c.name==="invoices.edit");const D={invoice_date:{required:I.withMessage(r("validation.required"),h)},reference_number:{maxLength:I.withMessage(r("validation.price_maxlength"),W(255))},customer_id:{required:I.withMessage(r("validation.required"),h)},invoice_number:{required:I.withMessage(r("validation.required"),h)},exchange_rate:{required:te(function(){return I.withMessage(r("validation.required"),h),e.showExchangeRate}),decimal:I.withMessage(r("validation.valid_exchange_rate"),J)}},y=X(D,v(()=>e.newInvoice),{$scope:E});B.resetCustomFields(),y.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(f.value),Z(()=>e.newInvoice.customer,o=>{o&&o.currency?e.newInvoice.selectedCurrency=o.currency:e.newInvoice.selectedCurrency=$.selectedCompanyCurrency});async function N(){if(y.value.$touch(),y.value.$invalid)return console.log("Form is invalid:",y.value.$errors),!1;p.value=!0;let o=le.cloneDeep({...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax});o.discount_per_item==="YES"?o.items.forEach((d,m)=>{d.discount_type==="fixed"&&(o.items[m].discount=d.discount*100)}):o.discount_type==="fixed"&&(o.discount=o.discount*100),!e.newInvoice.tax_per_item==="YES"&&o.taxes.length&&(o.tax_type_ids=o.taxes.map(d=>d.tax_type_id));try{const m=await(f.value?e.updateInvoice:e.addInvoice)(o);a.push(`/admin/invoices/${m.data.data.id}/view`)}catch(d){console.error(d)}p.value=!1}return(o,d)=>{const m=l("BaseBreadcrumbItem"),U=l("BaseBreadcrumb"),L=l("BaseButton"),j=l("router-link"),G=l("BaseIcon"),O=l("BasePageHeader"),Y=l("BaseScrollPane"),H=l("BasePage");return _(),M(ee,null,[n(re),n(ue),n(fe),u.value&&(!t(g)||t(c).query.customer)?(_(),w(ce,{key:0,store:t(e),"is-edit":t(f),"store-prop":"newInvoice",customer:t(e).newInvoice.customer},null,8,["store","is-edit","customer"])):V("",!0),n(H,{class:"relative invoice-create-page"},{default:s(()=>[C("form",{onSubmit:ie(N,["prevent"])},[n(O,{title:t(k)},{actions:s(()=>[o.$route.name==="invoices.edit"?(_(),w(j,{key:0,to:`/invoices/pdf/${t(e).newInvoice.unique_hash}`,target:"_blank"},{default:s(()=>[n(L,{class:"mr-3",variant:"primary-outline",type:"button"},{default:s(()=>[C("span",ye,F(o.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):V("",!0),n(L,{loading:t(p),disabled:t(p),variant:"primary",type:"submit"},{left:s(R=>[t(p)?V("",!0):(_(),w(G,{key:0,name:"ArrowDownOnSquareIcon",class:se(R.class)},null,8,["class"]))]),default:s(()=>[ae(" "+F(o.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:s(()=>[n(U,null,{default:s(()=>[n(m,{title:o.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),n(m,{title:o.$t("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),o.$route.name==="invoices.edit"?(_(),w(m,{key:0,title:o.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(_(),w(m,{key:1,title:o.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),n(be,{v:t(y),"is-loading":t(g),"is-edit":t(f)},null,8,["v","is-loading","is-edit"]),n(Y,null,{default:s(()=>[n(de,{currency:t(e).newInvoice.selectedCurrency,"is-loading":t(g),"item-validation-scope":E,store:t(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),C("div",we,[C("div",$e,[n(me,{store:t(e),"store-prop":"newInvoice",fields:b.value,type:"Invoice"},null,8,["store","fields"]),n(_e,{type:"Invoice","is-edit":t(f),"is-loading":t(g),store:t(e),"store-prop":"newInvoice","custom-field-scope":E,class:"mb-6"},null,8,["is-edit","is-loading","store"]),n(ve,{store:t(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":S.value},null,8,["store","is-mark-as-default"])]),n(pe,{currency:t(e).newInvoice.selectedCurrency,"is-loading":t(g),store:t(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Te as default};
