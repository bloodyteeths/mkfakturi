import{aM as Z,aN as ee,G as te,F as ne,v as ae,O as oe,e as w,j as I,i as re,V as le,N as se,K as M,w as i,r as u,n as ie,f,aD as C,J as ue,g as me,o as h,a as o,b as N,m as ce,L as P,l as e,q as L,t as q,M as de}from"./main-Ds_umSNN.js";import{_ as pe}from"./ItemUnitModal-DmlRsN9Z.js";const fe={__name:"Create",setup(Ie){const a=Z(),x=ee(),$=te(),g=ne(),{t:d}=ae.useI18n(),y=se(),E=ie(),A=oe(),_=w(!1),b=w(g.selectedCompanySettings.tax_per_item);let s=w(!1);a.$reset(),j();const B=I({get:()=>{const n=parseInt(g.selectedCompanyCurrency.precision),t=a.currentItem.price??0;return n===0?t:t/100},set:n=>{const t=n??0;parseInt(g.selectedCompanyCurrency.precision)===0?a.currentItem.price=Math.round(t):a.currentItem.price=Math.round(t*100)}}),S=I({get:()=>{var n,t;return(t=(n=a==null?void 0:a.currentItem)==null?void 0:n.taxes)==null?void 0:t.map(m=>{if(m)return{...m,tax_type_id:m.id,tax_name:`${m.name} (${m.calculation_type==="fixed"?new Intl.NumberFormat(void 0,{style:"currency",currency:g.selectedCompanyCurrency.code}).format(m.fixed_amount/100):`${m.percent}%`})`}})},set:n=>{a.currentItem.taxes=n}}),v=I(()=>y.name==="items.edit"),k=I(()=>v.value?d("items.edit_item"):d("items.new_item")),D=I(()=>x.taxTypes.map(n=>({...n,tax_type_id:n.id,tax_name:`${n.name} (${n.calculation_type==="fixed"?new Intl.NumberFormat(void 0,{style:"currency",currency:g.selectedCompanyCurrency.code}).format(n.fixed_amount/100):`${n.percent}%`})`}))),G=I(()=>b.value==="YES"),z=I(()=>({currentItem:{name:{required:f.withMessage(d("validation.required"),me),minLength:f.withMessage(d("validation.name_min_length",{count:2}),ue(2))},sku:{maxLength:f.withMessage(d("validation.sku_maxlength"),C(255))},barcode:{maxLength:f.withMessage(d("validation.barcode_maxlength"),C(255))},description:{maxLength:f.withMessage(d("validation.description_maxlength"),C(65e3))}}})),l=re(z,a);async function F(){$.openModal({title:d("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function j(){if(s.value=!0,await a.fetchItemUnits({limit:"all"}),A.hasAbilities(le.VIEW_TAX_TYPE)&&await x.fetchTaxTypes({limit:"all"}),v.value){let n=y.params.id;await a.fetchItem(n),a.currentItem.tax_per_item===1?b.value="YES":b.value="NO"}s.value=!1}async function O(){if(l.value.currentItem.$touch(),l.value.currentItem.$invalid)return!1;_.value=!0;try{let t={id:y.params.id,...a.currentItem};a.currentItem&&a.currentItem.taxes&&(t.taxes=a.currentItem.taxes.map(c=>({tax_type_id:c.tax_type_id,calculation_type:c.calculation_type,fixed_amount:c.fixed_amount,amount:c.calculation_type==="fixed"?c.fixed_amount:Math.round(B.value*c.percent),percent:c.percent,name:c.name,collective_tax:0}))),await(v.value?a.updateItem:a.addItem)(t),_.value=!1,E.push("/admin/items"),n()}catch{_.value=!1;return}function n(){$.closeModal(),setTimeout(()=>{a.resetCurrentItem(),$.$reset(),l.value.$reset()},300)}}return(n,t)=>{const m=u("BaseBreadcrumbItem"),c=u("BaseBreadcrumb"),Y=u("BasePageHeader"),V=u("BaseInput"),p=u("BaseInputGroup"),H=u("BaseMoney"),T=u("BaseIcon"),R=u("BaseSelectAction"),U=u("BaseMultiselect"),J=u("BaseTextarea"),K=u("BaseButton"),W=u("BaseInputGrid"),X=u("BaseCard"),Q=u("BasePage");return h(),M(Q,null,{default:i(()=>[o(Y,{title:k.value},{default:i(()=>[o(c,null,{default:i(()=>[o(m,{title:n.$t("general.home"),to:"dashboard"},null,8,["title"]),o(m,{title:n.$t("items.item",2),to:"/admin/items"},null,8,["title"]),o(m,{title:k.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),o(pe),N("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:ce(O,["prevent"])},[o(X,{class:"w-full"},{default:i(()=>[o(W,{layout:"one-column"},{default:i(()=>[o(p,{label:n.$t("items.name"),"content-loading":e(s),required:"",error:e(l).currentItem.name.$error&&e(l).currentItem.name.$errors[0].$message},{default:i(()=>[o(V,{modelValue:e(a).currentItem.name,"onUpdate:modelValue":t[0]||(t[0]=r=>e(a).currentItem.name=r),"content-loading":e(s),invalid:e(l).currentItem.name.$error,onInput:t[1]||(t[1]=r=>e(l).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(p,{label:n.$t("items.sku"),"content-loading":e(s),error:e(l).currentItem.sku.$error&&e(l).currentItem.sku.$errors[0].$message},{default:i(()=>[o(V,{modelValue:e(a).currentItem.sku,"onUpdate:modelValue":t[2]||(t[2]=r=>e(a).currentItem.sku=r),"content-loading":e(s),invalid:e(l).currentItem.sku.$error,onInput:t[3]||(t[3]=r=>e(l).currentItem.sku.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(p,{label:n.$t("items.barcode"),"content-loading":e(s),error:e(l).currentItem.barcode.$error&&e(l).currentItem.barcode.$errors[0].$message},{default:i(()=>[o(V,{modelValue:e(a).currentItem.barcode,"onUpdate:modelValue":t[4]||(t[4]=r=>e(a).currentItem.barcode=r),"content-loading":e(s),invalid:e(l).currentItem.barcode.$error,onInput:t[5]||(t[5]=r=>e(l).currentItem.barcode.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),o(p,{label:n.$t("items.price"),"content-loading":e(s)},{default:i(()=>[o(H,{modelValue:B.value,"onUpdate:modelValue":t[6]||(t[6]=r=>B.value=r),"content-loading":e(s)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(p,{"content-loading":e(s),label:n.$t("items.unit")},{default:i(()=>[o(U,{modelValue:e(a).currentItem.unit_id,"onUpdate:modelValue":t[7]||(t[7]=r=>e(a).currentItem.unit_id=r),"content-loading":e(s),label:"name",options:e(a).itemUnits,"value-prop":"id",placeholder:n.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:i(()=>[o(R,{onClick:F},{default:i(()=>[o(T,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),L(" "+q(n.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),G.value?(h(),M(p,{key:0,label:n.$t("items.taxes"),"content-loading":e(s)},{default:i(()=>[o(U,{modelValue:S.value,"onUpdate:modelValue":t[8]||(t[8]=r=>S.value=r),"content-loading":e(s),options:D.value,mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):P("",!0),o(p,{label:n.$t("items.description"),"content-loading":e(s),error:e(l).currentItem.description.$error&&e(l).currentItem.description.$errors[0].$message},{default:i(()=>[o(J,{modelValue:e(a).currentItem.description,"onUpdate:modelValue":t[9]||(t[9]=r=>e(a).currentItem.description=r),"content-loading":e(s),name:"description",row:2,rows:"2",onInput:t[10]||(t[10]=r=>e(l).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),N("div",null,[o(K,{"content-loading":e(s),type:"submit",loading:_.value},{left:i(r=>[_.value?P("",!0):(h(),M(T,{key:0,name:"ArrowDownOnSquareIcon",class:de(r.class)},null,8,["class"]))]),default:i(()=>[L(" "+q(v.value?n.$t("items.update_item"):n.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],32)]),_:1})}}};export{fe as default};
