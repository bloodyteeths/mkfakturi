import{a6 as g,u as h,s as c,a3 as o}from"./main-rC5xHABW.js";const w=(f=!1)=>{const b=f?window.pinia.defineStore:g,{global:d}=window.i18n;return b({id:"bills",state:()=>({bills:[],billTotalCount:0,selectedBill:null,selectedBills:[],selectAllField:!1,billPayments:[],isFetchingInitial:!1,isFetchingList:!1,isFetchingView:!1}),actions:{fetchBills(e){return this.isFetchingList=!0,new Promise((i,l)=>{c.get("/bills",{params:e}).then(s=>{var t,a;this.bills=s.data.data,this.billTotalCount=((t=s.data.meta)==null?void 0:t.bill_total_count)??((a=s.data.meta)==null?void 0:a.total)??this.bills.length,this.isFetchingList=!1,i(s)}).catch(s=>{this.isFetchingList=!1,o(s),l(s)})})},fetchBill(e){return this.isFetchingView=!0,new Promise((i,l)=>{c.get(`/bills/${e}`).then(s=>{this.selectedBill=s.data.data,this.isFetchingView=!1,i(s)}).catch(s=>{this.isFetchingView=!1,o(s),l(s)})})},createBill(e){const i=h();return new Promise((l,s)=>{c.post("/bills",e).then(t=>{this.bills.push(t.data.data),i.showNotification({type:"success",message:d.t("bills.created_message")}),l(t)}).catch(t=>{o(t),s(t)})})},updateBill(e){const i=h();return new Promise((l,s)=>{c.put(`/bills/${e.id}`,e).then(t=>{const a=t.data.data,n=this.bills.findIndex(u=>u.id===a.id);n!==-1&&(this.bills[n]=a),i.showNotification({type:"success",message:d.t("bills.updated_message")}),l(t)}).catch(t=>{o(t),s(t)})})},deleteBill(e){const i=h();return new Promise((l,s)=>{c.post("/bills/delete",{ids:[e]}).then(t=>{const a=this.bills.findIndex(n=>n.id===e);this.bills.splice(a,1),i.showNotification({type:"success",message:d.tc("bills.deleted_message",1)}),l(t)}).catch(t=>{o(t),s(t)})})},deleteMultipleBills(){const e=h();return new Promise((i,l)=>{c.post("/bills/delete",{ids:this.selectedBills}).then(s=>{this.selectedBills.forEach(t=>{const a=this.bills.findIndex(n=>n.id===t.id);this.bills.splice(a,1)}),this.selectedBills=[],e.showNotification({type:"success",message:d.tc("bills.deleted_message",2)}),i(s)}).catch(s=>{o(s),l(s)})})},fetchBillPayments(e,i){return new Promise((l,s)=>{c.get(`/bills/${e}/payments`,{params:i}).then(t=>{this.billPayments=t.data.data,l(t)}).catch(t=>{o(t),s(t)})})},createBillPayment(e,i){const l=h();return new Promise((s,t)=>{c.post(`/bills/${e}/payments`,i).then(a=>{this.billPayments.push(a.data.data),l.showNotification({type:"success",message:d.t("bills.payment_created_message")}),s(a)}).catch(a=>{o(a),t(a)})})},updateBillPayment(e,i,l){const s=h();return new Promise((t,a)=>{c.put(`/bills/${e}/payments/${i}`,l).then(n=>{const u=n.data.data,m=this.billPayments.findIndex(r=>r.id===u.id);m!==-1&&(this.billPayments[m]=u),s.showNotification({type:"success",message:d.t("bills.payment_updated_message")}),t(n)}).catch(n=>{o(n),a(n)})})},deleteBillPayment(e,i){const l=h();return new Promise((s,t)=>{c.delete(`/bills/${e}/payments/${i}`).then(a=>{this.billPayments=this.billPayments.filter(n=>n.id!==i),l.showNotification({type:"success",message:d.t("bills.payment_deleted_message")}),s(a)}).catch(a=>{o(a),t(a)})})},sendBill(e){var a;const i=h(),l=(a=e.supplier)==null?void 0:a.email,s=d.t("bills.default_send_subject",{number:e.bill_number}),t=d.t("bills.default_send_body");return new Promise((n,u)=>{c.post(`/bills/${e.id}/send`,{to:l,subject:s,body:t}).then(m=>{i.showNotification({type:"success",message:d.t("bills.sent_message")}),n(m)}).catch(m=>{o(m),u(m)})})},markAsSent(e){const i=h();return new Promise((l,s)=>{c.post(`/bills/${e.id}/mark-as-sent`,{status:e.status}).then(t=>{this.selectedBill&&this.selectedBill.id===e.id&&(this.selectedBill.status="SENT"),i.showNotification({type:"success",message:d.t("bills.marked_sent_message")}),l(t)}).catch(t=>{o(t),s(t)})})},markAsViewed(e){const i=h();return new Promise((l,s)=>{c.post(`/bills/${e}/mark-as-viewed`).then(t=>{this.selectedBill&&this.selectedBill.id===e&&(this.selectedBill.status="VIEWED"),i.showNotification({type:"success",message:d.t("bills.marked_viewed_message")}),l(t)}).catch(t=>{o(t),s(t)})})},markAsCompleted(e){const i=h();return new Promise((l,s)=>{c.post(`/bills/${e}/mark-as-completed`).then(t=>{this.selectedBill&&this.selectedBill.id===e&&(this.selectedBill.status="COMPLETED"),i.showNotification({type:"success",message:d.t("bills.marked_completed_message")}),l(t)}).catch(t=>{o(t),s(t)})})},selectBill(e){this.selectedBills=e,this.selectedBills.length===this.bills.length?this.selectAllField=!0:this.selectAllField=!1},selectAllBills(){if(this.selectedBills.length===this.bills.length)this.selectedBills=[],this.selectAllField=!1;else{const e=this.bills.map(i=>i.id);this.selectedBills=e,this.selectAllField=!0}},resetSelectedBills(){this.selectedBills=[],this.selectAllField=!1},setSelectAllState(e){this.selectAllField=e},cloneBill(e){const i=h();return new Promise((l,s)=>{c.post(`/bills/${e}/clone`).then(t=>{i.showNotification({type:"success",message:d.t("bills.cloned_message")}),l(t)}).catch(t=>{o(t),s(t)})})}}})()};export{w as u};
