import{a6 as ee,u as G,s as A,a3 as V,a0 as K,v as J,F as Q,e as P,j as X,r as I,K as w,o as p,w as m,b as h,a as l,t as d,c as W,L as E,Q as te,R as se,q as _,al as Y,G as ne,ax as oe,O as ae,N as ie,n as le,a7 as re,k as ce,V as q,l as S,ag as ue,aB as de}from"./main-DpDYmbyp.js";const me=(n=!1)=>{const x=n?window.pinia.defineStore:ee,{global:v}=window.i18n,b=G();return x({id:"e-invoice",state:()=>({currentEInvoice:null,submissions:[],portalStatus:null,isLoading:!1}),getters:{hasEInvoice:r=>!!r.currentEInvoice,eInvoiceStatus:r=>{var c;return((c=r.currentEInvoice)==null?void 0:c.status)||null}},actions:{generateEInvoice(r){return new Promise((c,o)=>{this.isLoading=!0,A.post(`/e-invoices/generate/${r}`).then(e=>{this.currentEInvoice=e.data.data,this.submissions=e.data.submissions||[],b.showNotification({type:"success",message:v.t("e_invoice.generated_successfully")}),c(e)}).catch(e=>{V(e),o(e)}).finally(()=>{this.isLoading=!1})})},signEInvoice(r,c){return new Promise((o,e)=>{this.isLoading=!0,A.post(`/e-invoices/${r}/sign`,{passphrase:c}).then(s=>{this.currentEInvoice=s.data.data,this.submissions=s.data.submissions||[],b.showNotification({type:"success",message:v.t("e_invoice.signed_successfully")}),o(s)}).catch(s=>{V(s),e(s)}).finally(()=>{this.isLoading=!1})})},submitEInvoice(r){return new Promise((c,o)=>{this.isLoading=!0,A.post(`/e-invoices/${r}/submit`).then(e=>{this.currentEInvoice=e.data.data,this.submissions=e.data.submissions||[],b.showNotification({type:"success",message:v.t("e_invoice.submitted_successfully")}),c(e)}).catch(e=>{V(e),o(e)}).finally(()=>{this.isLoading=!1})})},simulateSubmission(r){return new Promise((c,o)=>{this.isLoading=!0,A.post(`/e-invoices/${r}/simulate`).then(e=>{b.showNotification({type:"success",message:v.t("e_invoice.validation_successful")}),c(e)}).catch(e=>{V(e),o(e)}).finally(()=>{this.isLoading=!1})})},fetchEInvoiceStatus(r){return new Promise((c,o)=>{A.get(`/e-invoices/by-invoice/${r}`).then(e=>{this.currentEInvoice=e.data.data,this.submissions=e.data.submissions||[],c(e)}).catch(e=>{var s;((s=e.response)==null?void 0:s.status)===404?(this.currentEInvoice=null,this.submissions=[],c(null)):(V(e),o(e))})})},fetchSubmissions(r){return new Promise((c,o)=>{A.get(`/e-invoices/${r}/submissions`).then(e=>{this.submissions=e.data.data,c(e)}).catch(e=>{V(e),o(e)})})},downloadXml(r){return new Promise((c,o)=>{A.get(`/e-invoices/${r}/download-xml`,{responseType:"blob"}).then(e=>{const s=window.URL.createObjectURL(new Blob([e.data])),g=document.createElement("a");g.href=s,g.setAttribute("download",`e-invoice-${r}.xml`),document.body.appendChild(g),g.click(),g.remove(),window.URL.revokeObjectURL(s),b.showNotification({type:"success",message:v.t("e_invoice.downloaded_successfully")}),c(e)}).catch(e=>{V(e),o(e)})})},checkPortalStatus(){return new Promise((r,c)=>{A.get("/e-invoices/portal-status").then(o=>{this.portalStatus=o.data.data,r(o)}).catch(o=>{V(o),c(o)})})},resubmit(r){return new Promise((c,o)=>{this.isLoading=!0,A.post(`/e-invoices/submissions/${r}/resubmit`).then(e=>{this.currentEInvoice=e.data.data,this.submissions=e.data.submissions||[],b.showNotification({type:"success",message:v.t("e_invoice.resubmitted_successfully")}),c(e)}).catch(e=>{V(e),o(e)}).finally(()=>{this.isLoading=!1})})},resetEInvoice(){this.currentEInvoice=null,this.submissions=[],this.portalStatus=null,this.isLoading=!1}}})()},ve={class:"px-6 pb-6"},fe={class:"flex justify-center mb-4"},pe={class:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center"},ge={class:"text-lg font-semibold text-center mb-2"},he={class:"text-sm text-gray-600 text-center mb-6"},ye={class:"bg-gray-50 rounded-lg p-4 mb-6"},we={class:"text-center"},_e={class:"text-sm text-gray-500 mb-1"},be={class:"text-2xl font-bold text-gray-900"},Ie={class:"text-sm text-gray-600 mt-1"},xe={key:0,class:"mt-4 space-y-2"},Ee={class:"text-sm text-gray-700"},$e={class:"flex flex-col space-y-3"},ke={class:"text-xs text-center text-gray-500 mt-4"},Se={__name:"UpgradeCTA",props:{show:{type:Boolean,default:!1},requiredTier:{type:String,required:!0},featureName:{type:String,required:!0},title:{type:String,default:null},description:{type:String,default:null},icon:{type:String,default:"LockClosedIcon"},features:{type:Array,default:null}},emits:["close","upgraded"],setup(n,{emit:x}){const v=n,b=x,{t:r}=J.useI18n(),c=G(),o=Q(),e=P(!1),s={starter:{name:"Starter",price:12,paddle_price_id:void 0},standard:{name:"Standard",price:29,paddle_price_id:void 0},business:{name:"Business",price:59,paddle_price_id:void 0},max:{name:"Max",price:149,paddle_price_id:void 0}},g=X(()=>{var i;return((i=s[v.requiredTier])==null?void 0:i.name)||v.requiredTier}),U=X(()=>{var i;return((i=s[v.requiredTier])==null?void 0:i.price)||0}),M=X(()=>{var i;return(i=s[v.requiredTier])==null?void 0:i.paddle_price_id});async function C(){if(!e.value)try{e.value=!0;const i=o.selectedCompany;if(!i)throw new Error("No company selected");if(!M.value)throw new Error("Invalid tier configuration");if(typeof Paddle>"u")throw new Error("Paddle.js not loaded");Paddle.Checkout.open({product:M.value,email:i.owner_email,successCallback:B=>{c.showNotification({type:"success",message:r("subscriptions.upgrade_initiated")}),b("upgraded",B),b("close"),setTimeout(()=>{window.location.reload()},2e3)},closeCallback:()=>{e.value=!1}})}catch(i){console.error("Upgrade failed:",i),c.showNotification({type:"error",message:i.message||r("subscriptions.upgrade_failed")}),e.value=!1}}return(i,B)=>{const N=I("BaseIcon"),R=I("BaseButton"),u=I("BaseModal");return p(),w(u,{show:n.show,onClose:B[1]||(B[1]=y=>i.$emit("close")),title:n.title||i.$t("subscriptions.upgrade_required"),variant:"sm"},{default:m(()=>[h("div",ve,[h("div",fe,[h("div",pe,[l(N,{name:n.icon||"LockClosedIcon",class:"w-8 h-8 text-primary-600"},null,8,["name"])])]),h("h3",ge,d(n.featureName),1),h("p",he,d(n.description||i.$t("subscriptions.feature_requires_plan",{feature:n.featureName,plan:g.value})),1),h("div",ye,[h("div",we,[h("p",_e,d(i.$t("subscriptions.upgrade_to")),1),h("p",be,d(g.value),1),h("p",Ie," â‚¬"+d(U.value)+"/"+d(i.$t("subscriptions.month")),1)]),n.features&&n.features.length?(p(),W("div",xe,[(p(!0),W(te,null,se(n.features,(y,$)=>(p(),W("div",{key:$,class:"flex items-start"},[l(N,{name:"CheckCircleIcon",class:"w-5 h-5 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),h("span",Ee,d(y),1)]))),128))])):E("",!0)]),h("div",$e,[l(R,{variant:"primary",onClick:C,loading:e.value,class:"w-full"},{default:m(()=>[l(N,{name:"ArrowUpCircleIcon",class:"w-4 h-4 mr-2"}),_(" "+d(i.$t("subscriptions.upgrade_now")),1)]),_:1},8,["loading"]),l(R,{variant:"outline",onClick:B[0]||(B[0]=y=>i.$emit("close")),class:"w-full"},{default:m(()=>[_(d(i.$t("general.cancel")),1)]),_:1})]),h("p",ke,d(i.$t("subscriptions.cancel_anytime")),1)])]),_:1},8,["show","title"])}}},Ce=K(Se,[["__scopeId","data-v-30ea27e9"]]),Be={class:"export-xml-container"},Ne={class:"px-6 pb-6"},De={class:"mb-4"},Le={class:"mb-4"},Te={class:"text-sm text-gray-500 mt-1"},Ae={class:"mb-6"},Ve={class:"text-sm text-gray-500 mt-1"},Pe={class:"flex justify-end space-x-3"},Ue={__name:"ExportXml",props:{invoice:{type:Object,required:!0},standalone:{type:Boolean,default:!1}},setup(n){const x=n,{t:v}=J.useI18n(),b=G(),r=Y(),c=Q(),o=P(!1),e=P(!1),s=P(!1),g=P("ubl"),U=P(!0),M=P(!0),C=X(()=>[{value:"ubl",label:v("invoices.format_ubl_21")},{value:"ubl_signed",label:v("invoices.format_ubl_signed")}]),i=X(()=>{const u=c.selectedCompany;if(!u||!u.subscription)return!1;const y=u.subscription.plan||"free",$=u.subscription.status||"inactive";return u.subscription.on_trial||!1?!0:["standard","business","max"].includes(y)&&["active","trial"].includes($)});function B(){if(!i.value){e.value=!0;return}o.value=!0}function N(){o.value=!1}async function R(){var u,y,$,O,T;if(!s.value)try{s.value=!0;const k={invoice_id:x.invoice.id,format:g.value,include_signature:U.value,validate:M.value},D=await r.exportXml(k);if(D.data){const j=new Blob([D.data],{type:"application/xml"}),t=window.URL.createObjectURL(j),a=document.createElement("a");a.href=t;const f=`invoice-${x.invoice.invoice_number}-${g.value}.xml`;a.download=f,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t),b.showNotification({type:"success",message:v("invoices.xml_exported_successfully",{filename:f})}),N()}}catch(k){console.error("XML export failed:",k);let D=v("invoices.xml_export_failed");if(((u=k.response)==null?void 0:u.status)===402){N(),e.value=!0;return}($=(y=k.response)==null?void 0:y.data)!=null&&$.message?D=k.response.data.message:((O=k.response)==null?void 0:O.status)===422?D=v("invoices.xml_validation_failed"):((T=k.response)==null?void 0:T.status)===500&&(D=v("invoices.xml_generation_failed")),b.showNotification({type:"error",message:D})}finally{s.value=!1}}return(u,y)=>{const $=I("BaseIcon"),O=I("BaseDropdownItem"),T=I("BaseButton"),k=I("BaseInputLabel"),D=I("BaseSelectInput"),j=I("BaseCheckbox"),t=I("BaseModal");return p(),W("div",Be,[n.standalone?E("",!0):(p(),w(O,{key:0,onClick:B},{default:m(()=>[l($,{name:"DocumentArrowDownIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(u.$t("invoices.export_xml")),1)]),_:1})),n.standalone?(p(),w(T,{key:1,variant:"primary-outline",class:"ml-3",onClick:B,loading:s.value},{default:m(()=>[l($,{name:"DocumentArrowDownIcon",class:"w-4 h-4 mr-2"}),_(" "+d(u.$t("invoices.export_xml")),1)]),_:1},8,["loading"])):E("",!0),l(Ce,{show:e.value,onClose:y[0]||(y[0]=a=>e.value=!1),"required-tier":"standard","feature-name":u.$t("invoices.export_xml"),icon:"DocumentArrowDownIcon",features:[u.$t("subscriptions.features.efaktura_sending"),u.$t("subscriptions.features.qes_signing"),u.$t("subscriptions.features.multi_users"),u.$t("subscriptions.features.200_invoices")]},null,8,["show","feature-name","features"]),l(t,{show:o.value,onClose:N,title:u.$t("invoices.export_xml_title"),variant:"sm"},{default:m(()=>[h("div",Ne,[h("div",De,[l(k,null,{default:m(()=>[_(d(u.$t("invoices.export_format")),1)]),_:1}),l(D,{modelValue:g.value,"onUpdate:modelValue":y[1]||(y[1]=a=>g.value=a),options:C.value,class:"mt-1"},null,8,["modelValue","options"])]),h("div",Le,[l(j,{modelValue:U.value,"onUpdate:modelValue":y[2]||(y[2]=a=>U.value=a),label:u.$t("invoices.include_digital_signature")},null,8,["modelValue","label"]),h("p",Te,d(u.$t("invoices.signature_help_text")),1)]),h("div",Ae,[l(j,{modelValue:M.value,"onUpdate:modelValue":y[3]||(y[3]=a=>M.value=a),label:u.$t("invoices.validate_xml")},null,8,["modelValue","label"]),h("p",Ve,d(u.$t("invoices.validation_help_text")),1)]),h("div",Pe,[l(T,{variant:"outline",onClick:N},{default:m(()=>[_(d(u.$t("general.cancel")),1)]),_:1}),l(T,{variant:"primary",onClick:R,loading:s.value},{default:m(()=>[l($,{name:"DocumentArrowDownIcon",class:"w-4 h-4 mr-2"}),_(" "+d(u.$t("invoices.download_xml")),1)]),_:1},8,["loading"])])])]),_:1},8,["show","title"])])}}},Me=K(Ue,[["__scopeId","data-v-4a1f4b0a"]]),qe={__name:"InvoiceIndexDropdown",props:{row:{type:Object,default:null},table:{type:Object,default:null},loadData:{type:Function,default:()=>{}}},setup(n){const x=n,v=Y(),b=me(),r=ne(),c=G(),o=oe(),e=ae(),{t:s}=J.useI18n(),g=ie(),U=le(),M=re("utils"),C=P(null),i=P(!1);function B(t){return(t.status=="SENT"||t.status=="VIEWED")&&e.hasAbilities(q.SEND_INVOICE)}function N(t){return t.status=="DRAFT"&&g.name!=="invoices.view"&&e.hasAbilities(q.SEND_INVOICE)}function R(t){return(t.status=="SENT"||t.status=="PAID"||t.status=="VIEWED")&&e.hasAbilities(q.VIEW_INVOICE)}async function u(t){o.openDialog({title:s("general.are_you_sure"),message:s("invoices.confirm_delete"),yesLabel:s("general.ok"),noLabel:s("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(a=>{t=t,a&&v.deleteInvoice({ids:[t]}).then(f=>{f.data.success&&(U.push("/admin/invoices"),x.table&&x.table.refresh(),v.$patch(F=>{F.selectedInvoices=[],F.selectAllField=!1}))})})}async function y(t){o.openDialog({title:s("general.are_you_sure"),message:s("invoices.confirm_clone"),yesLabel:s("general.ok"),noLabel:s("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(a=>{a&&v.cloneInvoice(t).then(f=>{U.push(`/admin/invoices/${f.data.data.id}/edit`)})})}async function $(t){o.openDialog({title:s("general.are_you_sure"),message:s("invoices.invoice_mark_as_sent"),yesLabel:s("general.ok"),noLabel:s("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(a=>{const f={id:t,status:"SENT"};a&&v.markAsSent(f).then(F=>{x.table&&x.table.refresh()})})}async function O(t){r.openModal({title:s("invoices.send_invoice"),componentName:"SendInvoiceModal",id:t.id,data:t,variant:"sm"})}function T(){let t=`${window.location.origin}/invoices/pdf/${x.row.unique_hash}`;M.copyTextToClipboard(t),c.showNotification({type:"success",message:s("general.copied_pdf_url_clipboard")})}ce(async()=>{var t;g.name==="invoices.view"&&((t=x.row)!=null&&t.id)&&await D()});const k=X(()=>C.value?e.hasAbilities(q.VIEW_INVOICE)&&C.value.status&&["SIGNED","SUBMITTED","ACCEPTED","REJECTED"].includes(C.value.status):!1);async function D(){if(!i.value){i.value=!0;try{await b.fetchEInvoiceStatus(x.row.id),C.value=b.currentEInvoice}catch{C.value=null}finally{i.value=!1}}}async function j(){var t;if(!((t=C.value)!=null&&t.id)){c.showNotification({type:"error",message:s("e_invoice.no_einvoice")});return}try{await b.downloadXml(C.value.id)}catch(a){console.error("Download e-invoice XML failed:",a)}}return(t,a)=>{const f=I("BaseIcon"),F=I("BaseButton"),L=I("BaseDropdownItem"),H=I("router-link"),Z=I("BaseDropdown");return p(),w(Z,null,{activator:m(()=>[S(g).name==="invoices.view"?(p(),w(F,{key:0,variant:"primary"},{default:m(()=>[l(f,{name:"EllipsisHorizontalIcon",class:"h-5 text-white"})]),_:1})):(p(),w(f,{key:1,name:"EllipsisHorizontalIcon",class:"h-5 text-gray-500"}))]),default:m(()=>[S(e).hasAbilities(S(q).EDIT_INVOICE)?(p(),w(H,{key:0,to:`/admin/invoices/${n.row.id}/edit`},{default:m(()=>[ue(l(L,null,{default:m(()=>[l(f,{name:"PencilIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("general.edit")),1)]),_:1},512),[[de,n.row.allow_edit]])]),_:1},8,["to"])):E("",!0),S(g).name==="invoices.view"?(p(),w(L,{key:1,onClick:T},{default:m(()=>[l(f,{name:"LinkIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("general.copy_pdf_url")),1)]),_:1})):E("",!0),S(g).name!=="invoices.view"&&S(e).hasAbilities(S(q).VIEW_INVOICE)?(p(),w(H,{key:2,to:`/admin/invoices/${n.row.id}/view`},{default:m(()=>[l(L,null,{default:m(()=>[l(f,{name:"EyeIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("general.view")),1)]),_:1})]),_:1},8,["to"])):E("",!0),N(n.row)?(p(),w(L,{key:3,onClick:a[0]||(a[0]=z=>O(n.row))},{default:m(()=>[l(f,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("invoices.send_invoice")),1)]),_:1})):E("",!0),B(n.row)?(p(),w(L,{key:4,onClick:a[1]||(a[1]=z=>O(n.row))},{default:m(()=>[l(f,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("invoices.resend_invoice")),1)]),_:1})):E("",!0),l(H,{to:`/admin/payments/${n.row.id}/create`},{default:m(()=>[n.row.status=="SENT"&&S(g).name!=="invoices.view"?(p(),w(L,{key:0},{default:m(()=>[l(f,{name:"CreditCardIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("invoices.record_payment")),1)]),_:1})):E("",!0)]),_:1},8,["to"]),N(n.row)?(p(),w(L,{key:5,onClick:a[2]||(a[2]=z=>$(n.row.id))},{default:m(()=>[l(f,{name:"CheckCircleIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("invoices.mark_as_sent")),1)]),_:1})):E("",!0),S(e).hasAbilities(S(q).CREATE_INVOICE)?(p(),w(L,{key:6,onClick:a[3]||(a[3]=z=>y(n.row))},{default:m(()=>[l(f,{name:"DocumentTextIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("invoices.clone_invoice")),1)]),_:1})):E("",!0),R(n.row)?(p(),w(Me,{key:7,invoice:n.row},null,8,["invoice"])):E("",!0),k.value?(p(),w(L,{key:8,onClick:j},{default:m(()=>[l(f,{name:"DocumentArrowDownIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("e_invoice.download_xml")),1)]),_:1})):E("",!0),S(e).hasAbilities(S(q).DELETE_INVOICE)?(p(),w(L,{key:9,onClick:a[4]||(a[4]=z=>u(n.row.id))},{default:m(()=>[l(f,{name:"TrashIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),_(" "+d(t.$t("general.delete")),1)]),_:1})):E("",!0)]),_:1})}}};export{qe as _,me as u};
