import{v as R,u as G,e as g,I as J,j as Q,k as X,K as q,s as V,r as f,o as _,w as i,a as r,b as e,L as b,q as p,t as s,l as w,ab as Y,c as $,bH as Z,bI as ee,af as te,as as se,av as ae,M as oe,ad as ie}from"./main-Bq1VlIEV.js";const re={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},le={class:"md:col-span-2"},ne={class:"flex items-center"},ce={class:"text-lg font-medium"},de={class:"space-y-6"},ue={key:0},fe={key:0,class:"mt-1 text-sm text-red-600"},pe={class:"mt-1 text-xs text-gray-500"},me={key:1},_e={key:2,class:"flex justify-end"},ve={class:"flex items-center"},ge={class:"text-lg font-medium"},he={key:0,class:"space-y-4"},ye={class:"flex items-center justify-between"},we={class:"text-sm text-gray-600"},$e={class:"text-sm text-gray-600"},xe={class:"text-sm font-medium break-all"},be={class:"text-sm text-gray-600"},ke={class:"text-sm font-medium"},Ce={class:"text-sm text-gray-600"},Be={class:"text-xs font-mono break-all bg-gray-50 p-2 rounded"},Ne={class:"text-sm text-gray-600"},De={class:"text-sm"},je={class:"pt-4 border-t"},Ve={key:1,class:"text-center py-8"},Ie={class:"mt-4 text-gray-500"},Ue={class:"text-sm text-gray-400 mt-1"},Le={class:"text-lg font-medium"},Ee={key:0,class:"space-y-4 px-6 py-4"},Fe={class:"grid grid-cols-2 gap-4"},Me={class:"block text-sm font-medium text-gray-700"},Te={class:"mt-1 text-sm text-gray-900"},qe={class:"block text-sm font-medium text-gray-700"},ze={class:"mt-1 text-sm text-gray-900"},Pe={class:"block text-sm font-medium text-gray-700"},Se={class:"mt-1 text-sm text-gray-900"},He={class:"block text-sm font-medium text-gray-700"},Ae={class:"mt-1 text-sm text-gray-900 font-mono"},We={class:"block text-sm font-medium text-gray-700"},Ke={class:"mt-1 text-sm text-gray-900"},Oe={class:"grid grid-cols-2 gap-4"},Re={class:"block text-sm font-medium text-gray-700"},Ge={class:"mt-1 text-sm text-gray-900"},Je={class:"block text-sm font-medium text-gray-700"},Qe={class:"mt-1 text-sm text-gray-900"},Xe={class:"px-6 py-4 bg-gray-50 border-t border-gray-200"},Ye={class:"text-lg font-medium"},Ze={class:"space-y-4 px-6 py-4"},et={class:"text-gray-700"},tt={class:"bg-yellow-50 border border-yellow-200 rounded-md p-3"},st={class:"flex"},at={class:"text-sm text-yellow-800"},ot={class:"flex justify-end space-x-3 px-6 py-4 bg-gray-50 border-t border-gray-200"},lt={__name:"CertUpload",setup(it){const{t:d}=R.useI18n(),m=G(),v=g(null),o=g(null),C=g(!1),D=g(!1),B=g(!1),k=g(!1),h=g(""),z=g(null),u=J({password:"",description:""});Q(()=>v.value&&u.password.trim());const P=(t,a,n)=>{if(a){v.value=a,h.value="";const y=a.name.toLowerCase();if(!y.endsWith(".p12")&&!y.endsWith(".pfx")){m.showNotification({type:"error",message:d("certificates.invalid_file_type")}),N();return}if(a.size>5*1024*1024){m.showNotification({type:"error",message:d("certificates.file_too_large")}),N();return}}},N=()=>{v.value=null,u.password="",u.description="",h.value=""},S=async()=>{var t,a,n,y,x;if(!(!v.value||!u.password)){C.value=!0,h.value="";try{const c=new FormData;c.append("certificate",v.value),c.append("password",u.password),c.append("description",u.description);const U=await V.post("/api/v1/certificates/upload",c,{headers:{"Content-Type":"multipart/form-data"}});m.showNotification({type:"success",message:d("certificates.upload_success")}),N(),await I()}catch(c){console.error("Certificate upload error:",c),(n=(a=(t=c.response)==null?void 0:t.data)==null?void 0:a.errors)!=null&&n.password?h.value=c.response.data.errors.password[0]:(x=(y=c.response)==null?void 0:y.data)!=null&&x.message?m.showNotification({type:"error",message:c.response.data.message}):m.showNotification({type:"error",message:d("certificates.upload_error")})}finally{C.value=!1}}},H=async()=>{var t,a;if(console.log("deleteCertificate called",{certificateId:(t=o.value)==null?void 0:t.id,hasCertificate:!!o.value}),!((a=o.value)!=null&&a.id)){console.log("No certificate ID found"),m.showNotification({type:"error",message:d("certificates.no_certificate")});return}D.value=!0,console.log("Making DELETE request to:",`/api/v1/certificates/${o.value.id}`);try{await V.delete(`/api/v1/certificates/${o.value.id}`),console.log("Delete request successful"),m.showNotification({type:"success",message:d("certificates.delete_success")}),k.value=!1,o.value=null}catch(n){console.error("Certificate delete error:",n),m.showNotification({type:"error",message:d("certificates.delete_error")})}finally{D.value=!1}},I=async()=>{var t;try{const a=await V.get("/api/v1/certificates/current"),n=a.data.data;o.value=Array.isArray(n)&&n.length>0?n[0]:null,a.data.warning&&a.data.message&&m.showNotification({type:"warning",message:a.data.message})}catch(a){((t=a.response)==null?void 0:t.status)!==404&&console.error("Failed to fetch certificate:",a),o.value=null}},A=t=>{if(!t)return d("certificates.unknown");try{return new Date(t).toLocaleDateString()}catch{return d("certificates.unknown")}},j=t=>{if(!t)return d("certificates.unknown");try{return new Date(t).toLocaleString()}catch{return d("certificates.unknown")}};return X(()=>{I()}),(t,a)=>{const n=f("BaseButton"),y=f("BasePageHeader"),x=f("BaseLabel"),c=f("BaseFileUploader"),U=f("BaseInput"),W=f("BaseTextarea"),L=f("BaseCard"),K=f("BaseBadge"),E=f("BaseModal"),O=f("BasePage");return _(),q(O,null,{default:i(()=>[r(y,{title:t.$t("certificates.title")},{actions:i(()=>[o.value?(_(),q(n,{key:0,variant:"primary-outline",onClick:a[0]||(a[0]=l=>B.value=!0)},{left:i(()=>[r(w(Y),{class:"h-5 w-5"})]),default:i(()=>[p(" "+s(t.$t("certificates.view_certificate")),1)]),_:1})):b("",!0)]),_:1},8,["title"]),e("div",re,[e("div",le,[r(L,null,{header:i(()=>[e("div",ne,[r(w(ee),{class:"h-5 w-5 text-primary-500 mr-2"}),e("span",ce,s(t.$t("certificates.upload_title")),1)])]),default:i(()=>[e("div",de,[e("div",null,[r(x,null,{default:i(()=>[p(s(t.$t("certificates.certificate_file")),1)]),_:1}),r(c,{ref_key:"certificateUploader",ref:z,accept:".p12,.pfx","preserve-local-files":!1,"recommended-text":".p12 or .pfx file (max 5MB)",onChange:P,onRemove:N},null,512)]),v.value?(_(),$("div",ue,[r(x,{for:"password",required:""},{default:i(()=>[p(s(t.$t("certificates.certificate_password")),1)]),_:1}),r(U,{id:"password",modelValue:u.password,"onUpdate:modelValue":a[1]||(a[1]=l=>u.password=l),type:"password",placeholder:t.$t("certificates.password_placeholder"),required:"",autocomplete:"new-password",invalid:!!h.value},null,8,["modelValue","placeholder","invalid"]),h.value?(_(),$("p",fe,s(h.value),1)):b("",!0),e("p",pe,s(t.$t("certificates.password_help")),1)])):b("",!0),v.value?(_(),$("div",me,[r(x,{for:"description"},{default:i(()=>[p(s(t.$t("certificates.description")),1)]),_:1}),r(W,{id:"description",modelValue:u.description,"onUpdate:modelValue":a[2]||(a[2]=l=>u.description=l),placeholder:t.$t("certificates.description_placeholder"),rows:"3"},null,8,["modelValue","placeholder"])])):b("",!0),v.value?(_(),$("div",_e,[r(n,{loading:C.value,disabled:!u.password||C.value,onClick:S},{left:i(()=>[r(w(Z),{class:"h-4 w-4"})]),default:i(()=>[p(" "+s(t.$t("certificates.upload_certificate")),1)]),_:1},8,["loading","disabled"])])):b("",!0)])]),_:1})]),e("div",null,[r(L,null,{header:i(()=>{var l;return[e("div",ve,[r(w(ae),{class:oe(["h-5 w-5 mr-2",(l=o.value)!=null&&l.is_valid?"text-green-500":"text-gray-400"])},null,8,["class"]),e("span",ge,s(t.$t("certificates.current_certificate")),1)])]}),default:i(()=>{var l;return[o.value?(_(),$("div",he,[e("div",ye,[e("span",we,s(t.$t("certificates.status")),1),r(K,{variant:o.value.is_valid?"green":"red",size:"sm"},{default:i(()=>[p(s(o.value.is_valid?t.$t("certificates.valid"):t.$t("certificates.expired")),1)]),_:1},8,["variant"])]),e("div",null,[e("span",$e,s(t.$t("certificates.subject")),1),e("p",xe,s(((l=o.value.subject)==null?void 0:l.CN)||t.$t("certificates.unknown")),1)]),e("div",null,[e("span",be,s(t.$t("certificates.valid_until")),1),e("p",ke,s(A(o.value.valid_to)),1)]),e("div",null,[e("span",Ce,s(t.$t("certificates.fingerprint")),1),e("p",Be,s(o.value.fingerprint),1)]),e("div",null,[e("span",Ne,s(t.$t("certificates.uploaded_at")),1),e("p",De,s(j(o.value.uploaded_at)),1)]),e("div",je,[r(n,{variant:"danger",size:"sm",onClick:a[3]||(a[3]=()=>{console.log("Delete button clicked"),k.value=!0})},{left:i(()=>[r(w(te),{class:"h-4 w-4"})]),default:i(()=>[p(" "+s(t.$t("certificates.delete_certificate")),1)]),_:1})])])):(_(),$("div",Ve,[r(w(se),{class:"mx-auto h-16 w-16 text-gray-300"}),e("p",Ie,s(t.$t("certificates.no_certificate")),1),e("p",Ue,s(t.$t("certificates.upload_help")),1)]))]}),_:1})])]),r(E,{show:B.value,onClose:a[5]||(a[5]=l=>B.value=!1)},{header:i(()=>[e("span",Le,s(t.$t("certificates.certificate_details")),1)]),footer:i(()=>[e("div",Xe,[r(n,{variant:"primary-outline",onClick:a[4]||(a[4]=l=>B.value=!1)},{default:i(()=>[p(s(t.$t("general.close")),1)]),_:1})])]),default:i(()=>{var l,F,M,T;return[o.value?(_(),$("div",Ee,[e("div",Fe,[e("div",null,[e("label",Me,s(t.$t("certificates.common_name")),1),e("p",Te,s(((l=o.value.subject)==null?void 0:l.CN)||t.$t("certificates.unknown")),1)]),e("div",null,[e("label",qe,s(t.$t("certificates.organization")),1),e("p",ze,s(((F=o.value.subject)==null?void 0:F.O)||t.$t("certificates.unknown")),1)]),e("div",null,[e("label",Pe,s(t.$t("certificates.country")),1),e("p",Se,s(((M=o.value.subject)==null?void 0:M.C)||t.$t("certificates.unknown")),1)]),e("div",null,[e("label",He,s(t.$t("certificates.serial_number")),1),e("p",Ae,s(o.value.serial_number),1)])]),e("div",null,[e("label",We,s(t.$t("certificates.issuer")),1),e("p",Ke,s(((T=o.value.issuer)==null?void 0:T.CN)||t.$t("certificates.unknown")),1)]),e("div",Oe,[e("div",null,[e("label",Re,s(t.$t("certificates.valid_from")),1),e("p",Ge,s(j(o.value.valid_from)),1)]),e("div",null,[e("label",Je,s(t.$t("certificates.valid_until")),1),e("p",Qe,s(j(o.value.valid_to)),1)])])])):b("",!0)]}),_:1},8,["show"]),r(E,{show:k.value,onClose:a[7]||(a[7]=l=>k.value=!1)},{header:i(()=>[e("span",Ye,s(t.$t("certificates.delete_confirmation_title")),1)]),footer:i(()=>[e("div",ot,[r(n,{variant:"white",onClick:a[6]||(a[6]=l=>k.value=!1)},{default:i(()=>[p(s(t.$t("general.cancel")),1)]),_:1}),r(n,{variant:"danger",loading:D.value,onClick:H},{default:i(()=>[p(s(t.$t("certificates.delete_confirm")),1)]),_:1},8,["loading"])])]),default:i(()=>[e("div",Ze,[e("p",et,s(t.$t("certificates.delete_confirmation_message")),1),e("div",tt,[e("div",st,[r(w(ie),{class:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0"}),e("p",at,s(t.$t("certificates.delete_warning")),1)])])])]),_:1},8,["show"])]),_:1})}}};export{lt as default};
