import{ax as U,O as W,v as K,e as j,j as L,P as Q,k as J,K as m,c,L as u,w as i,a as l,N as X,r as y,n as Z,o as n,b as t,l as r,V as v,q as _,t as a,M as R,Q as P,R as D}from"./main-Ds_umSNN.js";import{u as tt}from"./bills-C_KboshD.js";import{_ as et}from"./BillIndexDropdown-LmkkiCFc.js";import{L as st}from"./LoadingIcon-C_CG-rF2.js";const at={class:"text-sm mr-3"},lt={class:"grid grid-cols-1 gap-6"},it={class:"p-6"},nt={class:"text-lg font-semibold mb-4"},ot={class:"p-6"},rt={class:"text-lg font-semibold mb-4"},ut={class:"overflow-x-auto"},ct={class:"min-w-full divide-y divide-gray-200"},dt={class:"bg-gray-50"},_t={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},pt={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},mt={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},yt={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},bt={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},ht={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},xt={class:"bg-white divide-y divide-gray-200"},vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},gt={key:0,class:"text-xs text-gray-500 mt-1"},ft={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},wt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},$t={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-right"},Et={class:"p-6"},Tt={class:"text-lg font-semibold mb-4"},At={class:"space-y-2"},Lt={class:"text-gray-600"},Pt={class:"p-6"},Dt={class:"text-lg font-semibold mb-4"},It={class:"space-y-3"},Nt={class:"flex justify-between text-sm"},St={class:"text-gray-600"},Ct={key:0,class:"flex justify-between text-sm"},Mt={class:"text-gray-600"},jt={key:1,class:"flex justify-between text-sm"},Rt={class:"text-gray-600"},Vt={class:"flex justify-between text-base font-semibold pt-3 border-t"},Ft={class:"flex justify-between text-base font-semibold text-primary-600"},Yt={class:"p-6"},qt={class:"text-lg font-semibold mb-4"},zt={class:"text-sm text-gray-600 whitespace-pre-wrap"},Gt={class:"p-6"},Ht={class:"flex justify-between items-center mb-6"},Ot={class:"text-lg font-semibold"},Ut={key:0,class:"overflow-x-auto"},Wt={class:"min-w-full divide-y divide-gray-200"},Kt={class:"bg-gray-50"},Qt={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Jt={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Xt={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},Zt={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},te={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},ee={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},se={class:"bg-white divide-y divide-gray-200"},ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},oe={class:"px-6 py-4 text-sm text-gray-900"},re={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ue=["onClick"],ce={key:1,class:"text-center py-8"},de={class:"text-gray-500"},_e={key:2,class:"mt-6"},pe={key:1,class:"flex justify-center items-center h-screen"},ge={__name:"View",setup(me){const I=U(),d=tt(),h=W();Z();const{t:b}=K.useI18n(),E=X(),$=j(!1),T=j(!1),e=L(()=>d.selectedBill),V=L(()=>{var s;return((s=e.value)==null?void 0:s.bill_number)||b("bills.view_bill")});L(()=>e.value?`/bills/pdf/${e.value.unique_hash}`:""),Q(E,(s,A)=>{s.name==="bills.view"&&N()});async function N(){T.value=!0,(await d.fetchBill(E.params.id)).data,T.value=!1}async function B(){await d.fetchBill(E.params.id)}async function F(){I.openDialog({title:b("general.are_you_sure"),message:b("bills.bill_mark_as_sent"),yesLabel:b("general.ok"),noLabel:b("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(async s=>{$.value=!1,s&&(await d.markAsSent({id:e.value.id,status:"SENT"}),e.value.status="SENT",$.value=!0,await B()),$.value=!1})}async function Y(){e.value&&(await d.sendBill(e.value),await B())}async function S(){e.value&&await d.fetchBillPayments(e.value.id)}async function q(s){I.openDialog({title:b("general.are_you_sure"),message:b("bills.confirm_delete_payment"),yesLabel:b("general.ok"),noLabel:b("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async A=>{A&&(await d.deleteBillPayment(e.value.id,s),await S(),await B())})}return J(()=>{N()}),(s,A)=>{const f=y("BaseButton"),w=y("router-link"),z=y("BasePageHeader"),g=y("BaseDescriptionListItem"),G=y("BaseDescriptionList"),x=y("BaseCard"),p=y("BaseFormatMoney"),C=y("BaseTab"),H=y("BaseTabGroup"),O=y("BasePage");return e.value?(n(),m(O,{key:0},{default:i(()=>[l(z,{title:V.value},{actions:i(()=>[r(h).hasAbilities(r(v).EDIT_BILL)?(n(),m(w,{key:0,to:`/admin/bills/${e.value.id}/edit`},{default:i(()=>[l(f,{variant:"primary-outline",class:"mr-3"},{default:i(()=>[_(a(s.$t("general.edit")),1)]),_:1})]),_:1},8,["to"])):u("",!0),t("div",at,[e.value.status==="DRAFT"&&r(h).hasAbilities(r(v).EDIT_BILL)?(n(),m(f,{key:0,disabled:$.value,variant:"primary-outline",onClick:F},{default:i(()=>[_(a(s.$t("bills.mark_as_sent")),1)]),_:1},8,["disabled"])):u("",!0)]),e.value.status==="DRAFT"&&r(h).hasAbilities(r(v).SEND_BILL)?(n(),m(f,{key:1,variant:"primary",class:"text-sm mr-3",onClick:Y},{default:i(()=>[_(a(s.$t("bills.send_bill")),1)]),_:1})):u("",!0),r(h).hasAbilities(r(v).CREATE_PAYMENT)&&(e.value.status==="SENT"||e.value.status==="VIEWED")?(n(),m(w,{key:2,to:`/admin/bills/${e.value.id}/payments/create`},{default:i(()=>[l(f,{variant:"primary",class:"mr-3"},{default:i(()=>[_(a(s.$t("bills.record_payment")),1)]),_:1})]),_:1},8,["to"])):u("",!0),l(et,{class:"ml-3",row:e.value,"load-data":B},null,8,["row"])]),_:1},8,["title"]),l(x,{class:"mt-8"},{default:i(()=>[l(H,null,{default:i(()=>[l(C,{"tab-panel-container":"py-4 mt-px",title:s.$t("bills.details")},{default:i(()=>[t("div",lt,[l(x,null,{default:i(()=>[t("div",it,[t("h3",nt,a(s.$t("bills.bill_information")),1),l(G,null,{default:i(()=>[l(g,{label:s.$t("bills.bill_number")},{default:i(()=>[_(a(e.value.bill_number),1)]),_:1},8,["label"]),l(g,{label:s.$t("bills.bill_date")},{default:i(()=>[_(a(e.value.formatted_bill_date),1)]),_:1},8,["label"]),l(g,{label:s.$t("bills.due_date")},{default:i(()=>[_(a(e.value.formatted_due_date||"-"),1)]),_:1},8,["label"]),l(g,{label:s.$t("bills.supplier")},{default:i(()=>{var o;return[_(a(((o=e.value.supplier)==null?void 0:o.name)||"-"),1)]}),_:1},8,["label"]),l(g,{label:s.$t("bills.status")},{default:i(()=>[t("span",{class:R(["px-2 py-1 text-xs font-semibold rounded",{"bg-gray-200 text-gray-800":e.value.status==="DRAFT","bg-blue-200 text-blue-800":e.value.status==="SENT","bg-green-200 text-green-800":e.value.status==="VIEWED","bg-purple-200 text-purple-800":e.value.status==="COMPLETED"}])},a(e.value.status),3)]),_:1},8,["label"]),l(g,{label:s.$t("bills.paid_status")},{default:i(()=>[t("span",{class:R(["px-2 py-1 text-xs font-semibold rounded",{"bg-red-200 text-red-800":e.value.paid_status==="UNPAID","bg-yellow-200 text-yellow-800":e.value.paid_status==="PARTIALLY_PAID","bg-green-200 text-green-800":e.value.paid_status==="PAID"}])},a(e.value.paid_status),3)]),_:1},8,["label"])]),_:1})])]),_:1}),e.value.items&&e.value.items.length>0?(n(),m(x,{key:0},{default:i(()=>[t("div",ot,[t("h3",rt,a(s.$t("bills.line_items")),1),t("div",ut,[t("table",ct,[t("thead",dt,[t("tr",null,[t("th",_t,a(s.$t("bills.item")),1),t("th",pt,a(s.$t("bills.quantity")),1),t("th",mt,a(s.$t("bills.price")),1),t("th",yt,a(s.$t("bills.discount")),1),t("th",bt,a(s.$t("bills.tax")),1),t("th",ht,a(s.$t("bills.total")),1)])]),t("tbody",xt,[(n(!0),c(P,null,D(e.value.items,(o,k)=>(n(),c("tr",{key:k},[t("td",vt,[_(a(o.name)+" ",1),o.description?(n(),c("div",gt,a(o.description),1)):u("",!0)]),t("td",ft,a(o.quantity),1),t("td",wt,[l(p,{amount:o.price,currency:e.value.currency},null,8,["amount","currency"])]),t("td",kt,[l(p,{amount:o.discount_val||0,currency:e.value.currency},null,8,["amount","currency"])]),t("td",$t,[l(p,{amount:o.tax||0,currency:e.value.currency},null,8,["amount","currency"])]),t("td",Bt,[l(p,{amount:o.total,currency:e.value.currency},null,8,["amount","currency"])])]))),128))])])])])]),_:1})):u("",!0),e.value.taxes&&e.value.taxes.length>0?(n(),m(x,{key:1},{default:i(()=>[t("div",Et,[t("h3",Tt,a(s.$t("bills.tax_breakdown")),1),t("div",At,[(n(!0),c(P,null,D(e.value.taxes,(o,k)=>(n(),c("div",{key:k,class:"flex justify-between text-sm"},[t("span",Lt,a(o.name)+" ("+a(o.percent)+"%)",1),l(p,{amount:o.amount,currency:e.value.currency},null,8,["amount","currency"])]))),128))])])]),_:1})):u("",!0),l(x,null,{default:i(()=>[t("div",Pt,[t("h3",Dt,a(s.$t("bills.totals")),1),t("div",It,[t("div",Nt,[t("span",St,a(s.$t("bills.subtotal")),1),l(p,{amount:e.value.sub_total,currency:e.value.currency},null,8,["amount","currency"])]),e.value.discount_val>0?(n(),c("div",Ct,[t("span",Mt,a(s.$t("bills.discount")),1),l(p,{amount:e.value.discount_val,currency:e.value.currency},null,8,["amount","currency"])])):u("",!0),e.value.tax>0?(n(),c("div",jt,[t("span",Rt,a(s.$t("bills.tax")),1),l(p,{amount:e.value.tax,currency:e.value.currency},null,8,["amount","currency"])])):u("",!0),t("div",Vt,[t("span",null,a(s.$t("bills.total")),1),l(p,{amount:e.value.total,currency:e.value.currency},null,8,["amount","currency"])]),t("div",Ft,[t("span",null,a(s.$t("bills.due_amount")),1),l(p,{amount:e.value.due_amount,currency:e.value.currency},null,8,["amount","currency"])])])])]),_:1}),e.value.notes?(n(),m(x,{key:2},{default:i(()=>[t("div",Yt,[t("h3",qt,a(s.$t("bills.notes")),1),t("p",zt,a(e.value.notes),1)])]),_:1})):u("",!0)])]),_:1},8,["title"]),l(C,{"tab-panel-container":"py-4 mt-px",title:s.$t("bills.payments"),onClick:S},{default:i(()=>[l(x,null,{default:i(()=>[t("div",Gt,[t("div",Ht,[t("h3",Ot,a(s.$t("bills.payment_history")),1),r(h).hasAbilities(r(v).CREATE_PAYMENT)?(n(),m(w,{key:0,to:`/admin/bills/${e.value.id}/payments/create`},{default:i(()=>[l(f,{variant:"primary"},{default:i(()=>[_(a(s.$t("bills.add_payment")),1)]),_:1})]),_:1},8,["to"])):u("",!0)]),r(d).billPayments&&r(d).billPayments.length>0?(n(),c("div",Ut,[t("table",Wt,[t("thead",Kt,[t("tr",null,[t("th",Qt,a(s.$t("bills.payment_date")),1),t("th",Jt,a(s.$t("bills.payment_number")),1),t("th",Xt,a(s.$t("bills.amount")),1),t("th",Zt,a(s.$t("bills.payment_method")),1),t("th",te,a(s.$t("bills.notes")),1),t("th",ee,a(s.$t("bills.actions")),1)])]),t("tbody",se,[(n(!0),c(P,null,D(r(d).billPayments,(o,k)=>{var M;return n(),c("tr",{key:k},[t("td",ae,a(o.formatted_payment_date),1),t("td",le,a(o.payment_number),1),t("td",ie,[l(p,{amount:o.amount,currency:e.value.currency},null,8,["amount","currency"])]),t("td",ne,a(((M=o.payment_method)==null?void 0:M.name)||"-"),1),t("td",oe,a(o.notes||"-"),1),t("td",re,[r(h).hasAbilities(r(v).EDIT_PAYMENT)?(n(),m(w,{key:0,to:`/admin/bills/${e.value.id}/payments/${o.id}/edit`,class:"text-primary-600 hover:text-primary-900 mr-4"},{default:i(()=>[_(a(s.$t("general.edit")),1)]),_:2},1032,["to"])):u("",!0),r(h).hasAbilities(r(v).DELETE_PAYMENT)?(n(),c("button",{key:1,onClick:ye=>q(o.id),class:"text-red-600 hover:text-red-900"},a(s.$t("general.delete")),9,ue)):u("",!0)])])}),128))])])])):(n(),c("div",ce,[t("p",de,a(s.$t("bills.no_payments_yet")),1)])),r(d).billPayments&&r(d).billPayments.length>0?(n(),c("div",_e,[l(w,{to:`/admin/bills/${e.value.id}/payments`,class:"text-primary-600 hover:text-primary-900 text-sm font-medium"},{default:i(()=>[_(a(s.$t("bills.view_all_payments"))+" â†’ ",1)]),_:1},8,["to"])])):u("",!0)])]),_:1})]),_:1},8,["title"])]),_:1})]),_:1})]),_:1})):T.value?(n(),c("div",pe,[l(st,{class:"h-12 w-12 animate-spin text-primary-400"})])):u("",!0)}}};export{ge as default};
