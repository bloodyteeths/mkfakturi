import{a6 as p,s as r}from"./main-DpDYmbyp.js";const m=p("console",{state:()=>({partner:null,companies:[],managedCompanies:[],referredCompanies:[],pendingInvitations:[],totalManaged:0,totalReferred:0,totalPending:0,currentCompany:null,isLoading:!1,isSwitching:!1,error:null,showCompanySwitcher:!1}),getters:{primaryCompany:e=>e.managedCompanies.find(n=>n.is_primary)||null,totalCompanies:e=>e.managedCompanies.length,hasMultipleCompanies:e=>e.managedCompanies.length>1,sortedCompanies:e=>[...e.managedCompanies].sort((n,t)=>n.is_primary&&!t.is_primary?-1:!n.is_primary&&t.is_primary?1:n.name.localeCompare(t.name)),hasPendingInvitations:e=>e.pendingInvitations.length>0,hasReferredCompanies:e=>e.referredCompanies.length>0},actions:{async fetchCompanies(){var e,n;this.isLoading=!0,this.error=null;try{const t=await r.get("/console/companies");return this.partner=t.data.partner,t.data.managed_companies!==void 0?(this.managedCompanies=t.data.managed_companies||[],this.referredCompanies=t.data.referred_companies||[],this.pendingInvitations=t.data.pending_invitations||[],this.totalManaged=t.data.total_managed||this.managedCompanies.length,this.totalReferred=t.data.total_referred||this.referredCompanies.length,this.totalPending=t.data.total_pending||this.pendingInvitations.length,this.companies=this.managedCompanies):(this.companies=t.data.companies||[],this.managedCompanies=this.companies),this.managedCompanies.length>0&&(this.currentCompany=this.primaryCompany||this.managedCompanies[0]),t.data}catch(t){throw this.error=((n=(e=t.response)==null?void 0:e.data)==null?void 0:n.message)||"Failed to fetch companies",console.error("Console store - fetchCompanies error:",t),t}finally{this.isLoading=!1}},async switchCompany(e){var n,t,i;this.isSwitching=!0,this.error=null;try{const a=await r.post("/console/switch",{company_id:e});this.currentCompany=this.companies.find(s=>s.id===e);const o=a.data.context;return localStorage.setItem("partner_context",JSON.stringify({partner_id:o.partner_id,company_id:o.company_id,company_name:(n=this.currentCompany)==null?void 0:n.name,switched_at:new Date().toISOString()})),a.data}catch(a){throw this.error=((i=(t=a.response)==null?void 0:t.data)==null?void 0:i.error)||"Failed to switch company",console.error("Console store - switchCompany error:",a),a}finally{this.isSwitching=!1}},getStoredContext(){try{const e=localStorage.getItem("partner_context");return e?JSON.parse(e):null}catch(e){return console.error("Console store - getStoredContext error:",e),null}},clearStoredContext(){localStorage.removeItem("partner_context"),this.currentCompany=null},async initialize(){const e=this.getStoredContext();if(e&&e.company_id){await this.fetchCompanies();const n=this.companies.find(t=>t.id===e.company_id);n&&(this.currentCompany=n)}else await this.fetchCompanies()},resetStore(){this.partner=null,this.companies=[],this.currentCompany=null,this.isLoading=!1,this.isSwitching=!1,this.error=null,this.showCompanySwitcher=!1,this.clearStoredContext()},toggleCompanySwitcher(){this.showCompanySwitcher=!this.showCompanySwitcher},getCompanyById(e){return this.companies.find(n=>n.id===e)||null},async respondToInvitation(e,n){try{const t=await r.post(`/invitations/${e}/respond`,{action:n});return this.pendingInvitations=this.pendingInvitations.filter(i=>i.id!==e),this.totalPending=this.pendingInvitations.length,n==="accept"&&await this.fetchCompanies(),t.data}catch(t){throw console.error("Console store - respondToInvitation error:",t),t}}}});export{m as u};
