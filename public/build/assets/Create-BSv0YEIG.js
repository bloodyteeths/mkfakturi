import{H as Q,F as J,aN as O,e as W,I as D,j as B,k as X,N as Y,K as Z,w as u,r as d,n as ee,o as k,a as l,b as y,m as le,t as N,c as G,Q as te,R as ae,l as ne,q as P,M as ue}from"./main-rC5xHABW.js";import{u as oe}from"./bills-B8x7utVJ.js";const se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"mt-6"},de={class:"text-sm font-medium text-gray-900"},ie={class:"mt-4 space-y-4"},ce={class:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4"},me={class:"mt-6 flex justify-end space-x-3"},ye={__name:"Create",setup(pe){const T=Y(),w=ee(),q=oe(),F=Q(),C=J(),h=O(),U=W([]),t=D({id:null,bill_number:"",bill_date:"",due_date:"",supplier_id:null,currency_id:null,exchange_rate:1,discount:0,scanned_receipt_path:null}),b=D([{name:"",description:"",quantity:1,price:0,taxes:[]}]),g=B(()=>!!T.params.id),x=B(()=>U.value.find(e=>e.id===t.currency_id)??C.selectedCompanyCurrency);function H(e){t.id=e.id,t.bill_number=e.bill_number,t.bill_date=e.bill_date,t.due_date=e.due_date,t.supplier_id=e.supplier_id,t.currency_id=e.currency_id,t.exchange_rate=e.exchange_rate||1,t.discount=e.discount||0,t.scanned_receipt_path=e.scanned_receipt_path||null,e.items&&e.items.length&&b.splice(0,b.length,...e.items.map(a=>({name:a.name,description:a.description,quantity:a.quantity,price:a.price,tax_rate:0})))}const M=B(()=>b.reduce((e,a)=>e+(Number(a.quantity)||0)*(Number(a.price)||0),0)),S=B(()=>b.reduce((e,a)=>{const _=Number(a.quantity)||0,$=Number(a.price)||0,s=_*$,r=(a.taxes||[]).reduce((o,f)=>{const V=h.taxTypes.find(m=>m.id===f);return V?o+s*Number(V.percent)/100:o},0);return e+r},0)),I=B(()=>{const e=Number(t.discount)||0;return M.value*e/100}),R=B(()=>M.value-I.value+S.value);function j(){b.push({name:"",description:"",quantity:1,price:0,taxes:[]})}function z(){const e=M.value,a=I.value,_=S.value,$=R.value;return{id:t.id,bill_number:t.bill_number,bill_date:t.bill_date,due_date:t.due_date,supplier_id:t.supplier_id,currency_id:t.currency_id,exchange_rate:t.exchange_rate,discount:t.discount||0,discount_val:Math.round(a),sub_total:Math.round(e),tax:Math.round(_),total:Math.round($),items:b.map(s=>{const r=(Number(s.quantity)||0)*(Number(s.price)||0),o=(s.taxes||[]).reduce((m,i)=>{const c=h.taxTypes.find(v=>v.id===i);return c?m+r*Number(c.percent)/100:m},0),f=r+o,V=(s.taxes||[]).map(m=>{const i=h.taxTypes.find(c=>c.id===m);if(i){const c=r*Number(i.percent)/100;return{tax_type_id:i.id,name:i.name,percent:Number(i.percent),amount:Math.round(c),compound_tax:i.compound_tax||0}}return null}).filter(Boolean);return{name:s.name||s.description||"Item",description:s.description,quantity:Number(s.quantity)||0,price:Number(s.price)||0,discount:0,discount_val:0,tax:Math.round(o),total:Math.round(f),taxes:V}})}}function A(){const e=z();g.value?q.updateBill(e).then(()=>{w.push("/admin/bills")}):q.createBill(e).then(()=>{w.push("/admin/bills")})}return X(()=>{F.fetchCurrencies().then(e=>{U.value=e.data.data||F.currencies,!t.currency_id&&C.selectedCompanyCurrency&&(t.currency_id=C.selectedCompanyCurrency.id)}),h.fetchTaxTypes(),g.value?q.fetchBill(T.params.id).then(e=>{H(e.data.data)}):T.query.scanned_receipt_path&&(t.scanned_receipt_path=T.query.scanned_receipt_path)}),(e,a)=>{const _=d("BaseBreadcrumbItem"),$=d("BaseBreadcrumb"),s=d("BasePageHeader"),r=d("BaseInput"),o=d("BaseInputGroup"),f=d("BaseDatePicker"),V=d("BaseSupplierSelectInput"),m=d("BaseMultiselect"),i=d("BaseIcon"),c=d("BaseButton"),v=d("BaseFormatMoney"),E=d("BaseCard"),K=d("BasePage");return k(),Z(K,null,{default:u(()=>[l(s,{title:g.value?e.$t("bills.edit_bill"):e.$t("bills.new_bill")},{default:u(()=>[l($,null,{default:u(()=>[l(_,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),l(_,{title:e.$t("bills.title"),to:"/admin/bills"},null,8,["title"]),l(_,{title:g.value?e.$t("bills.edit_bill"):e.$t("bills.new_bill"),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),l(E,null,{default:u(()=>[y("form",{onSubmit:le(A,["prevent"])},[y("div",se,[l(o,{label:e.$t("bills.bill_number")},{default:u(()=>[l(r,{modelValue:t.bill_number,"onUpdate:modelValue":a[0]||(a[0]=n=>t.bill_number=n),required:""},null,8,["modelValue"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.bill_date")},{default:u(()=>[l(f,{modelValue:t.bill_date,"onUpdate:modelValue":a[1]||(a[1]=n=>t.bill_date=n),"calendar-button":!0},null,8,["modelValue"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.due_date")},{default:u(()=>[l(f,{modelValue:t.due_date,"onUpdate:modelValue":a[2]||(a[2]=n=>t.due_date=n),"calendar-button":!0},null,8,["modelValue"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.supplier")},{default:u(()=>[l(V,{modelValue:t.supplier_id,"onUpdate:modelValue":a[3]||(a[3]=n=>t.supplier_id=n),"fetch-all":""},null,8,["modelValue"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.currency")},{default:u(()=>[l(m,{modelValue:t.currency_id,"onUpdate:modelValue":a[4]||(a[4]=n=>t.currency_id=n),options:U.value,label:"name","value-prop":"id","track-by":"code",placeholder:e.$t("customers.select_currency"),"can-deselect":!1},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.exchange_rate")},{default:u(()=>[l(r,{modelValue:t.exchange_rate,"onUpdate:modelValue":a[5]||(a[5]=n=>t.exchange_rate=n),modelModifiers:{number:!0},type:"number",min:"0",step:"0.0001"},null,8,["modelValue"])]),_:1},8,["label"])]),y("div",re,[y("h3",de,N(e.$t("bills.items")),1),y("div",ie,[(k(!0),G(te,null,ae(b,(n,L)=>(k(),G("div",{key:L,class:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end"},[l(o,{label:e.$t("bills.item_name")},{default:u(()=>[l(r,{modelValue:n.name,"onUpdate:modelValue":p=>n.name=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(o,{label:e.$t("bills.item_description")},{default:u(()=>[l(r,{modelValue:n.description,"onUpdate:modelValue":p=>n.description=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(o,{label:e.$t("bills.item_quantity")},{default:u(()=>[l(r,{modelValue:n.quantity,"onUpdate:modelValue":p=>n.quantity=p,modelModifiers:{number:!0},type:"number",min:"1"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(o,{label:e.$t("bills.item_price")},{default:u(()=>[l(r,{modelValue:n.price,"onUpdate:modelValue":p=>n.price=p,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(o,{label:e.$t("bills.item_tax")},{default:u(()=>[l(m,{modelValue:n.taxes,"onUpdate:modelValue":p=>n.taxes=p,options:ne(h).taxTypes,label:"name","value-prop":"id","track-by":"id",mode:"tags",placeholder:e.$t("invoices.select_a_tax"),"can-clear":!0,"close-on-select":!1},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:2},1032,["label"])]))),128)),l(c,{variant:"secondary",size:"sm",type:"button",onClick:j},{left:u(n=>[l(i,{name:"PlusIcon",class:ue(n.class)},null,8,["class"])]),default:u(()=>[P(" "+N(e.$t("bills.add_item")),1)]),_:1})])]),y("div",ce,[l(o,{label:e.$t("bills.sub_total")},{default:u(()=>[l(v,{amount:M.value,currency:x.value},null,8,["amount","currency"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.discount_percentage")},{default:u(()=>[l(r,{modelValue:t.discount,"onUpdate:modelValue":a[6]||(a[6]=n=>t.discount=n),modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.01"},null,8,["modelValue"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.discount_amount")},{default:u(()=>[l(v,{amount:I.value,currency:x.value},null,8,["amount","currency"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.tax")},{default:u(()=>[l(v,{amount:S.value,currency:x.value},null,8,["amount","currency"])]),_:1},8,["label"]),l(o,{label:e.$t("bills.total")},{default:u(()=>[l(v,{amount:R.value,currency:x.value},null,8,["amount","currency"])]),_:1},8,["label"])]),y("div",me,[l(c,{variant:"secondary",onClick:a[7]||(a[7]=n=>e.$router.push("/admin/bills"))},{default:u(()=>[P(N(e.$t("general.cancel")),1)]),_:1}),l(c,{variant:"primary",type:"submit"},{default:u(()=>[P(N(g.value?e.$t("general.update"):e.$t("general.create")),1)]),_:1})])],32)]),_:1})]),_:1})}}};export{ye as default};
