import{a0 as U,v as F,e as b,j as A,P as B,k as D,r as x,c as u,o as i,a as _,b as l,L as J,t as d,Q as g,R as y,M,ag as z,aB as Q,s as R}from"./main-rC5xHABW.js";const T={class:"permission-editor"},q={key:0,class:"flex items-center justify-center py-8"},H={key:1},K={class:"p-4 mb-4 bg-purple-50 border border-purple-200 rounded-lg"},W={class:"flex items-center justify-between"},X={class:"text-sm font-medium text-purple-900"},Y={class:"text-xs text-purple-700"},Z={class:"space-y-4"},ee={class:"flex items-center justify-between mb-3"},se={class:"flex items-center space-x-3 flex-1"},te=["for"],le={class:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded"},ae=["onClick"],oe={class:"ml-8 space-y-2 border-t border-gray-100 pt-3"},ne=["for"],re={key:0,class:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg"},ue={class:"text-xs font-medium text-blue-900 mb-1"},ie={class:"flex flex-wrap gap-1"},de={__name:"PermissionEditor",props:{modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(w,{emit:C}){const{t:ce}=F.useI18n(),V=w,S=C,h=b(!1),c=b({}),m=b({}),t=b([...V.modelValue]),o=A({get:()=>t.value.includes("full_access"),set:e=>{e?t.value=["full_access"]:t.value=[]}});async function E(){h.value=!0;try{const e=await R.get("/partners/permissions");c.value=e.data.grouped,Object.keys(c.value).forEach(s=>{m.value[s]=!0})}catch(e){console.error("Failed to load permissions:",e)}finally{h.value=!1}}function $(e){m.value[e]=!m.value[e]}function k(e){if(o.value)return!1;const s=c.value[e];return s?s.permissions.every(a=>t.value.includes(a.value)):!1}function I(e){if(o.value)return!1;const s=c.value[e];if(!s)return!1;const a=s.permissions.filter(n=>t.value.includes(n.value)).length;return a>0&&a<s.permissions.length}function P(e){if(o.value)return 0;const s=c.value[e];return s?s.permissions.filter(a=>t.value.includes(a.value)).length:0}function j(e){if(o.value)return;const s=c.value[e];if(!s)return;k(e)?s.permissions.forEach(n=>{const f=t.value.indexOf(n.value);f>-1&&t.value.splice(f,1)}):s.permissions.forEach(n=>{t.value.includes(n.value)||t.value.push(n.value)})}function G(e){e?t.value=["full_access"]:t.value=[]}function L(e){for(const s of Object.values(c.value)){const a=s.permissions.find(n=>n.value===e);if(a)return a.label}return e}return B(t,e=>{S("update:modelValue",[...e])},{deep:!0}),B(()=>V.modelValue,e=>{const s=[...t.value].sort(),a=[...e].sort();JSON.stringify(s)!==JSON.stringify(a)&&(t.value=[...e])},{deep:!0}),D(()=>{E()}),(e,s)=>{const a=x("BaseLoader"),n=x("BaseSwitch"),f=x("BaseCheckbox"),N=x("BaseIcon");return i(),u("div",T,[h.value?(i(),u("div",q,[_(a)])):(i(),u("div",H,[l("div",K,[l("div",W,[l("div",null,[l("label",X,d(e.$t("partners.permissions.full_access")),1),l("p",Y,d(e.$t("partners.permissions.full_access_description")),1)]),_(n,{modelValue:o.value,"onUpdate:modelValue":[s[0]||(s[0]=p=>o.value=p),G]},null,8,["modelValue"])])]),l("div",Z,[(i(!0),u(g,null,y(c.value,(p,r)=>(i(),u("div",{key:r,class:M(["p-4 bg-white border border-gray-200 rounded-lg",{"opacity-50 pointer-events-none":o.value}])},[l("div",ee,[l("div",se,[_(f,{id:`group-${r}`,"model-value":k(r),indeterminate:I(r),"onUpdate:modelValue":v=>j(r),variant:"primary",disabled:o.value},null,8,["id","model-value","indeterminate","onUpdate:modelValue","disabled"]),l("label",{for:`group-${r}`,class:"text-sm font-medium text-gray-900 cursor-pointer flex-1"},d(p.label),9,te),l("span",le,d(P(r))+" / "+d(p.permissions.length),1)]),l("button",{type:"button",onClick:v=>$(r),class:"ml-2 text-gray-400 hover:text-gray-600"},[_(N,{name:m.value[r]?"ChevronUpIcon":"ChevronDownIcon",class:"w-5 h-5"},null,8,["name"])],8,ae)]),z(l("div",oe,[(i(!0),u(g,null,y(p.permissions,v=>(i(),u("div",{key:v.value,class:"flex items-center"},[_(f,{id:`perm-${v.value}`,modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=O=>t.value=O),value:v.value,variant:"primary",disabled:o.value},null,8,["id","modelValue","value","disabled"]),l("label",{for:`perm-${v.value}`,class:"ml-2 text-sm text-gray-700 cursor-pointer"},d(v.label),9,ne)]))),128))],512),[[Q,m.value[r]]])],2))),128))]),!o.value&&t.value.length>0?(i(),u("div",re,[l("div",ue,d(e.$t("partners.permissions.selected_permissions"))+" ("+d(t.value.length)+") ",1),l("div",ie,[(i(!0),u(g,null,y(t.value,p=>(i(),u("span",{key:p,class:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded"},d(L(p)),1))),128))])])):J("",!0)]))])}}},ve=U(de,[["__scopeId","data-v-f12a140c"]]);export{ve as P};
