import{a6 as W,s as K,a3 as J,e as d,K as F,w as o,r as u,n as M,o as f,a as t,b as r,L as C,c as U,l as T,q as h,t as i}from"./main-C3HD31Qx.js";const Q=(k=!1)=>(k?window.pinia.defineStore:W)({id:"receiptScanner",state:()=>({lastResult:null,isScanning:!1}),actions:{scanReceipt(x){this.isScanning=!0,this.lastResult=null;const p=new FormData;return p.append("receipt",x),new Promise((V,c)=>{K.post("/receipts/scan",p,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{this.lastResult=s.data,this.isScanning=!1,V(s)}).catch(s=>{var v,_,b;this.isScanning=!1,console.error("Receipt scan failed",{status:(v=s.response)==null?void 0:v.status,statusText:(_=s.response)==null?void 0:_.statusText,data:(b=s.response)==null?void 0:b.data}),J(s),c(s)})})}}})(),X={class:"space-y-4"},Y={key:1,class:"mt-6"},Z={class:"border rounded-lg overflow-hidden bg-gray-50"},O={class:"overflow-auto",style:{"max-height":"70vh"}},ee=["src","alt"],ae={key:0,class:"text-red-600 text-sm mt-2"},le={key:1,class:"text-green-600 text-sm mt-2"},te={class:"mt-4"},oe={class:"mt-8"},ne={class:"bg-white border rounded-lg p-6 space-y-4"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ue={class:"flex justify-end gap-3 pt-4"},re={__name:"Scan",setup(k){const B=Q(),x=M(),p=d(null),V=d([]),c=d(null),s=d(""),v=d(!1),_=d(null),b=d(0),S=d(0),l=d({vendor:"",bill_number:"",bill_date:"",due_date:"",amount:"",tax_amount:"",notes:""});function H(e,a){var $;const y=Array.isArray(a)?(($=a[0])==null?void 0:$.fileObject)||a[0]:a;p.value=y||null,c.value=null,s.value="",v.value=!1,_.value=null}function E(e){v.value=!0,b.value=e.target.naturalWidth,S.value=e.target.naturalHeight,console.log("Image loaded successfully:",b.value,"x",S.value)}function L(e){_.value=e.target.src,console.error("Failed to load image:",e.target.src)}function N(){p.value&&B.scanReceipt(p.value).then(e=>{if(console.log("Receipt scan response:",e),console.log("Response data:",e.data),c.value={image_url:e.data.image_url,stored_path:e.data.stored_path,ocr_text:e.data.ocr_text||"",hocr:e.data.hocr||null,image_width:e.data.image_width||null,image_height:e.data.image_height||null},console.log("scanResult set to:",c.value),s.value=e.data.ocr_text||"",console.log("Has hOCR:",!!e.data.hocr),console.log("ocrText set to:",s.value?s.value.substring(0,100):"(empty)"),e.data.data){const a=e.data.data;l.value.vendor=a.vendor_name||"",l.value.bill_number=a.bill_number||"",l.value.bill_date=a.bill_date||"",l.value.due_date=a.due_date||"",l.value.amount=a.total||"",l.value.tax_amount=a.tax||""}}).catch(e=>{console.error("Scan failed:",e),console.error("Error response:",e.response)})}function P(){l.value={vendor:"",bill_number:"",bill_date:"",due_date:"",amount:"",tax_amount:"",notes:""}}function z(){var e;x.push({name:"bills.create",query:{vendor:l.value.vendor,bill_number:l.value.bill_number,bill_date:l.value.bill_date,due_date:l.value.due_date,amount:l.value.amount,tax_amount:l.value.tax_amount,notes:l.value.notes,scanned_receipt_path:(e=c.value)==null?void 0:e.stored_path}})}return(e,a)=>{const y=u("BaseBreadcrumbItem"),$=u("BaseBreadcrumb"),D=u("BasePageHeader"),j=u("BaseFileUploader"),m=u("BaseInputGroup"),w=u("BaseButton"),q=u("BaseSpinner"),R=u("BaseHeading"),I=u("BaseTextarea"),g=u("BaseInput"),A=u("BaseCard"),G=u("BasePage");return f(),F(G,null,{default:o(()=>[t(D,{title:e.$t("receipts.scan_title")},{default:o(()=>[t($,null,{default:o(()=>[t(y,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),t(y,{title:e.$t("receipts.scan_title"),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),t(A,null,{default:o(()=>[r("div",X,[t(m,{label:e.$t("receipts.upload_receipt")},{default:o(()=>[t(j,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=n=>V.value=n),accept:"image/*,application/pdf",multiple:!1,onChange:H},null,8,["modelValue"])]),_:1},8,["label"]),t(w,{variant:"primary",disabled:!p.value||T(B).isScanning,onClick:N},{default:o(()=>[h(i(e.$t("receipts.scan_button")),1)]),_:1},8,["disabled"]),T(B).isScanning?(f(),F(q,{key:0,class:"mt-4"})):C("",!0),c.value?(f(),U("div",Y,[t(R,{tag:"h3",size:"sm",class:"mb-3"},{default:o(()=>[h(i(e.$t("receipts.scanned_receipt")),1)]),_:1}),r("div",Z,[r("div",O,[r("img",{src:c.value.image_url,alt:e.$t("receipts.receipt_image"),class:"max-w-full h-auto mx-auto",style:{"max-width":"600px"},onLoad:E,onError:L},null,40,ee)])]),_.value?(f(),U("p",ae," Failed to load image: "+i(_.value),1)):v.value?(f(),U("p",le," Image loaded: "+i(b.value)+"x"+i(S.value)+"px ",1)):C("",!0),r("div",te,[t(R,{tag:"h3",size:"sm",class:"mb-2"},{default:o(()=>[h(i(e.$t("receipts.ocr_text")),1)]),_:1}),t(I,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=n=>s.value=n),rows:10,readonly:!0,class:"font-mono text-sm",placeholder:e.$t("receipts.no_text_extracted")},null,8,["modelValue","placeholder"])]),r("div",oe,[t(R,{tag:"h3",size:"sm",class:"mb-4"},{default:o(()=>[h(i(e.$t("receipts.create_bill_from_scan")),1)]),_:1}),r("div",ne,[r("div",se,[t(m,{label:e.$t("bills.vendor")},{default:o(()=>[t(g,{modelValue:l.value.vendor,"onUpdate:modelValue":a[2]||(a[2]=n=>l.value.vendor=n),type:"text",placeholder:e.$t("bills.vendor_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(m,{label:e.$t("bills.bill_number")},{default:o(()=>[t(g,{modelValue:l.value.bill_number,"onUpdate:modelValue":a[3]||(a[3]=n=>l.value.bill_number=n),type:"text",placeholder:e.$t("bills.bill_number_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(m,{label:e.$t("bills.bill_date")},{default:o(()=>[t(g,{modelValue:l.value.bill_date,"onUpdate:modelValue":a[4]||(a[4]=n=>l.value.bill_date=n),type:"date"},null,8,["modelValue"])]),_:1},8,["label"]),t(m,{label:e.$t("bills.due_date")},{default:o(()=>[t(g,{modelValue:l.value.due_date,"onUpdate:modelValue":a[5]||(a[5]=n=>l.value.due_date=n),type:"date"},null,8,["modelValue"])]),_:1},8,["label"]),t(m,{label:e.$t("bills.amount")},{default:o(()=>[t(g,{modelValue:l.value.amount,"onUpdate:modelValue":a[6]||(a[6]=n=>l.value.amount=n),type:"number",step:"0.01",placeholder:e.$t("bills.amount_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(m,{label:e.$t("bills.tax_amount")},{default:o(()=>[t(g,{modelValue:l.value.tax_amount,"onUpdate:modelValue":a[7]||(a[7]=n=>l.value.tax_amount=n),type:"number",step:"0.01",placeholder:e.$t("bills.tax_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),t(m,{label:e.$t("bills.notes")},{default:o(()=>[t(I,{modelValue:l.value.notes,"onUpdate:modelValue":a[8]||(a[8]=n=>l.value.notes=n),rows:3,placeholder:e.$t("bills.notes_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r("div",ue,[t(w,{variant:"outline",onClick:P},{default:o(()=>[h(i(e.$t("general.reset")),1)]),_:1}),t(w,{variant:"primary",onClick:z},{default:o(()=>[h(i(e.$t("bills.create_bill")),1)]),_:1})])])])])):C("",!0)])]),_:1})]),_:1})}}};export{re as default};
