import{j as C,c as u,o as l,b as e,K as h,a5 as E,M as P,t as a,a6 as M,e as p,s as v,k as f,Q as x,R as b,v as R,L as y,N,n as j,w as I,r as A,a as k,l as D,c3 as B,q as V}from"./main-DpDYmbyp.js";import{_ as $}from"./CustomerIcon-BCdmRGWT.js";import{a as q,_ as L,D as K}from"./EstimateIcon-lRXRuUtn.js";import{u as O}from"./user-B-x-5nas.js";const T={class:"flex items-center p-4 bg-white rounded-lg shadow-xs"},U={class:"mb-2 text-sm font-medium text-gray-600"},z={class:"text-lg font-semibold text-gray-700"},F={__name:"DashboardStatsItem",props:{title:{type:String,required:!0},value:{type:[String,Number],required:!0},icon:{type:String,required:!0},color:{type:String,default:"text-blue-500"}},setup(d){const s=d,i=C(()=>({CustomerIcon:$,DollarIcon:K,InvoiceIcon:L,EstimateIcon:q})[s.icon]||$),r=C(()=>({"text-blue-500":"text-blue-500 bg-blue-100","text-green-500":"text-green-500 bg-green-100","text-purple-500":"text-purple-500 bg-purple-100","text-orange-500":"text-orange-500 bg-orange-100"})[s.color]||"text-blue-500 bg-blue-100");return(n,c)=>(l(),u("div",T,[e("div",{class:P(["p-3 mr-4 rounded-full",r.value])},[(l(),h(E(i.value),{class:"w-5 h-5"}))],2),e("div",null,[e("p",U,a(d.title),1),e("p",z,a(d.value),1)])]))}},w=M("partner",()=>{const d=p({activeClients:0,monthlyCommissions:0,processedInvoices:0,currentProjects:0}),s=p([]),i=p([]),r=p([]),n=p(!1),c=p(!1),m=p("");return{dashboardStats:d,recentCommissions:s,recentActivities:i,clients:r,isLoading:n,isMocked:c,mockWarning:m,loadDashboardStats:async()=>{n.value=!0;try{const{data:t}=await v.get("/partner/dashboard");t.mocked?(console.warn("⚠️ Partner portal using mocked data"),c.value=!0,m.value=t.warning||"Using mocked data for safety",d.value={activeClients:t.data.active_clients,monthlyCommissions:t.data.monthly_commissions,processedInvoices:t.data.processed_invoices,currentProjects:0}):(c.value=!1,m.value="",d.value={activeClients:t.data.active_clients,monthlyCommissions:t.data.monthly_commissions,processedInvoices:t.data.processed_invoices,currentProjects:0})}catch(t){console.error("Error loading dashboard stats:",t),d.value={activeClients:0,monthlyCommissions:0,processedInvoices:0,currentProjects:0}}finally{n.value=!1}},loadRecentCommissions:async()=>{try{const{data:t}=await v.get("/partner/commissions");t.mocked?(console.warn("⚠️ Partner commissions using mocked data"),s.value=t.data||[]):s.value=t.data||[]}catch(t){console.error("Error loading recent commissions:",t),s.value=[]}},loadRecentActivities:async()=>{try{i.value=[{id:1,description:"Обработена фактура #INV-2025-001 за ТехноСофт ДОО",created_at:new Date().toISOString()},{id:2,description:"Додаден нов клиент: МедТрејд ДООЕЛ",created_at:new Date(Date.now()-7200*1e3).toISOString()},{id:3,description:"Месечен извештај за јануари е генериран",created_at:new Date(Date.now()-300*60*1e3).toISOString()}]}catch(t){console.error("Error loading recent activities:",t)}},loadClients:async()=>{try{const{data:t}=await v.get("/partner/clients");t.mocked?(console.warn("⚠️ Partner clients using mocked data"),r.value=t.data||[]):r.value=t.data||[]}catch(t){console.error("Error loading clients:",t),r.value=[]}}}}),W={class:"grid gap-6 mb-8 md:grid-cols-2 xl:grid-cols-4"},Q={__name:"DashboardStats",setup(d){const s=w(),i=p([{title:"Активни Кліенти",value:"0",icon:"CustomerIcon",color:"text-blue-500"},{title:"Месечни Провизии",value:"0 МКД",icon:"DollarIcon",color:"text-green-500"},{title:"Обработени Фактури",value:"0",icon:"InvoiceIcon",color:"text-purple-500"},{title:"Тековни Проекти",value:"0",icon:"EstimateIcon",color:"text-orange-500"}]);return f(async()=>{var r,n,c;await s.loadDashboardStats(),i.value=[{title:"Активни Кліенти",value:((r=s.dashboardStats.activeClients)==null?void 0:r.toString())||"0",icon:"CustomerIcon",color:"text-blue-500"},{title:"Месечни Провизии",value:`${s.dashboardStats.monthlyCommissions||0} МКД`,icon:"DollarIcon",color:"text-green-500"},{title:"Обработени Фактури",value:((n=s.dashboardStats.processedInvoices)==null?void 0:n.toString())||"0",icon:"InvoiceIcon",color:"text-purple-500"},{title:"Тековни Проекти",value:((c=s.dashboardStats.currentProjects)==null?void 0:c.toString())||"0",icon:"EstimateIcon",color:"text-orange-500"}]}),(r,n)=>(l(),u("div",W,[(l(!0),u(x,null,b(i.value,c=>(l(),h(F,{key:c.title,title:c.title,value:c.value,icon:c.icon,color:c.color},null,8,["title","value","icon","color"]))),128))]))}},G={class:"grid gap-6 mb-8 md:grid-cols-2"},H={class:"min-w-0 p-4 bg-white rounded-lg shadow-xs"},J={class:"mb-4 font-semibold text-gray-800"},X={class:"overflow-hidden overflow-x-auto"},Y={class:"w-full whitespace-no-wrap"},Z={class:"text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b bg-gray-50"},tt={class:"px-4 py-3"},et={class:"px-4 py-3"},st={class:"px-4 py-3"},ot={class:"px-4 py-3"},at={class:"bg-white divide-y"},rt={class:"px-4 py-3 text-sm"},nt={class:"px-4 py-3 text-sm"},ct={class:"capitalize"},it={class:"px-4 py-3 text-sm"},lt={class:"px-4 py-3 text-sm"},dt={key:0},ut={colspan:"4",class:"px-4 py-8 text-center text-gray-500"},pt={class:"min-w-0 p-4 bg-white rounded-lg shadow-xs"},mt={class:"mb-4 font-semibold text-gray-800"},_t={class:"space-y-3"},gt={class:"ml-3 flex-1"},ht={class:"text-sm text-gray-600"},vt={class:"text-xs text-gray-400"},xt={key:0,class:"text-center py-8 text-gray-500"},bt={__name:"DashboardTable",setup(d){const{t:s}=R.useI18n(),i=w(),r=p([]),n=p([]),c=o=>new Intl.NumberFormat("mk-MK").format(o),m=o=>new Date(o).toLocaleDateString("mk-MK"),g=o=>({pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",paid:"bg-blue-100 text-blue-800"})[o]||"bg-gray-100 text-gray-800",S=o=>({pending:s("partner_dashboard.status_pending"),approved:s("partner_dashboard.status_approved"),paid:s("partner_dashboard.status_paid")})[o]||o;return f(async()=>{await i.loadRecentCommissions(),await i.loadRecentActivities(),r.value=i.recentCommissions||[],n.value=i.recentActivities||[]}),(o,_)=>(l(),u("div",G,[e("div",H,[e("h4",J,a(o.$t("partner_dashboard.recent_commissions_title")),1),e("div",X,[e("table",Y,[e("thead",null,[e("tr",Z,[e("th",tt,a(o.$t("partner_dashboard.client")),1),e("th",et,a(o.$t("partner_dashboard.type")),1),e("th",st,a(o.$t("partner_dashboard.amount")),1),e("th",ot,a(o.$t("partner_dashboard.status")),1)])]),e("tbody",at,[(l(!0),u(x,null,b(r.value,t=>(l(),u("tr",{key:t.id,class:"text-gray-700"},[e("td",rt,a(t.company_name),1),e("td",nt,[e("span",ct,a(t.type),1)]),e("td",it,a(c(t.amount))+" МКД ",1),e("td",lt,[e("span",{class:P(["px-2 py-1 text-xs font-semibold rounded-full",g(t.status)])},a(S(t.status)),3)])]))),128)),r.value.length?y("",!0):(l(),u("tr",dt,[e("td",ut,a(o.$t("partner_dashboard.no_recent_commissions")),1)]))])])])]),e("div",pt,[e("h4",mt,a(o.$t("partner_dashboard.recent_activities_title")),1),e("div",_t,[(l(!0),u(x,null,b(n.value,t=>(l(),u("div",{key:t.id,class:"flex items-center"},[_[0]||(_[0]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-2 h-2 bg-blue-500 rounded-full"})],-1)),e("div",gt,[e("p",ht,a(t.description),1),e("p",vt,a(m(t.created_at)),1)])]))),128)),n.value.length?y("",!0):(l(),u("div",xt,a(o.$t("partner_dashboard.no_recent_activities")),1))])])]))}},Ct={__name:"Dashboard",setup(d){const s=N(),i=w(),r=O(),n=j();return f(()=>{s.meta.isPartner&&!r.currentUser.is_partner&&n.push({name:"partner.login"})}),(c,m)=>{const g=A("BasePage");return l(),h(g,null,{default:I(()=>[D(i).isMocked?(l(),h(B,{key:0,type:"warning",title:"⚠️ Внимание",class:"mb-6"},{default:I(()=>[V(a(D(i).mockWarning||"Гледате симулирани податоци. Обработката на провизии е оневозможена за безбедност."),1)]),_:1})):y("",!0),k(Q),k(bt)]),_:1})}}};export{Ct as default};
