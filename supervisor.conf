# Supervisor Configuration for Facturino
# This file configures both the web server and queue workers
# Use this for Railway deployment or production servers

[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
loglevel=info

# PHP Built-in Server (Web)
[program:php-server]
command=php -S 0.0.0.0:%(ENV_PORT)s -t public
directory=/app
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
autostart=true
priority=100
startsecs=3
startretries=10
stopwaitsecs=10

# E-Invoice Queue Worker
[program:einvoice-queue-worker]
command=php artisan queue:work redis --queue=einvoice --tries=3 --timeout=120 --sleep=3 --max-jobs=100 --max-time=3600 --verbose
directory=/app
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
autostart=true
priority=200
startsecs=5
startretries=10
stopwaitsecs=130
stopasgroup=true
killasgroup=true

# General Queue Worker (for other queues)
[program:general-queue-worker]
command=php artisan queue:work redis --queue=default,high,background --tries=3 --timeout=90 --sleep=3 --max-jobs=100 --max-time=3600
directory=/app
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
autostart=true
priority=300
startsecs=5
startretries=10
stopwaitsecs=100
stopasgroup=true
killasgroup=true

# CLAUDE-CHECKPOINT
