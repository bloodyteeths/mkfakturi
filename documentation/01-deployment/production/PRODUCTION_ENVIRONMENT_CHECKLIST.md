# Production Environment Configuration Checklist
**Version:** 1.0.0
**Platform:** Railway
**Date:** 2025-11-17

---

## Application Configuration

### Core Settings (CRITICAL - Required)

```bash
# Application Identity
APP_NAME="Facturino"
APP_ENV=production                    # âœ… MUST be 'production'
APP_DEBUG=false                        # âœ… MUST be 'false' in production
APP_URL=https://your-domain.com        # âœ… Replace with actual domain

# Application Key (CRITICAL - Generates once, never change)
APP_KEY=base64:GENERATED_KEY_HERE      # âœ… Run: php artisan key:generate
APP_LOG_LEVEL=error                    # Options: debug, info, notice, warning, error, critical
APP_TIMEZONE=Europe/Skopje             # Macedonian timezone

# Locale Settings
APP_LOCALE=mk                          # Default: Macedonian
APP_FALLBACK_LOCALE=en                 # Fallback: English
APP_FAKER_LOCALE=en_US                 # For testing/seeding

# Maintenance Mode
APP_MAINTENANCE_DRIVER=file            # Options: file, cache, database
APP_MAINTENANCE_STORE=database         # Where to store maintenance mode data
```

**Validation:**
```bash
railway run -- php artisan config:show app | grep -E "env|debug|url|key"
```

**Expected:**
- `env` = `production`
- `debug` = `false`
- `url` = your production domain
- `key` = base64 string (not empty)

---

## Database Configuration

### PostgreSQL (Recommended for Production)

```bash
DB_CONNECTION=pgsql                    # âœ… Recommended: pgsql
DB_HOST=postgres.railway.internal      # âœ… Provided by Railway
DB_PORT=5432                           # Default PostgreSQL port
DB_DATABASE=railway                    # Default database name
DB_USERNAME=postgres                   # Default username
DB_PASSWORD=SECURE_PASSWORD_HERE       # âœ… Generated by Railway
```

**Alternative: MySQL**
```bash
DB_CONNECTION=mysql
DB_HOST=mysql.railway.internal
DB_PORT=3306
DB_DATABASE=railway
DB_USERNAME=root
DB_PASSWORD=SECURE_PASSWORD_HERE
```

**Validation:**
```bash
railway run -- php artisan tinker
>>> \DB::connection()->getPdo();
>>> \DB::table('users')->count();
>>> exit
```

**Expected:** PDO object returned, user count > 0

---

## Session Configuration (CRITICAL)

### Database Sessions (Recommended for Railway)

```bash
SESSION_DRIVER=database                # âœ… MUST be 'database' for Railway
SESSION_LIFETIME=1440                  # 24 hours (in minutes)
SESSION_ENCRYPT=false                  # Encryption handled by HTTPS
SESSION_PATH=/                         # Cookie path
SESSION_DOMAIN=null                    # Auto-detect from APP_URL
SESSION_SECURE_COOKIE=true            # âœ… HTTPS only
SESSION_SAME_SITE=lax                 # Options: lax, strict, none
```

**Why database sessions?**
- âœ… Survives container restarts
- âœ… Works with horizontal scaling
- âœ… No additional service required
- âœ… Persists across deployments

**Validation:**
```bash
# Check sessions table exists
railway run -- php artisan tinker
>>> \DB::table('sessions')->count();
>>> exit
```

**Expected:** Returns number >= 0 (table exists)

---

## Cache Configuration

### Database Cache (Default - No Redis Required)

```bash
CACHE_STORE=database                   # âœ… Default: works without Redis
CACHE_PREFIX=facturino_cache          # Prevent key collisions
```

### Redis Cache (RECOMMENDED - 10-50x Performance Boost)

```bash
CACHE_STORE=redis                      # âš¡ Recommended for production

REDIS_CLIENT=predis                    # Options: predis, phpredis
REDIS_HOST=redis.railway.internal      # Provided by Railway Redis service
REDIS_PASSWORD=REDIS_PASSWORD_HERE     # Generated by Railway
REDIS_PORT=6379                        # Default Redis port
REDIS_DB=0                            # Default database
REDIS_CACHE_DB=1                      # Separate DB for cache
REDIS_PREFIX=facturino_               # Key namespace
```

**Performance Comparison:**
- Without Redis: 500-1000ms dashboard load
- With Redis: 50-200ms dashboard load (5-10x faster)

**Cost:** ~$5-10/month on Railway

**Validation:**
```bash
# Test cache
railway run -- php artisan tinker
>>> Cache::put('test', 'value', 60);
>>> Cache::get('test');
>>> exit
```

**Expected:** Returns 'value'

---

## Queue Configuration

### Database Queue (Default - No Redis Required)

```bash
QUEUE_CONNECTION=database              # âœ… Default: works without Redis
QUEUE_FAILED_DRIVER=database-uuids    # Store failed jobs
```

### Redis Queue (RECOMMENDED for High Volume)

```bash
QUEUE_CONNECTION=redis                 # âš¡ Recommended for production

REDIS_QUEUE_DB=3                      # Separate DB for queues
REDIS_QUEUE=default                   # Default queue name
```

**Queue Worker (Required for Email Notifications):**
```bash
# Must run as separate Railway service or background process
php artisan queue:work --sleep=3 --tries=3 --max-time=3600
```

**Alternative: Horizon (Advanced Queue Management)**
```bash
QUEUE_CONNECTION=redis
# Then run: php artisan horizon
```

**Validation:**
```bash
railway run -- php artisan queue:work --once
```

**Expected:** Processes one job successfully

---

## Security Configuration

### Encryption & Hashing

```bash
BCRYPT_ROUNDS=12                       # Higher = more secure, slower (10-15 recommended)
```

### CSRF & Proxies

```bash
SANCTUM_STATEFUL_DOMAINS=your-domain.com,www.your-domain.com
TRUSTED_PROXIES="*"                    # Railway uses proxies, trust all
```

### Two-Factor Authentication

```bash
# Fortify 2FA Configuration (Enabled in config/fortify.php)
# No environment variables needed
# Users can enable in Settings â†’ Security
```

**Validation:**
```bash
railway run -- php artisan tinker
>>> \Schema::hasColumn('users', 'two_factor_secret');
>>> exit
```

**Expected:** Returns `true`

---

## Mail Configuration (REQUIRED for Notifications)

### SMTP (Recommended)

```bash
MAIL_DRIVER=smtp
MAIL_HOST=smtp.mailtrap.io            # âš ï¸ Replace with real SMTP server
MAIL_PORT=587                         # 587 for TLS, 465 for SSL
MAIL_USERNAME=your_smtp_username
MAIL_PASSWORD=your_smtp_password
MAIL_ENCRYPTION=tls                   # Options: tls, ssl
MAIL_FROM_NAME="Facturino"
MAIL_FROM_ADDRESS=noreply@facturino.mk
```

### Recommended SMTP Providers

**Postmark (Best for transactional email):**
```bash
MAIL_DRIVER=smtp
MAIL_HOST=smtp.postmarkapp.com
MAIL_PORT=587
MAIL_USERNAME=YOUR_SERVER_TOKEN
MAIL_PASSWORD=YOUR_SERVER_TOKEN
MAIL_ENCRYPTION=tls
```
- Cost: $10/month for 10,000 emails
- Excellent deliverability
- GDPR compliant

**SendGrid:**
```bash
MAIL_DRIVER=smtp
MAIL_HOST=smtp.sendgrid.net
MAIL_PORT=587
MAIL_USERNAME=apikey
MAIL_PASSWORD=YOUR_SENDGRID_API_KEY
MAIL_ENCRYPTION=tls
```
- Cost: Free tier 100 emails/day
- Scalable pricing

**Mailgun:**
```bash
MAIL_DRIVER=smtp
MAIL_HOST=smtp.mailgun.org
MAIL_PORT=587
MAIL_USERNAME=your_mailgun_smtp_username
MAIL_PASSWORD=your_mailgun_smtp_password
MAIL_ENCRYPTION=tls
```
- Cost: Free tier 5,000 emails/month
- EU servers available

**Validation:**
```bash
railway run -- php artisan tinker
>>> Mail::raw('Test', function($msg) { $msg->to('test@example.com')->subject('Test'); });
>>> exit
```

**Expected:** Email sent successfully (check logs)

---

## Backup Configuration (RECOMMENDED)

### AWS S3 Backups

```bash
# AWS Credentials
AWS_ACCESS_KEY_ID=AKIA_YOUR_KEY        # âš ï¸ Create IAM user with S3 permissions
AWS_SECRET_ACCESS_KEY=YOUR_SECRET_KEY
AWS_DEFAULT_REGION=eu-central-1        # âœ… Frankfurt (GDPR compliant)
AWS_BACKUP_BUCKET=facturino-backups    # Create this bucket in S3

# Backup Settings
BACKUP_NOTIFICATION_EMAIL=admin@facturino.mk
BACKUP_ARCHIVE_PASSWORD=                # Optional: encrypt backups
```

**Required IAM Permissions:**
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::facturino-backups",
        "arn:aws:s3:::facturino-backups/*"
      ]
    }
  ]
}
```

**S3 Bucket Configuration:**
1. Create bucket in `eu-central-1` (Frankfurt)
2. Enable versioning (protects against accidental deletion)
3. Enable default encryption (AES-256)
4. Set lifecycle policy (delete after 90 days optional)
5. Block all public access âœ…

**Validation:**
```bash
railway run -- php artisan backup:run
railway run -- php artisan backup:list
```

**Expected:** Backup uploaded to S3, listed successfully

**Cost Estimate:** ~$0.60/month for 25GB storage

---

## Payment Gateway Configuration

### Paddle (International Billing)

```bash
PADDLE_SELLER_ID=YOUR_SELLER_ID
PADDLE_API_KEY=YOUR_API_KEY
PADDLE_CLIENT_SIDE_TOKEN=YOUR_CLIENT_TOKEN
PADDLE_WEBHOOK_SECRET=YOUR_WEBHOOK_SECRET
PADDLE_RETAIN_KEY=YOUR_RETAIN_KEY
PADDLE_SANDBOX=false                   # âœ… MUST be false in production

# Paddle Product/Price IDs (from Paddle dashboard)
PADDLE_PRODUCT_STARTER=pri_XXXXXX
PADDLE_PRODUCT_STANDARD=pri_XXXXXX
PADDLE_PRODUCT_BUSINESS=pri_XXXXXX
PADDLE_PRODUCT_MAX=pri_XXXXXX

# Paddle URLs
PADDLE_RETURN_URL="${APP_URL}/billing/success"
PADDLE_WEBHOOK_URL="${APP_URL}/api/webhooks/paddle"
CASHIER_CURRENCY=EUR
CASHIER_CURRENCY_LOCALE=mk_MK
```

**Validation:**
```bash
railway run -- php artisan tinker
>>> config('cashier.paddle.seller_id');
>>> exit
```

**Expected:** Returns your Paddle seller ID

### CPAY (Macedonian Domestic Payments)

```bash
CPAY_MERCHANT_ID=YOUR_MERCHANT_ID
CPAY_SECRET_KEY=YOUR_SECRET_KEY
CPAY_PAYMENT_URL=https://cpay.com.mk/payment
```

**Note:** Requires merchant account setup with CPAY/CASYS

---

## Feature Flags

### Core Features (Recommended Settings)

```bash
# Partner Portal (Multi-Client Management for Accountants)
FEATURE_PARTNER_PORTAL=true            # âœ… Enable for production
FEATURE_PARTNER_MOCKED_DATA=false      # âœ… MUST be false in production

# Migration Wizard (Data Import)
FEATURE_MIGRATION_WIZARD=true          # âœ… Enable for production

# Advanced Payments
FEATURE_ADVANCED_PAYMENTS=true         # âœ… Enable for production

# Monitoring
FEATURE_MONITORING=true                # âœ… Enable for production
```

### Optional Features (Disable Initially)

```bash
# AI Tools (Requires Claude API key + costs money)
FEATURE_MCP_AI_TOOLS=false             # âš ï¸ Disable initially, enable after testing
AI_PROVIDER=claude
CLAUDE_API_KEY=                        # Set only if enabling AI

# Accounting Backbone (IFRS Double-Entry Ledger)
FEATURE_ACCOUNTING_BACKBONE=false      # âš ï¸ Disable initially, enable after testing

# PSD2 Banking (Requires bank API credentials)
FEATURE_PSD2_BANKING=false             # âš ï¸ Disable initially, enable after bank setup
```

---

## Performance Configuration

### PHP Optimization

```bash
# Railway automatically sets:
# - OPcache enabled
# - JIT compilation enabled (PHP 8.1+)
# - Memory limit: 512MB

# No environment variables needed for PHP optimization
```

### Laravel Optimization Commands

```bash
# Run after deployment
railway run -- php artisan config:cache
railway run -- php artisan route:cache
railway run -- php artisan view:cache
railway run -- php artisan optimize

# Clear caches if needed
railway run -- php artisan config:clear
railway run -- php artisan cache:clear
railway run -- php artisan route:clear
railway run -- php artisan view:clear
```

---

## Logging Configuration

### Production Logging

```bash
LOG_CHANNEL=stack                      # âœ… Recommended: stack (multiple channels)
LOG_STACK=single                       # Options: single, daily, syslog
LOG_LEVEL=error                        # âœ… Production: error (less verbose)
                                       # Options: debug, info, notice, warning, error, critical, alert, emergency
```

**Log Rotation (Daily Logs):**
```bash
LOG_STACK=daily
LOG_DAILY_DAYS=14                      # Keep logs for 14 days
```

**Validation:**
```bash
railway logs --tail=100 | grep -E "ERROR|CRITICAL"
```

---

## External Services Configuration

### OCR (Receipt Scanning) - Optional

```bash
# Option 1: Tesseract (Self-Hosted)
TESSERACT_PATH=/usr/bin/tesseract
TESSERACT_LANGUAGES=eng,mkd

# Option 2: OCR.space API
OCR_SPACE_API_KEY=YOUR_API_KEY
OCR_SPACE_ENDPOINT=https://api.ocr.space/parse/image
```

### PSD2 Banking - Optional (Future)

```bash
# Stopanska Bank
STOPANSKA_CLIENT_ID=
STOPANSKA_CLIENT_SECRET=
STOPANSKA_ENVIRONMENT=production       # sandbox | production

# NLB Bank
NLB_CLIENT_ID=
NLB_CLIENT_SECRET=
NLB_ENVIRONMENT=production
```

---

## Monitoring & Observability

### Application Metrics

```bash
# Prometheus metrics endpoint: /metrics
# Enable in feature flags:
FEATURE_MONITORING=true

# Metrics are automatically collected
# Connect to Grafana Cloud for visualization
```

### Health Checks

```bash
# Health check endpoints (automatically available):
# - /api/health
# - /api/v1/ping

# Configure UptimeRobot to monitor these endpoints
```

---

## Validation Checklist

### Step-by-Step Verification

```bash
# 1. Verify environment is production
railway run -- php artisan tinker
>>> app()->environment();
>>> exit
# Expected: 'production'

# 2. Verify debug is disabled
railway run -- php artisan tinker
>>> config('app.debug');
>>> exit
# Expected: false

# 3. Verify database connection
railway run -- php artisan tinker
>>> \DB::connection()->getPdo();
>>> exit
# Expected: PDO object

# 4. Verify session driver
railway run -- php artisan tinker
>>> config('session.driver');
>>> exit
# Expected: 'database'

# 5. Verify cache is working
railway run -- php artisan tinker
>>> Cache::put('test', 'ok', 60);
>>> Cache::get('test');
>>> exit
# Expected: 'ok'

# 6. Verify queue is working
railway run -- php artisan queue:work --once
# Expected: Processes job successfully

# 7. Verify migrations are complete
railway run -- php artisan migrate:status
# Expected: All migrations show "Ran"

# 8. Verify 2FA is available
railway run -- php artisan tinker
>>> \Schema::hasColumn('users', 'two_factor_secret');
>>> exit
# Expected: true

# 9. Verify backups are configured
railway run -- php artisan backup:list
# Expected: Shows backup configuration (or runs first backup)

# 10. Verify feature flags
railway run -- php artisan tinker
>>> config('features.partner_portal');
>>> config('features.partner_mocked_data');
>>> exit
# Expected: true, false
```

---

## Security Hardening Checklist

- [x] `APP_DEBUG=false`
- [x] `APP_ENV=production`
- [x] HTTPS enabled (automatic with Railway)
- [x] `SESSION_SECURE_COOKIE=true`
- [x] `TRUSTED_PROXIES="*"` (required for Railway)
- [x] Database credentials are strong/random
- [x] `APP_KEY` is generated and unique
- [x] CSRF protection enabled (default)
- [x] 2FA available for users
- [x] Rate limiting configured (default)
- [x] No secrets in `.env` file committed to git
- [ ] S3 bucket has public access blocked
- [ ] IAM user has minimal permissions
- [ ] Mail credentials are valid and secure
- [ ] Paddle webhook secret is configured
- [ ] Regular backups are running

---

## Performance Optimization Checklist

- [ ] Redis provisioned and configured (optional but recommended)
- [x] Database sessions enabled
- [x] Config cached: `php artisan config:cache`
- [x] Routes cached: `php artisan route:cache`
- [x] Views cached: `php artisan view:cache`
- [x] Application optimized: `php artisan optimize`
- [ ] Queue worker running as separate service
- [x] OPcache enabled (Railway default)
- [ ] CDN configured for static assets (future)
- [x] Database indexes on frequently queried columns

---

## Cost Estimation

### Railway Base Plan
- **Application:** $5/month (included)
- **PostgreSQL:** $5/month
- **Total Base:** $10/month

### Optional Services
- **Redis:** $5-10/month (recommended)
- **Increased Resources:** $5-20/month (if needed)
- **Total with Redis:** $20-30/month

### External Services
- **AWS S3 Backups:** $0.60/month (25GB)
- **Email (Postmark):** $10/month (10,000 emails)
- **AI Features (Claude):** $5-20/month (optional)
- **Monitoring (Grafana):** Free tier available
- **Uptime (UptimeRobot):** Free tier available

### Total Monthly Cost Estimate
- **Minimum:** $20-30/month (Railway + PostgreSQL + Redis)
- **Recommended:** $30-40/month (+ backups + email)
- **Full Featured:** $45-70/month (+ AI features)

---

## Emergency Contact Configuration

```bash
# Admin Email (for critical alerts)
ADMIN_EMAIL=admin@facturino.mk

# Support Email (for user inquiries)
SUPPORT_EMAIL=support@facturino.mk

# Security Email (for vulnerability reports)
SECURITY_EMAIL=security@facturino.mk
```

---

## Final Sign-Off

**Pre-Deployment Verification:**
- [ ] All environment variables configured
- [ ] Database connection tested
- [ ] Migrations completed successfully
- [ ] Caches cleared and optimized
- [ ] Queue worker configured
- [ ] Email delivery tested
- [ ] Backups configured (or scheduled)
- [ ] Monitoring endpoints accessible
- [ ] Security checklist complete
- [ ] Performance benchmarks met

**Approved By:**
- [ ] DevOps Lead: ________________ Date: ________
- [ ] Technical Director: __________ Date: ________
- [ ] Security Officer: ____________ Date: ________

---

**Document Version:** 1.0.0
**Last Updated:** 2025-11-17
**Next Review:** Before each major deployment

ðŸ¤– **Generated with Claude Code**
**Co-Authored-By: Claude <noreply@anthropic.com>**
